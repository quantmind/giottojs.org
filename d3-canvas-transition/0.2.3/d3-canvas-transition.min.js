// https://github.com/quantmind/d3-canvas-transition Version 0.2.3. Copyright 2016 undefined.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-collection"),require("d3-timer"),require("d3-color")):"function"==typeof define&&define.amd?define("d3-canvas-transition",["exports","d3-selection","d3-collection","d3-timer","d3-color"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i){"use strict";function o(t){var e=t.context,n=s(t.attrs.get("stroke")),r=c(t.attrs.get("stroke-width")),i=t.attrs.get("stroke-linejoin"),o=!1;if(void 0!==r&&(o=!0,e.lineWidth=t.factor*r),n){o=!0;var a=t.getValue("stroke-opacity");(a||0===a)&&(n.opacity=a),e.strokeStyle=""+n}return i&&(o=!0,e.lineJoin=i),o}function a(t){var e=s(t.attrs.get("fill"));if(e){var n=t.getValue("fill-opacity");return(n||0===n)&&(e.opacity=n),t.context.fillStyle=""+e,e}}function s(t){if(t&&"none"!==t)return i.color(t)}function c(t){return"string"==typeof t&&"px"===t.substring(t.length-2)?+t.substring(0,t.length-2):"number"==typeof t?t:void 0}function u(t){this.node=t}function l(){return new f}function f(){this._head=null,this._tail=null,this._length=0,Object.defineProperty(this,"length",{get:function(){return this._length}})}function h(t,e,n){var r;e=e||1,Object.defineProperties(this,{context:{get:function(){return t}},deque:{get:function(){return r||(r=l()),r}},factor:{get:function(){return e}},tagName:{get:function(){return n}},childNodes:{get:function(){return r?r.list():[]}},firstChild:{get:function(){return r?r._head:null}},lastChild:{get:function(){return r?r._tail:null}},parentNode:{get:function(){return this._parent}},previousSibling:{get:function(){return this._prev}},nextSibling:{get:function(){return this._next}},namespaceURI:{get:function(){return V}},countNodes:{get:function(){return r?r._length:0}},root:{get:function(){return this._parent?this._parent.root:this}}})}function d(t,e,n){for(var r,i,o,a=t.split(" "),s=0;s<a.length;++s){var c,u;for(o=e._head,t=a[s],t.indexOf("#")>-1?(r=t.split("#"),i=r[0],u=r[1]):t.indexOf(".")>-1?(r=t.split("."),i=r[0],c=r.splice(1).join(" ")):i=t;o;){if(!i||o.tagName===i)if(u&&o.id!==u||c&&o.class!==c);else{if(!n)return o;n.push(o)}o=o._next}}return n}function g(t,e){t._touches||(t._touches=0),t._touches+=e,t._touches&&!t._scheduled&&(t._scheduled=r.timeout(x(t)))}function p(t,e){if(t.attrs){var n=t.context,r=S.get(t.tagName);n.save(),z.each(function(n){return n(t,e)}),o(t,e),a(t,e),n.save(),r&&r(t,e),n.stroke(),n.fill(),n.restore()}t.each(function(t){return p(t,e)}),t.attrs&&n.restore()}function x(t){return function(){var e=t.context;t._touches=0,e.beginPath(),e.closePath(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),p(t),t._scheduled=!1,g(t,0)}}function v(t,e){if(arguments.length>1){var n=this._parents[0]||this.node();n instanceof h&&"function"==typeof e.context&&(e.context(n.context),arguments[1]=F(e,n.factor))}return R.apply(this,arguments)}function _(){var t=this.node(),e=t.context,n=t.factor,r=e.canvas.width,i=e.canvas.height;return e.beginPath(),e.closePath(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,i),n>1&&(e.canvas.style.width=r+"px",e.canvas.style.height=i+"px",e.canvas.width=r*n,e.canvas.height=i*n,e.scale(n,n)),this}function y(t){return t}function m(t,e,n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"}function b(t,e,n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"}function k(t){var e=t.bandwidth()/2;return function(n){return t(n)+e}}function w(t,e){function n(n){var u=null==i?e.ticks?e.ticks.apply(e,r):e.domain():i,l=null==o?e.tickFormat?e.tickFormat.apply(e,r):y:o,f=Math.max(a,0)+c,h=t===I||t===J?m:b,d=e.range(),g=d[0],p=d[d.length-1],x=(e.bandwidth?k:y)(e.copy()),v=n.selection?n.selection():n,_=v.selectAll(".domain").data([null]),w=v.selectAll(".tick").data(u,e).order(),P=w.exit(),j=w.enter().append("g",".domain").attr("class","tick"),N=w.select("line"),A=w.select("text");switch(_=_.merge(_.enter().append("line").attr("class","domain")),w=w.merge(j),N=N.merge(j.append("line")),A=A.merge(j.append("text")),n!==v&&(_=_.transition(n),w=w.transition(n),P=P.transition(n).style("opacity",U).attr("transform",function(t){return h(x,this.parentNode.__axis||x,t)}),j.style("opacity",U).attr("transform",function(t){return h(this.parentNode.__axis||x,x,t)}),N=N.transition(n),A=A.transition(n)),w.style("opacity",1).attr("transform",function(t){return h(x,x,t)}),P.remove(),A.text(l),t){case I:_.attr("x1",g).attr("y1",-s).attr("x2",p).attr("y2",-s),N.attr("x2",0).attr("y2",-a),A.attr("x",0).attr("y",-f).attr("dy","0em").style("text-anchor","middle");break;case M:_.attr("x1",s).attr("y1",g).attr("x2",s).attr("y2",p),N.attr("y2",0).attr("x2",a),A.attr("y",0).attr("x",f).attr("dy",".32em").style("text-anchor","start");break;case J:_.attr("x1",g).attr("y1",s).attr("x2",p).attr("y2",s),N.attr("x2",0).attr("y2",a),A.attr("x",0).attr("y",f).attr("dy",".71em").style("text-anchor","middle");break;case L:_.attr("x1",-s).attr("y1",g).attr("x2",-s).attr("y2",p),N.attr("y2",0).attr("x2",-a),A.attr("y",0).attr("x",-f).attr("dy",".32em").style("text-anchor","end")}v.each(function(){this.__axis=x})}var r=[],i=null,o=null,a=6,s=6,c=3;return n.scale=function(t){return arguments.length?(e=t,n):e},n.ticks=function(){return r=E.call(arguments),n},n.tickArguments=function(t){return arguments.length?(r=null==t?[]:E.call(t),n):r.slice()},n.tickValues=function(t){return arguments.length?(i=null==t?null:E.call(t),n):i&&i.slice()},n.tickFormat=function(t){return arguments.length?(o=t,n):o},n.tickSize=function(t){return arguments.length?(a=s=+t,n):a},n.tickSizeInner=function(t){return arguments.length?(a=+t,n):a},n.tickSizeOuter=function(t){return arguments.length?(s=+t,n):s},n.tickPadding=function(t){return arguments.length?(c=+t,n):c},n}function P(t){return w(I,t)}function j(t){return w(M,t)}function N(t){return w(J,t)}function A(t){return w(L,t)}function C(t){for(var e=[],n=0,r=void 0,i=void 0,o=0;o<Q.length;++o)r=Q[o],i=t.getValue("font-"+r),i&&("size"===r&&(n=t.factor*i,i=n+"px"),e.push(i));return n&&(t.context.font=e.join(" ")),n}function O(t,e,n){var r=t.attrs.get(e)||0,i=t.attrs.get("d"+e)||0;return i&&("em"==i.substring(i.length-2)?i=n*i.substring(0,i.length-2):"px"==i.substring(i.length-2)&&(i=+i.substring(0,i.length-2))),t.factor*(r+i)}u.prototype={getPropertyValue:function(t){var e=this.node.getValue(t);return void 0===e&&(e=window.getComputedStyle(this.node.context.canvas).getPropertyValue(t)),e}};var q=function(t,e,n){var r=t.attrs.get(e);return r!==n&&(t.attrs.set(e,n),!0)};f.prototype=l.prototype={prepend:function(t,e){this._length?e?(t._prev=e._prev,t._next=e,e._prev&&(e._prev.next=t),e._prev=t):(t._prev=this._tail,t._next=null,this._tail._next=t):(t._prev=null,t._next=null),t._prev||(this._head=t),t._next||(this._tail=t),this._length++},remove:function(t){t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),this._head===t&&(this._head=t._next),this._tail===t&&(this._tail=t._prev),delete t._prev,delete t._next,this._length--},list:function t(){for(var e=this._head,t=[];e;)t.push(e),e=e._next;return t},each:function(t){for(var e=this._head;e;)t(e),e=e._next}};var V="canvas",S=n.map(),z=n.map();h.prototype={querySelectorAll:function(t){return this.countNodes?"*"===t?this.childNodes:d(t,this.deque,[]):[]},querySelector:function(t){if(this.countNodes)return"*"===t?this.deque._head:d(t,this.deque)},createElementNS:function(t,e){return new h(this.context,this.factor,e)},hasChildNodes:function(){return this.countNodes>0},contains:function(t){for(;t;){if(t._parent==this)return!0;t=t._parent}return!1},appendChild:function(t){return this.insertBefore(t)},insertBefore:function(t,e){if(t===this)throw Error("inserting self into children");if(!(t instanceof h))throw Error("Cannot insert a non canvas element into a canvas element");return t._parent&&t._parent.removeChild(t),this.deque.prepend(t,e),t._parent=this,g(this.root,1),t},removeChild:function(t){if(t._parent===this)return delete t._parent,this.deque.remove(t),g(this.root,1),t},setAttribute:function(t,e){"class"===t?this.class=e:"id"===t?this.id=e:(this.attrs||(this.attrs=n.map()),q(this,t,e)&&g(this.root,1))},removeAttribute:function(t){this.attrs&&(this.attrs.remove(t),g(this.root,1))},getAttribute:function(t){var e=this.attrs?this.attrs.get(t):void 0;return void 0!==e||this._parent||(e=this.context.canvas[t]),e},each:function(t){this.countNodes&&this.deque.each(t)},getValue:function(t){var e=this.getAttribute(t);return void 0===e&&this._parent?this._parent.getValue(t):e},removeProperty:function(t){this.removeAttribute(t)},setProperty:function(t,e){this.setAttribute(t,e)},getProperty:function(t){return this.getAttribute(t)},getPropertyValue:function(t){return this.getAttribute(t)},getComputedStyle:function(t){return new u(t)},get ownerDocument(){return this},get style(){return this},get defaultView(){return this},get document(){return this}};var T=function(t){return t||window.devicePixelRatio||1},F=function(t,e){function n(){return i=arguments,n}function r(t){return a*o(t)}var i,o=t.size(),a=e*e;return t.size(r),n.size=function(t){return 0===arguments.length?r:(o=t,n)},n.draw=function(){return t.apply(this,i),n},n},R=e.selection.prototype.attr;e.selection.prototype.attr=v;var B=function(t,n){var r=e.selection();return t&&("string"!=typeof t||(t=e.select(t).node()))?(t.getContext&&(t=t.getContext("2d")),n||(n=T()),r=r.select(function(){return new h(t,n,"canvas")}),r.reset=_,r):r},E=Array.prototype.slice,I=1,M=2,J=3,L=4,U=1e-6,W="0.2.3",D=function(t){var e=t.attrs,n=t.context,r=t.factor;n.beginPath(),n.arc(r*e.get("cx",0),r*e.get("cy",0),r*e.get("r",0),0,2*Math.PI),n.closePath()},G=function(t){var e=t.attrs;t.context.moveTo(t.factor*(e.get("x1")||0),t.factor*(e.get("y1")||0)),t.context.lineTo(t.factor*e.get("x2"),t.factor*e.get("y2"))},H=function(t){var e=t.attrs.get("d");e&&("function"==typeof e.draw?e.draw(t):e.context&&e.context(t.context)())},K=function(t){var e=t.attrs;t.context.rect(0,0,t.factor*(e.get("width")||0),t.factor*(e.get("height")||0))},Q=["style","variant","weight","size","family"],X="middle",Y={start:"start",middle:"center",end:"end"},Z=function(t){var e=C(t);t.context.textAlign=Y[t.getValue("text-anchor")]||Y.middle,t.context.textBaseline=t.getValue("text-baseline")||X,t.context.fillText(t.textContent||"",O(t,"x",e),O(t,"y",e))},$=function(t){var e=+(t.attrs.get("x")||0),n=+(t.attrs.get("y")||0),r=t.attrs.get("transform"),i=t.context;if(r){var o,a,s,c=r.indexOf("translate(");if(c>-1&&(a=r.substring(c+10),o=a.indexOf(")"),s=a.substring(0,o).split(","),e+=+s[0],2===s.length&&(n+=+s[1])),c=r.indexOf("rotate("),c>-1){a=r.substring(c+7);var u=+a.substring(0,a.indexOf(")"));u===u&&(i.save(),i.rotate(u*Math.PI/180))}}(e||n)&&(i.save(),i.translate(t.factor*e,t.factor*n))};S.set("circle",D),S.set("line",G),S.set("path",H),S.set("rect",K),S.set("text",Z),z.set("transform",$),t.selectCanvas=B,t.resolution=T,t.CanvasElement=h,t.axisTop=P,t.axisRight=j,t.axisBottom=N,t.axisLeft=A,t.canvasVersion=W,Object.defineProperty(t,"__esModule",{value:!0})});