!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-collection"),require("d3-let"),require("d3-selection"),require("d3-timer"),require("d3-dispatch")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-let","d3-selection","d3-timer","d3-dispatch"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o){"use strict";function a(t){function e(t){this.el=t}function i(t){var n=new e(t);return Object.defineProperty(n,"value",{get:function(){return r.select(n.el).property("value")},set:function(t){r.select(n.el).property("value",t)}}),n}return e.prototype=n.assign({},lt,t),i.prototype=e.prototype,i}function s(t,e,n){return ut(function(){e.$set(n,t.value)})}function u(){this.attrs={},this.all=[]}function l(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__}function c(){var t=this.view();return t?t.model:null}function d(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),n=e.__d3_view__,r=e.parentNode;r&&!n;)n=r.__d3_view__,r=r.parentNode;return n}function f(){var t=[],e=void 0;if(this.each(function(){var i=r.select(this).view();i&&(e=p(this,i),n.isPromise(e)&&t.push(e))}),t.length)return Promise.all(t)}function p(t,e){var r=e.components.get(t.tagName.toLowerCase()),i=mt(t,e.directives),o=i.preMount();if(o)return o.execute(e.model);var a=void 0;if(r)a=(e=r({parent:e})).mount(t);else{for(var s=[],u=0;u<t.children.length;++u)a=p(t.children[u],e),n.isPromise(a)&&s.push(a);s.length&&(a=Promise.all(s))}return n.isPromise(a)?a.then(function(){return i.execute(e.model)}):i.execute(e.model)}function h(t,e){switch(e.type){case vt.IDENTIFIER:return t[e.name];case vt.LITERAL:return e.value;case vt.ARRAY_EXP:return e.elements.map(function(e){return h(t,e)});case vt.LOGICAL_EXP:case vt.BINARY_EXP:return y(e.operator,h(t,e.left),h(t,e.right));case vt.CALL_EXP:return v(t,e.callee,e.arguments);case vt.MEMBER_EXP:return h(h(t,e.object),e.property);case vt.CONDITIONAL_EXP:return h(t,e.test)?h(t,e.consequent):h(t,e.alternate);case vt.UNARY_EXP:return g(e.operator,h(t,e.argument))}}function m(t,n){switch(1===arguments.length&&(n=e.set()),t.type){case vt.IDENTIFIER:n.add(t.name);break;case vt.ARRAY_EXP:t.elements.forEach(function(t){m(t,n)});break;case vt.BINARY_EXP:m(t.left,n),m(t.right,n);break;case vt.CALL_EXP:m(t.arguments,n);break;case vt.MEMBER_EXP:m(t.object,n);break;case vt.CONDITIONAL_EXP:m(t.test,n),m(t.consequent,n),h(t.alternate,n)}return n}function v(t,e,n){var r;if(n=n.map(function(e){return h(t,e)}),e.type!==vt.IDENTIFIER&&(t=h(t,e.object),e=e.property),!(r=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return r.apply(t,n)}function g(t,e){return It[t]||(It[t]=new Function("arg","return "+t+" arg")),It[t](e)}function y(t,e,n){return Nt[t]||(Nt[t]=new Function("a","b","return a "+t+" b")),Nt[t](e,n)}function b(t){this.codes=vt,this.expr=t,this.parsed=Lt(t)}function E(t){var e=n.inBrowser?window.handlebars:require("handlebars");if(e)return e.compile(t);it("compile function requires handlebars")}function w(t,e){if(n.isString(t)){if(!e)return t;if(!E(t))return t}return t(e)}function x(t,e){var n=r.select(document.createElement("div"));n.html(w(t,e));var i=n.node().children;return 1!==i.length&&it("HtmlElement function should return one root element only, got "+i.length),i[0]}function P(t,r,i){function a(t){var r=n.pop(t,"parent"),a=e.map(r?r.components:null),s=e.map(r?r.directives:i),u=o.dispatch("message","mounted");l.each(function(t,e){a.set(e,t)}),c.each(function(t,e){s.set(e,t)}),O(a,n.pop(t,"components")),A(s,n.pop(t,"directives")),Object.defineProperties(this,{components:{get:function(){return a}},directives:{get:function(){return s}},parent:{get:function(){return r}},root:{get:function(){return r?r.root:this}},props:{get:function(){return f}},uid:{get:function(){return this.model.uid}},events:{get:function(){return u}}}),this.model=n.assign({},d,n.pop(t,"model")),this.init(t)}function s(t){return new a(t)}n.isFunction(t)&&(t={render:t});var u=n.assign({},t),l=O(e.map(),n.pop(u,"components")),c=A(e.map(),n.pop(u,"directives")),d=n.pop(u,"model"),f=n.pop(u,"props");return a.prototype=n.assign({},r,u),s.prototype=a.prototype,s}function _(t){var e=t.isMounted;return e||Object.defineProperty(t,"isMounted",{get:function(){return!0}}),e}function O(t,n){return e.map(n).each(function(e,n){t.set(n,P(e,Ft))}),t}function A(t,n){return e.map(n).each(function(e,n){t.set(n,Xt(e))}),t}function C(t,e){Object.defineProperty(Tt(t),"el",{get:function(){return e}});var i=r.select(e).view(t).mount();return n.isPromise(i)?i.then(function(){return t.mounted()}):t.mounted()}function $(t,e,n){return n?(1!==(n=qt(n)).size()&&it("render function must return a single HTML node"),n=n.node(),e.parentNode.insertBefore(n,e),r.select(e).remove(),C(t,n)):it("render function must return a single HTML node. It returned nothing!")}function L(t){for(var e={},n=void 0,r=0;r<t.attributes.length;++r)e[(n=t.attributes[r]).name]=n.value;return e}function I(t,n){function r(e){return null===s&&(s=N(t)),new s(e)}var i=e.map(),a=[],s=null;i.set("",o.dispatch("change")),Object.defineProperties(Mt(t),{$events:{get:function(){return i}},$children:{get:function(){return a}}}),t.$child=r,t.$update(n)}function N(t){function e(e){I(this,e),t.$children.push(this),Object.defineProperty(this,"parent",{get:function(){return t}})}return e.prototype=t,e}function S(t,e){for(;!(e in t)&&t.$parent;)t=t.$parent;return t}function D(t,e,r){function i(e){s&&(e=s.get.call(t)),e!==r&&(l(r),r=e)}var a,s,u=t.$events;u.set(e,o.dispatch("change")),Object.defineProperty(t,e,function(){var o={get:function(){return r}};return n.isFunction(r)&&(r={get:r}),n.isObject(r)&&n.isFunction(r.get)?(r=(s=r).get.call(t),s.reactOn?s.reactOn.forEach(function(n){t.$on(n+"."+e,i)}):t.$on("."+e,i),n.isFunction(s.set)&&(o.set=s.set)):o.set=i,o}());var l=ut(function(){a=arguments[0],u.get(e).call("change",t,r,a),s||u.get("").call("change",t,e)});l()}function R(t,e){var n=t.$events.get(e);return!n&&t.parent?R(t.parent,e):n}function M(t,e){if(!this.$events.has(t)&&this.$parent)return M.call(this.$parent,t,e);this.$set(t,e)}function T(t){I(this,t)}function j(t){return new T(t)}function X(t){var e=this,n=j(t);return e.$children.push(n),Object.defineProperty(n,"parent",{get:function(){return e}}),n}function q(t){if(!t)return it("element not defined, pass an identifier or an HTMLElement object");var e=(n.isFunction(t.node)?t:r.select(t)).node();if(e)return e;it("could not find "+t+" element")}function k(){document.removeEventListener("DOMContentLoaded",k),window.removeEventListener("load",k),F()}function F(){for(var t=void 0;Qt.length;)t=Qt.shift(),i.timeout(t)}function B(t){var e=this;return new Promise(function(t){t()}).then(function(){return t.call(e)})}function U(t){var e=t.type||"text";return ie[e]||e}function H(t){var e=this.data.children;if(e){if(!n.isArray(e))return ee("children should be an array of fields, for "+(void 0===e?"undefined":ne(e))),t;t.selectAll(".d3form").data(e).enter().append(G).classed("d3form",!0)}return t}function Y(t){t||(t={}),this.data=t;var e=this.model;return re.forEach(function(n){n in t&&e.$set(n,t[n])}),t}function G(t){var e=U(t);return e||(ee("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3"+e)}function V(t){var e=t.formTheme;return!e&&t.parent?V(t.parent):e}function z(t){var e=t.attr("min"),n=t.attr("max");return e=null===e?-1/0:+e,n=null===n?1/0:+n,[e,n]}function J(t,e){return{set:function(e,n){n[t]},validate:function(t,n){return e(t,n)}}}function W(){return n.isArray(this.option)?this.option[0]:this.option}function K(){return n.isArray(this.option)?this.option[1]||this.option[0]:this.option}function Q(t){var e=t.json();this.message(e)}function Z(){window.location.href=this.data.redirectTo||"/"}function tt(t){function e(t){i.setSubmitDone(),i.response(t)}function r(){i.setSubmitDone()}var i=this&&this.model?this.model.form:null;if(!i)return void ee("form not available, cannot submit");t&&(t.preventDefault(),t.stopPropagation());var o=te.fetch,a=(i.data.enctype||"").split(";")[0],s=i.data.action,u=n.isObject(s)?s.url:s,l=i.inputData(),c={};if(!o)return void ee("fetch provider not available, cannot submit");if(!u)return void ee("No url, cannot submit");if("application/json"===a)c.headers={"Content-Type":i.data.enctype},c.body=JSON.stringify(l);else{c.body=new FormData;for(var d in l)c.body.set(d,l[d])}i.setSubmit(),c.method=i.method||"post",o(u,c).then(e,r)}function et(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[required, labelSrOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}function nt(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+e+"</span>\n<slot></slot>\n</div>"}var rt={logger:n.logger,fetch:function(){if(n.inBrowser)return window.fetch}()},it=function(t){rt.logger.warn("[d3-view] "+t)},ot=["disabled","readonly","required"],at={create:function(t){return this.arg?t:it("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,e){return"class"===this.arg?this.refreshClass(e):n.isArray(e)?it("Cannot apply array to attribute "+this.arg):void(ot.indexOf(this.arg)>-1?this.sel.property(this.arg,e||null):this.sel.attr(this.arg,e))},refreshClass:function(t){var e=this.sel;n.isArray(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&e.classed(t,!1)}),this.oldValue=t.map(function(t){var r=!0;return n.isArray(t)&&(r=t[1],t=t[0]),t&&e.classed(t,r),t})}},st={refresh:function(t,e){n.isString(e)&&this.sel.html(e)}},ut=function(t,e){var n=!1;return function(){if(!n){var r=Array.prototype.slice.call(arguments);n=!0,i.timeout(function(){n=!1,t.apply(void 0,r)},e)}}},lt={on:function(t,e){var n=s(this,t,e);r.select(this.el).on("input",n).on("change",n)}},ct={input:a(),textarea:a()},dt={create:function(t){var e=this.sel.attr("type"),n=this.el.tagName.toLowerCase(),r=ct[e]||ct[n];return r?(this.tag=new r(this.el),t):it("Cannot apply d3-value directive to "+n)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return it('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var n=this.expression.expr;return t.$set(n,this.tag.value),this.tag.on(t,n),t},refresh:function(t,e){this.tag.value=e},destroy:function(){this.tag.off()}},ft={mount:function(t){return this.display=this.sel.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){e?this.sel.style("display",this.display):this.sel.style("display","none")}},pt={mount:function(t){var e=this.arg||"click",n=this.expression;this.sel.on(e+"."+this.uid,function(){n.eval(t)})}},ht=["name","class","disabled","readonly","required","href"],mt=function(t,e){var n=r.select(t),i=n.directives();if(i)return i;if(i=new u,!e)return i;for(var o=0;o<t.attributes.length;++o){var a=t.attributes[o],s=a.name.split("-"),l=s[2],c="d3"===s[0]?s[1]:null;if(c){!l&&ht.indexOf(c)>-1&&(l=c,c="attr");var d=e.get(c);d?i.add(d(t,a,l)):it(t.tagName+' cannot find directive "'+c+'". Did you forget to register it?')}i.attrs[a.name]=a.value}return i.size()&&n.directives(i),i};u.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size()){var e=[],r=void 0;return this.forEach(function(i){r=i.execute(t),n.isPromise(r)&&e.push(r)}),e.length?Promise.all(e):void 0}}},r.selection.prototype.mount=f,r.selection.prototype.view=d,r.selection.prototype.model=c,r.selection.prototype.directives=l;var vt={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},gt=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},yt={"-":!0,"!":!0,"~":!0,"+":!0},bt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Et=function(t){var e,n=0;for(var r in t)(e=r.length)>n&&t.hasOwnProperty(r)&&(n=e);return n},wt=Et(yt),xt=Et(bt),Pt={true:!0,false:!1,null:null},_t=function(t){return bt[t]||0},Ot=function(t,e,n){return{type:"||"===t||"&&"===t?vt.LOGICAL_EXP:vt.BINARY_EXP,operator:t,left:e,right:n}},At=function(t){return t>=48&&t<=57},Ct=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!bt[String.fromCharCode(t)]},$t=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!bt[String.fromCharCode(t)]},Lt=function(t){for(var e,n,r=0,i=t.charAt,o=t.charCodeAt,a=function(e){return i.call(t,e)},s=function(e){return o.call(t,e)},u=t.length,l=function(){for(var t=s(r);32===t||9===t;)t=s(++r)},c=function t(){var e,n,i=f();return l(),63!==s(r)?i:(r++,(e=t())||gt("Expected expression",r),l(),58===s(r)?(r++,(n=t())||gt("Expected expression",r),{type:vt.CONDITIONAL_EXP,test:i,consequent:e,alternate:n}):void gt("Expected :",r))},d=function(){l();for(var e=t.substr(r,xt),n=e.length;n>0;){if(bt.hasOwnProperty(e))return r+=n,e;e=e.substr(0,--n)}return!1},f=function(){var t,e,n,i,o,a,s,u;if(a=p(),!(e=d()))return a;for(o={value:e,prec:_t(e)},(s=p())||gt("Expected expression after "+e,r),i=[a,o,s];(e=d())&&0!==(n=_t(e));){for(o={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)s=i.pop(),e=i.pop().value,a=i.pop(),t=Ot(e,a,s),i.push(t);(t=p())||gt("Expected expression after "+e,r),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=Ot(i[u-1].value,i[u-2],t),u-=2;return t},p=function e(){var n,i,o;if(l(),n=s(r),At(n)||46===n)return h();if(39===n||34===n)return m();if(Ct(n)||40===n)return y();if(91===n)return E();for(o=(i=t.substr(r,wt)).length;o>0;){if(yt.hasOwnProperty(i))return r+=o,{type:vt.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},h=function(){for(var t,e,n="";At(s(r));)n+=a(r++);if(46===s(r))for(n+=a(r++);At(s(r));)n+=a(r++);if("e"===(t=a(r))||"E"===t){for(n+=a(r++),"+"!==(t=a(r))&&"-"!==t||(n+=a(r++));At(s(r));)n+=a(r++);At(s(r-1))||gt("Expected exponent ("+n+a(r)+")",r)}return e=s(r),Ct(e)?gt("Variable names cannot start with a number ("+n+a(r)+")",r):46===e&&gt("Unexpected period",r),{type:vt.LITERAL,value:parseFloat(n),raw:n}},m=function(){for(var t,e="",n=a(r++),i=!1;r<u;){if((t=a(r++))===n){i=!0;break}if("\\"===t)switch(t=a(r++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||gt('Unclosed quote after "'+e+'"',r),{type:vt.LITERAL,value:e,raw:n+e+n}},v=function(){var e,n=s(r),i=r;for(Ct(n)?r++:gt("Unexpected "+a(r),r);r<u&&(n=s(r),$t(n));)r++;return e=t.slice(i,r),Pt.hasOwnProperty(e)?{type:vt.LITERAL,value:Pt[e],raw:e}:"this"===e?{type:vt.THIS_EXP}:{type:vt.IDENTIFIER,name:e}},g=function(t){for(var e,n,i=[],o=!1;r<u;){if(l(),(e=s(r))===t){o=!0,r++;break}44===e?r++:((n=c())&&n.type!==vt.COMPOUND||gt("Expected comma",r),i.push(n))}return o||gt("Expected "+String.fromCharCode(t),r),i},y=function(){var t,e;for(e=40===(t=s(r))?b():v(),l(),t=s(r);46===t||91===t||40===t;)r++,46===t?(l(),e={type:vt.MEMBER_EXP,computed:!1,object:e,property:v()}):91===t?(e={type:vt.MEMBER_EXP,computed:!0,object:e,property:c()},l(),93!==(t=s(r))&&gt("Unclosed [",r),r++):40===t&&(e={type:vt.CALL_EXP,arguments:g(41),callee:e}),l(),t=s(r);return e},b=function(){r++;var t=c();if(l(),41===s(r))return r++,t;gt("Unclosed (",r)},E=function(){return r++,{type:vt.ARRAY_EXP,elements:g(93)}},w=[];r<u;)59===(e=s(r))||44===e?r++:(n=c())?w.push(n):r<u&&gt('Unexpected "'+a(r)+'"',r);return 1===w.length?w[0]:{type:vt.COMPOUND,body:w}};Lt.addUnaryOp=function(t){return wt=Math.max(t.length,wt),yt[t]=!0,this},Lt.addBinaryOp=function(t,e){return xt=Math.max(t.length,xt),bt[t]=e,this},Lt.addLiteral=function(t,e){return Pt[t]=e,this},Lt.removeUnaryOp=function(t){return delete yt[t],t.length===wt&&(wt=Et(yt)),this},Lt.removeBinaryOp=function(t){return delete bt[t],t.length===xt&&(xt=Et(bt)),this},Lt.removeLiteral=function(t){return delete Pt[t],this};var It={},Nt={},St={eval:function(t){return h(t,this.parsed)},safeEval:function(t){try{return h(t,this.parsed)}catch(t){it("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return m(this.parsed).values()}};b.prototype=St;var Dt=function(t){return new b(t)},Rt=0,Mt=function(t){var e="d3v"+ ++Rt;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},Tt=function(t){return Object.defineProperty(t,"sel",{get:function(){return r.select(this.el)}}),t},jt={priority:1,create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){var e=this;if(this.expression&&(this.removeAttribute(),t=this.mount(t))){var n=this,r=this.sel,i=function(){try{n.refresh(t,n.expression.eval(t))}catch(t){it('Error while refreshing "'+n.name+'" directive: '+t)}};this.identifiers=this.expression.identifiers().map(function(e){var r=e+"."+n.uid;return t.$on(r,i),e}),r.on("remove."+n.uid,function(){e.identifiers.forEach(function(e){t.$off(e+"."+n.uid)}),n.destroy(t)}),i()}}},Xt=function(t){function e(t,e,n){this.el=t,this.name=e.name,this.arg=n;var r=Tt(Mt(this)).create(e.value);r&&(this.expression=Dt(r))}function r(t,n,r){return new e(t,n,r)}return e.prototype=n.assign({},jt,t),r.prototype=e.prototype,r},qt=function(t){return t&&!n.isFunction(t.size)?r.select(t):t},kt=function(t){if(n.isString(t))try{return JSON.parse(t)}catch(e){return t}return t},Ft={isd3:!0,providers:rt,htmlElement:x,viewElement:x,init:function(){},mounted:function(){},createElement:function(t){return r.select(document.createElement(t))},responseError:function(t){var e=this;t.json().then(function(n){e.error(n,t)})},error:function(t){t.level="error",this.message(t)},message:function(t){var e=this;this.root.events.call("message",e,t)},fetch:function(t,e){var n=rt.fetch;return 1==arguments.length?n(t):n(t,e)},render:function(){},mount:function(t,e){if(!_(this)){var i=r.select(t),o=i.directives(),a=o?o.attrs:L(t),s=i.datum()||{};if(e=this.parent.model.$child(this.model),this.model=e,n.isArray(this.props)){var u,l;this.props.forEach(function(t){u=a[t],l=e[u]?e[u]:kt(u),s[t]=l})}var c=this.render(s,a);if(n.isPromise(c)){var d=this;return c.then(function(e){return $(d,t,e)})}return $(this,t,c)}it("already mounted")}},Bt=function(t){var e=t.split("."),n=e.splice(0,1),r=S(this,n);if(n in r){for(var i=r[n];i&&e.length;)i=i[e.splice(0,1)];return i}},Ut=function(t,e){this.$events.get(t)?this[t]=e:D(this,t,e)},Ht=function(t,e){1===arguments.length&&n.isFunction(t)&&(e=t,t="");var r=t.split("."),i=r[0],o=R(this,i);return o?(this.$events.get(t)||r.push(this.uid),r[0]="change",o.on(r.join("."),e)):it('Cannot bind to "'+i+'" - no such reactive property')},Yt=function(t,e){if(t){e=2!==arguments.length||e;for(var n in t)(e||void 0===this[n])&&("$"===n.substring(0,1)?this.constructor.prototype[n]?it("Cannot set attribute method "+n+", it is protected"):this[n]=t[n]:this.$set(n,t[n]))}return this},Gt=function(t){if(void 0===t)this.$events.each(function(t){t.on("change",null)});else{var e=this.$events.get(t);e&&e.on("change",null)}this.$children.forEach(function(e){e.$off(t)})};j.prototype=T.prototype,T.prototype.$on=Ht,T.prototype.$update=Yt,T.prototype.$get=Bt,T.prototype.$set=Ut,T.prototype.$new=X,T.prototype.$setbase=M,T.prototype.$off=Gt;var Vt=n.assign({},Ft,{use:function(t){return n.isObject(t)?t.install(this):t(this),this},addComponent:function(t,e){if(this.isMounted)return it("already mounted, cannot add component");var n=P(e,Ft);return this.components.set(t,n),n},addDirective:function(t,e){if(this.isMounted)return it("already mounted, cannot add directive");var n=Xt(e);return this.directives.set(t,n),n},mount:function(t,e){if(_(this))it("already mounted");else if(t=q(t)){this.model=this.parent?this.parent.model.$child(this.model):j(this.model);var n=C(this,t);return e?n?n.then(e):e():n}}}),zt=P(null,Vt),Jt={attr:at,html:st,value:dt,show:ft,on:pt,for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?it('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,r.select(this.creator).remove(),this.el)return t},refresh:function(t,e){if(n.isArray(e)){var r=this.creator,i=r.tagName+"."+this.itemClass,o=this.itemName,a=this.sel,s=a.selectAll(i).data(e),u=a.view(),l=void 0;s.enter().append(function(){return r.cloneNode(!0)}).classed(this.itemClass,!0).each(function(t,e){(l={index:e})[o]=t,zt({model:l,parent:u}).mount(this)}),s.exit().remove()}}},if:{refresh:function(t,e){e?this.sel.style("display",null):this.sel.style("display","none")}}},Wt=P(null,Vt,A(e.map(),Jt)),Kt=function(t){Qt.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",k),window.addEventListener("load",k)):F()},Qt=[],Zt=function(t){var e=this;return new Promise(function(r,i){try{n.inBrowser?window.require(t,function(){r.apply(this,arguments)}):r.apply(e,require(t))}catch(t){i(t)}})},te={logger:n.logger},ee=function(t){te.logger.warn("[d3-form] "+t)},ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re=["labelSrOnly","layout"],ie={text:"input",password:"input",number:"input"},oe={render:function(t){var e=this.createElement("fieldset");return Y.call(this,t),H.call(this,e)}},ae={wrap:function(t){var e=this,n=V(e),r=n?n[t.attr("type")]||n[t.node().tagName.toLowerCase()]:null;if(!r||!n.wrappers)return t;var i,o=t;return r.forEach(function(r){i=n.wrappers[r],i?o=i.call(e,o,t):ee("Could not find form field wrapper "+r)}),o},wrapTemplate:function(t,e){var n=document.createElement("div"),i=r.select(n).html(e).select("slot");if(!i.size())return ee("template does not provide a slot element"),t;var o=r.select(i.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),i.remove(),r.selectAll(n.children)}},se=n.assign({model:{error:"",isDirty:!1,showError:{reactOn:["error","isDirty","formSubmitted"],get:function(){return!!this.error&&(this.isDirty||this.formSubmitted)}}},mounted:function(){this.model.$on("value",function(){this.isDirty=!0})},inputData:function(t){return(t=Y.call(this,t)).name||ee("Input field without a name"),t.placeholder=t.placeholder||t.label||t.name,t.id=t.id||"d3f"+this.uid,this.model.inputs[t.name]=this.model,t}},ae),ue={get:function(t,e){var r=this.all.slice(0);if(n.isObject(e))for(var i in e)r.push(J(i,e[i]));return r},set:function(t,e){var n=this;t.model.validators.forEach(function(n){n.set(e,t.data)}),t.model.$on(function(e){return n.validate(e,t)})},validate:function(t,e){if("value"===t){for(var n,r,i=e.model,o=i.validators,a=i.value,s=e.sel.attr("id")===e.data.id?e.sel:e.sel.select("#"+e.data.id),u=0;u<o.length;++u)if(n=o[u],r=n.validate(s,a)){!0===r&&(r="");break}i.error=r||""}},all:[{set:function(t,e){var r=e.required;n.isString(r)?t.attr("d3-required",r):t.property("required",r||null)},validate:function(t,e){if(t.property("required")){if(!e)return"required"}else if(""===e)return!0}},{set:function(t,e){var r=e.minlength;n.isString(r)?t.attr("d3-attr-minlength",r):void 0!==r&&t.attr("minlength",r)},validate:function(t,e){var n=+t.attr("minlength");if(n===n&&n>0&&e.length<n)return"too short - "+n+" characters or more expected"}},{set:function(t,e){var r=e.maxlength;n.isString(r)?t.attr("d3-attr-maxlength",r):void 0!==r&&t.attr("maxlength",r)},validate:function(t,e){var n=+t.attr("maxlength");if(n===n&&n>0&&e.length>n)return"too long - "+n+" characters or less expected"}},{set:function(t,e){var r=e.min;n.isString(r)?t.attr("d3-attr-min",r):void 0!==r&&t.attr("min",r)},validate:function(t,e){var n=z(t);if(n&&+e<n[0])return"must be greater or equal "+n[0]}},{set:function(t,e){var r=e.max;n.isString(r)?t.attr("d3-attr-max",r):void 0!==r&&t.attr("max",r)},validate:function(t,e){var n=z(t);if(n&&+e>n[1])return"must be less or equal "+n[1]}}]},le={default:Q,redirect:Z},ce={submit:tt},de={props:["json"],model:{formSubmitted:!1,formPending:!1},components:{d3fieldset:oe,d3input:n.assign({render:function(t){t=this.inputData(t);var e=this.createElement("input").attr("id",t.id).attr("type",t.type||"text").attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return ue.set(this,e),this.wrap(e)}},se),d3textarea:n.assign({render:function(t){t=this.inputData(t);var e=this.createElement("textarea").attr("id",t.id).attr("name",t.name).attr("placeholder",t.placeholder).attr("d3-value","value").attr("d3-validate","validators");return ue.set(this,e),this.wrap(e)}},se),d3select:n.assign({},se,{model:n.assign({options:[],$optionLabel:K,$optionValue:W},se.model),render:function(t){t=this.inputData(t);var e=this.createElement("select").attr("id",t.id).attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return this.model.options=t.options,e.append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),ue.set(this,e),this.wrap(e)}}),d3submit:n.assign({render:function(t){(t=Y.call(this,t)).type=t.type||"submit",this.model.$set("error",!1),n.isString(t.disabled)||(this.model.$set("disabled",t.disabled||null),t.disabled="disabled"),t.click||(t.click="$vm.click()");var e=this.createElement("button").attr("type",t.type).attr("name",t.name).attr("d3-attr-disabled",t.disabled).attr("d3-on-click",t.click).html(t.label||"submit");return this.wrap(e)},click:function(){this.model.form.actions.submit.call(this,r.event)}},ae)},render:function(t){function e(e){Y.call(o,e),r.validators=ue.get(r,t.validators),o.actions={};for(var a in ce){var s=o.data[a];n.isString(s)&&(s=o.model.$get(s)),o.actions[a]=s||ce[a]}return H.call(o,i),i}var r=this.model,i=this.createElement("form").attr("novalidate",""),o=this;r.inputs={},r.form=this;var a=t.json;return n.isString(a)?(0,te.fetch)(a,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(e);ee("Could not load form from "+a+": status "+t.status)}):e(a)},inputData:function(){var t,e=this.model.inputs,n={};for(var r in e)void 0!==(t=e[r].value)&&(n[r]=t);return n},setSubmit:function(){var t=this;return this.model.formSubmitted=!0,this.model.formPending=!0,B.call(this,function(){return t.isValid()})},setSubmitDone:function(){this.model.formPending=!1},isValid:function(){for(var t in this.model.inputs)if(this.model.inputs[t].error)return!1;return!0},inputError:function(t){this.model.inputs[t.name]||(ee("Unknown input, cannot set input error"),this.error(t))},response:function(t){if(t){var e;if(t.status)t.status<300?this.data.resultHandler?(e=le[this.data.resultHandler])?e.call(this,t):ee("Could not find "+this.data.resultHandler+" result handler"):le.default.call(this,t):this.responseError(t);else if(t.error)this.error(t.error);else if(n.isArray(t.errors)){var r=this;t.errors.forEach(function(t){r.inputError(t)})}else this.data.resultHandler?(e=le[this.data.resultHandler])?e.call(this,t):ee("Could not find "+this.data.resultHandler+" result handler"):le.default.call(this,t)}}},fe={install:function(t){t.addComponent("d3form",de);for(var e in t.providers)te[e]=t.providers[e]},actions:ce,responses:le},pe={input:["inputGroup","label","formGroup"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t){return this.wrapTemplate(t,et(this.data))},formGroup:function(t,e){return e.classed("form-control",!0).attr("d3-class",'showError ? "form-control-danger" : null'),this.wrapTemplate(t,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e){var n=this.data.group;if(!n)return t;var r="g"+e.attr("id");return e.attr("aria-describedby",r),this.wrapTemplate(t,nt(r,n))},submit:function(t,e){var n=this.data.theme||"primary";return e.classed("btn",!0).classed("btn-"+n,!0),this.wrapTemplate(t,'<div class="form-group">\n<slot></slot>\n</div>')}}},he={install:function(t){var e=t.components.get("d3form");e&&(e.prototype.formTheme=pe)}};t.view=Wt,t.viewModel=j,t.viewExpression=Dt,t.viewReady=Kt,t.viewProviders=rt,t.viewWarn=it,t.viewRequire=Zt,t.viewForms=fe,t.viewBootstrapForms=he,t.viewUid=Mt,t.viewDebounce=ut,t.viewVersion="0.3.0",t.viewElement=x,t.viewTemplate=E,t.viewHtml=w,Object.defineProperty(t,"__esModule",{value:!0})});