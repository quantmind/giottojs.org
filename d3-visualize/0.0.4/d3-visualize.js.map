{"version":3,"file":"d3-visualize.js","sources":["../src/utils/randompath.js","../src/data/array.js","../src/data/warn.js","../src/utils/isurl.js","../src/data/remote.js","../src/data/expression.js","../src/data/sources.js","../src/data/store.js","../src/data/locale.js","../src/core/options.js","../src/utils/round.js","../src/utils/size.js","../src/core/base.js","../src/core/visual.js","../src/core/group.js","../src/components/dashboard.js","../src/components/visual.js","../src/utils/warn.js","../src/data/formatters.js","../src/utils/columns.js","../src/plugins/clusterize.js","../src/plugins/paginate.js","../src/plugins/bootstrap.js","../src/plugins/responsive.js","../src/plugins/title.js","../src/plugins/index.js","../src/components/tabular.js","../src/components/index.js"],"sourcesContent":["import assign from 'object-assign';\nimport {range} from 'd3-array';\nimport {randomNormal} from 'd3-random';\n\n\nconst defaults = {\n    sigma: 0.1,\n    drift: 0\n};\n\n\nexport default function (size, options) {\n    options = assign({}, defaults, options);\n    var t = range(0, +size, 1),\n        S = options.sigma,\n        drift = options.drift,\n        data = [{x: 0, y: 0}],\n        norm = randomNormal(0, 1),\n        dx;\n\n    for (var i = 1; i < t.length; i++) {\n        dx = drift + S * norm();\n        data[i] = {\n            x: i,\n            y: data[i - 1].y + dx\n        };\n    }\n\n    return data;\n}\n","import {isArray, isObject, pop} from 'd3-let';\n\n\nexport default {\n\n    init (config) {\n        if (isArray(config)) return {data: config};\n        else if (isObject(config) && isArray(config.data)) return config;\n    },\n\n    load () {\n        return pop(this.config, 'data');\n    }\n};\n","import {viewProviders} from 'd3-view';\n\nconst prefix = '[d3-data-source]';\n\n\nexport default function (msg) {\n    viewProviders.logger.warn(`${prefix} ${msg}`);\n}\n","import {isString} from 'd3-let';\n\n\nconst schemes = ['http', 'https', 'ws', 'wss'];\n\n\nexport default function (value) {\n    return isString(value) && schemes.indexOf(value.split('://')[0]) > -1;\n}\n","import {csvParse} from 'd3-dsv';\nimport {isObject} from 'd3-let';\nimport {viewProviders} from 'd3-view';\n\nimport warn from './warn';\nimport isUrl from '../utils/isurl';\n\n//\n//  Remote dataSource\n//  ===================\n//\n//  handle Json and csv data\nexport default {\n\n    init (config) {\n        if (isUrl(config)) return {url: config};\n        else if (isObject(config) && config.url)\n            return config;\n    },\n\n    load () {\n        var fetch = viewProviders.fetch;\n        if (!fetch) {\n            warn('fetch provider not available, cannot submit');\n            return;\n        }\n        return fetch(this.url).then(parse);\n    }\n};\n\n\nfunction parse (response) {\n    var ct = (response.headers.get('content-type') || '').split(';')[0];\n    if (ct === 'text/plain' || ct === 'text/csv')\n        return response.text().then(csvParse);\n    else if (ct === 'application/json')\n        return response.json();\n    else {\n        warn(`Cannot load content type '${ct}'`);\n        return [];\n    }\n}\n","import {isString, isObject} from 'd3-let';\nimport {viewExpression} from 'd3-view';\n\nimport isUrl from '../utils/isurl';\n\n\nexport default {\n\n    init (config) {\n        var opts;\n        if (isUrl(config)) return;\n        else if (isString(config)) return {expression: config};\n        else if (isObject(config) && config.type === 'expression')\n            return config;\n            opts = config;\n        if (opts) {\n            this.name = opts.name || this.dataName();\n            this.expression = viewExpression(opts.expression);\n            return this;\n        }\n    },\n\n    load () {\n        if (!this.expression) this.expression = viewExpression(this.config.expression);\n        var model = this.store.model;\n        return this.expression.eval(model);\n    }\n};\n","import assign from 'object-assign';\nimport {map} from 'd3-collection';\nimport {dispatch} from 'd3-dispatch';\nimport {isPromise, pop} from 'd3-let';\nimport crossfilter from 'crossfilter';\n\n\nconst dataEvents = dispatch('init', 'data');\n\n\nconst dataSourcePrototype = {\n\n    init () {\n\n    },\n\n    size () {\n        return this.cf.size();\n    },\n\n    load () {\n\n    },\n\n    data (cfg, data) {\n        if (arguments.length === 2)\n            return this.add(data);\n        else {\n            var self = this;\n            data = this.load();\n            if (isPromise(data))\n                return data.then((d) => {\n                    self.data(cfg, d);\n                });\n            return this.data(cfg, data);\n        }\n    },\n\n    // add data to the serie\n    add (data) {\n        if (!data) return this;\n        var size = this.size();\n        data = data.map((entry) => {\n            if (typeof entry === 'object') entry._id = ++size;\n            else entry = {_id: ++size, data: entry};\n            return entry;\n        });\n        this.cf.add(data);\n        dataEvents.call('data', this, data);\n        return this;\n    }\n};\n\n\n// DataSource container\nexport default assign(map(), {\n    events: dataEvents,\n\n    add (type, source) {\n\n        function DataSource (config, store) {\n            initDataSource(this, type, config, store);\n        }\n\n        DataSource.prototype = assign({}, dataSourcePrototype, source);\n\n        this.set(type, DataSource);\n        return DataSource;\n    },\n\n    // Create a DataSource for a dataStore\n    create (config, store) {\n        var sources = this.values(),\n            cfg;\n        for (var i=0; i<sources.length; ++i) {\n            cfg = sources[i].prototype.init(config);\n            if (cfg) return new sources[i](cfg, store);\n        }\n    }\n});\n\n\nfunction initDataSource(dataSource, type, config, store) {\n\n    var name = store.dataName(pop(config, 'name')),\n        cf = crossfilter();\n\n    // store.natural = cf.dimension(d => d._id);\n\n    Object.defineProperties(dataSource, {\n        cf: {\n            get () {\n                return cf;\n            }\n        },\n        name: {\n            get () {\n                return name;\n            }\n        },\n        store: {\n            get () {\n                return store;\n            }\n        },\n        type: {\n            get () {\n                return type;\n            }\n        },\n        config: {\n            get () {\n                return config;\n            }\n        }\n    });\n\n    store.series.set(name, dataSource);\n    dataEvents.call('init', dataSource);\n    // load data\n    dataSource.data();\n}\n","import {map} from 'd3-collection';\n\nimport array from './array';\nimport remote from './remote';\nimport expression from './expression';\nimport dataSources from './sources';\n\n\ndataSources.add('array', array);\ndataSources.add('remote', remote);\ndataSources.add('expression', expression);\n\n//\n//  DataStore\n//  ==============\n//\n//  Map names to datasets\n//  Individual data sets are assumed to contain a collection of records\n//  (or “rows”), which may contain any number of named data\n//  attributes (fields, or “columns”).\n//  Records are modeled using standard JavaScript objects.\nexport default function DataStore(model) {\n    var series = map();\n\n    Object.defineProperties(this, {\n        series: {\n            get () {\n                return series;\n            }\n        }\n    });\n\n    this.dataCount = 0;\n    this.model = model;\n}\n\n\nDataStore.prototype = {\n    size () {\n        return this.series.size();\n    },\n\n    // Add a new serie from a data source\n    add (config) {\n        return dataSources.create(config, this);\n    },\n\n    // set, get or remove data by datasource name\n    serie (name, serie) {\n        if (arguments.length === 1) return this.series.get(name);\n        if (serie === null) {\n            var p = this.series.get(name);\n            this.series.remove(name);\n            return p;\n        }\n        this.series.set(name, serie);\n        return this;\n    },\n\n    dataName (name) {\n        this.dataCount++;\n        if (name) return '' + name;\n        var def = this.serie('default');\n        if (!def) return 'default';\n        return `serie${this.dataCount}`;\n    }\n};\n","// utility to load and set locale\nimport {formatDefaultLocale} from 'd3-format';\nimport {timeFormatDefaultLocale, timeFormat} from 'd3-time-format';\n\nimport dataSources from './sources';\n\n//\n// manage locale\nexport default {\n    formatDate: timeFormat('%d/%m/%Y'),\n\n    formatDateTime: timeFormat('%a %e %b %X %Y'),\n\n    load (symbol) {\n        var locales = this,\n            source1 = dataSources.create(`https://unpkg.com/d3-format/locale/${symbol}.json`),\n            source2 = dataSources.create(`https://unpkg.com/d3-time-format/locale/${symbol}.json`);\n\n        return Promise.all([\n            source1.load().then(\n                locale => {\n                    locales.symbol = symbol;\n                    locales.number = locale;\n                    formatDefaultLocale(locale);\n                }\n            ),\n            source2.load().then(\n                locale => {\n                    locales.time = locale;\n                    locales.formatDate = timeFormat(locale.date);\n                    locales.formatDateTime = timeFormat(locale.dateTime);\n                    timeFormatDefaultLocale(locale);\n                }\n            )\n        ]);\n    }\n};\n","//\n//  Global options for visuals\n//  ============================\n//\nexport default {\n    // visual data source\n    dataSource: null,\n    //\n    size: {\n        // width set by the parent element\n        width: null,\n        // height set as percentage of width\n        height: '70%'\n    }\n};\n","export default function (x, n) {\n    return n ? Math.round(x * (n = Math.pow(10, n))) / n : Math.round(x);\n}\n","import {select} from 'd3-canvas-transition';\n\nimport round from './round';\n\n\nconst WIDTH = 400;\nconst HEIGHT = '75%';\n\n\n// Internal function for evaluating paper dom size\nexport function getSize (element, options) {\n    var size = {\n        width: options.width,\n        height: options.height\n    };\n\n    if (!size.width) {\n        size.width = getWidth(element);\n        if (size.width)\n            size.widthElement = getWidthElement(element);\n        else\n            size.width = WIDTH;\n    }\n\n    if (!size.height) {\n        size.height = getHeight(element);\n        if (size.height)\n            size.heightElement = getHeightElement(element);\n        else\n            size.height = HEIGHT;\n    }\n\n    // Allow to specify height as a percentage of width\n    if (typeof(size.height) === \"string\" && size.height.indexOf('%') === size.height.length-1) {\n        size.heightPercentage = 0.01*parseFloat(size.height);\n        size.height = round(size.heightPercentage*size.width);\n    }\n\n    return size;\n}\n\n\nexport function getWidth (element) {\n    var el = getParentElementRect(element, 'width');\n    if (el) return elementWidth(el);\n}\n\n\nexport function getHeight (element) {\n    var el = getParentElementRect(element, 'width');\n    if (el) return elementHeight(el);\n}\n\n\nexport function getWidthElement (element) {\n    return getParentElementRect(element, 'width');\n}\n\n\nexport function getHeightElement (element) {\n    return getParentElementRect(element, 'height');\n}\n\n\nfunction elementWidth (el) {\n    var w = el.getBoundingClientRect()['width'],\n        s = select(el),\n        left = padding(s.style('padding-left')),\n        right = padding(s.style('padding-right'));\n    return w - left - right;\n}\n\n\nfunction elementHeight (el) {\n    var w = el.getBoundingClientRect()['height'],\n        s = select(el),\n        top = padding(s.style('padding-top')),\n        bottom = padding(s.style('padding-bottom'));\n    return w - top - bottom;\n}\n\n\nfunction getParentElementRect (element, key) {\n    let parent = element.node ? element.node() : element,\n        v;\n    while (parent && parent.tagName !== 'BODY') {\n        v = parent.getBoundingClientRect()[key];\n        if (v)\n            return parent;\n        parent = parent.parentNode;\n    }\n}\n\n\nfunction padding (value) {\n    if (value && value.substring(value.length-2) == 'px')\n        return +value.substring(0, value.length-2);\n    return 0;\n}\n\n\nexport function boundingBox (size) {\n    var w = size.widthElement ? getWidth(size.widthElement) : size.width,\n        h;\n    if (size.heightPercentage)\n        h = round(w*size.heightPercentage, 0);\n    else\n        h = size.heightElement ? getHeight(size.heightElement) : size.height;\n    if (size.minHeight)\n        h = Math.max(h, size.minHeight);\n    return [round(w), round(h)];\n}\n","import assign from 'object-assign';\nimport {dispatch} from 'd3-dispatch';\nimport {select} from 'd3-canvas-transition';\nimport {viewBase} from 'd3-view';\n\nimport globalOptions from './options';\nimport {getSize, boundingBox} from '../utils/size';\n\n\nexport const liveVisuals = [];\nexport const visualTypes = {};\nexport const visualEvents = dispatch('init', 'before-draw', 'after-draw');\n\n//\n//  Visual Interface\n//  ====================\n//\n//  Base prototype object for visuals\n//\nconst visualPrototype = assign({}, {\n\n    // initialise the visual with options\n    initialise () {\n\n    },\n\n    // draw this visual\n    draw () {\n\n    },\n\n    select (el) {\n        return select(el);\n    },\n\n    // destroy the visual\n    destroy () {\n\n    }\n}, viewBase);\n\n\n//\n//  Root element\n//  ================\n//\n//  Controls the size of a a visual or visuals within a group\n//  It does not control margins\nexport function RootElement (element, options) {\n\n    Object.defineProperties(this, {\n        element: {\n            get () {\n                return element;\n            }\n        },\n        sel: {\n            get () {\n                return select(element);\n            }\n        },\n        size: {\n            get () {\n                return [this.width, this.height];\n            }\n        }\n    });\n    this.width = options.width;\n    this.height = options.height;\n    this.sel.classed('d3-visual-root', true);\n}\n\n\nRootElement.prototype = {\n    select (el) {\n        return select(el);\n    },\n\n    // Fit the root element to the size of the parent element\n    fit () {\n        var size = getSize(this.element, this);\n        this.width = size.width;\n        this.height = size.height;\n    },\n\n    resize (visual, size) {\n        if (!size) size = boundingBox(this);\n        var currentSize = this.size;\n\n        if (currentSize[0] !== size[0] || currentSize[1] !== size[1]) {\n            this.root.width = size[0];\n            this.root.height = size[1];\n            visualEvents.call('before-draw', visual);\n            visual.draw();\n            visualEvents.call('after-draw', visual);\n        }\n    }\n};\n\n//\n//  Create a new Visual Constructor\nexport default function (type, proto) {\n\n    function Visual(element, options) {\n        options = assign({}, globalOptions[type], options);\n\n        Object.defineProperties(this, {\n            visualType : {\n                get () {\n                    return type;\n                }\n            },\n            element: {\n                get: function () {\n                    return element;\n                }\n            }\n        });\n        this.initialise(element, options);\n        visualEvents.call('init', this, options);\n    }\n\n    Visual.prototype = assign({}, visualPrototype, proto);\n    visualTypes[type] = Visual;\n    return Visual;\n}\n","import createVisual, {visualTypes} from './base';\n\n\nexport default createVisual('visual', {\n\n    initialise (options, element) {\n        if (!options.group)\n            options.group = new visualTypes.group(options, element);\n        this.group = options.group;\n        // var type = options.type;\n    }\n});\n","import createVisual, {RootElement, liveVisuals} from './base';\nimport Visual from './visual';\nimport globalOptions from './options';\n\n\nglobalOptions.visualGroup = {\n    render: 'svg'\n};\n\n//\n//  VisualGroup\n//  =============\n//\n//  A VisualGroup is a specialized Visual associated with an HTML element\n//  and containing one or more visuals\n//\n//  Usually a VisualGroup contains one visual only, however it is possible to\n//  have more than one by combining several visuals together. Importantly,\n//  visuals in one group generate HTMLElement which are children of the group\n//  element and inherit both the width and height.\n//\n//  A group register itself with the liveVisuals array\n//\nexport default createVisual('group', {\n\n    initialise (options, element) {\n        var self = this;\n        if (!element) throw new Error('HTMLElement required by visual group');\n        this.root = new RootElement(element, options);\n        liveVisuals.push(this);\n\n        Object.defineProperties(this, {\n            group : {\n                get () {\n                    return self;\n                }\n            }\n        });\n    },\n\n    // Add a new visual to this group\n    addVisual (options) {\n        options.group = this;\n        this.visuals.push(new Visual(options));\n    },\n\n    //\n    // Resize the visual group if it needs resizing\n    //\n    resize (size) {\n        this.root.resize(this, size);\n    },\n\n    destroy () {\n        var idx = liveVisuals.indexOf(this);\n        if (idx > -1) {\n            liveVisuals.splice(idx, 1);\n            this.visuals.forEach(visual => visual.destroy());\n        }\n    }\n});\n","import assign from 'object-assign';\nimport {isString, isObject} from 'd3-let';\n\nimport DataStore from '../data/store';\n\n//\n//  vizComponent base prototype\n//  =============================\n//\n//  Some common properties and methods for all visualize components\n//\nexport const vizComponent = {\n    props: [\n\t\t'schema',\t    // Schema is a collection of fields to display in the table\n\t\t'datasource',\t// Data source for table\n        'plugins',      // list of string/objects which add table plugins\n\t],\n\n    render (props, attrs, el) {\n        var self = this,\n            // inner visuals\n            inner = this.select(el).html(),\n            store = this.model.dataStore;\n\n        if (!store) {\n            store = new DataStore(this.model);\n            this.model.dataStore = store;\n        }\n\n        return this.getSchema(props.schema, schema => {\n            if (!isObject(schema)) schema = {};\n            return self.build(schema, inner);\n        });\n    },\n\n    getSchema (input, build) {\n        if (isString(input)) {\n            return this.json(input).then(build);\n        }\n        else return build(input);\n    },\n\n    createGroup () {\n        var model = this.model;\n        // Set itself as the visualGroup\n        model.visualGroup = model;\n        // object containing visuals by name!??\n        model.visuals = {};\n        return model;\n    },\n    //\n    // build the visual component has the schema available\n    build () {}\n};\n//\n//  Dashboard Component\n//  ========================\n//\n//  A collection of visual components arranged according\n//  to a custom layout.\n//\n//  * Dashboard visuals are independent of each other but\n//    interact via the data object\n//  * The Dashboard layout is given by the inner HTML elements\n//  * The configuration is obtained via the schema property which\n//    can be either:\n//      1) an object\n//      2) a url\nexport default assign({}, {\n\n    build (schema, inner) {\n        this.createGroup();\n        // model.visuals = schema.visuals;\n        // self.model.$set('dashboard', schema);\n        return this.createElement('div')\n            .classed('dashboard', true)\n            .html(inner).mount();\n    }\n\n}, vizComponent);\n","import assign from 'object-assign';\n\nimport {vizComponent} from './dashboard';\n\n\n// Visual component\nexport default assign({}, vizComponent, {\n\n    build (schema) {\n        var model = this.model,\n            visualGroup = model.visualGroup;\n        // no visual group, the visual is not used in a group\n        // create its own group\n        if (!visualGroup) {\n            visualGroup = this.createGroup();\n        } else {\n            visualGroup.visuals[schema.name] = model;\n        }\n    }\n});\n","import {viewProviders} from 'd3-view';\n\nconst prefix = '[d3-visualize]';\n\n\nexport default function (msg) {\n    viewProviders.logger.warn(`${prefix} ${msg}`);\n}\n","import {isoParse} from 'd3-time-format';\n\nimport locale from './locale';\n\n\nexport const parsers = {\n    date: isoParse,\n\n    string (value) {\n        return ''+value;\n    }\n};\n\n// formatters\nexport const formatters = {\n\n    number (value) {\n        return value;\n    },\n\n    date (value) {\n        return locale.formatDate(value);\n    },\n\n    boolean (value) {\n        return value;\n    }\n};\n","import {isObject, isArray} from 'd3-let';\n\nimport {formatters, parsers} from '../data/formatters';\n\n\n//\n// Create table columns from schema\nexport default function (schema) {\n    var columns = [];\n    let col;\n\n\tif (!schema) return columns;\n\n    if (isArray(schema))\n        schema = {properties: schema};\n\n    if (isObject(schema.properties)) {\n        for (let key in schema.properties) {\n            col = schema.properties[key];\n            if (isObject(col)) {\n                if (!col.name) col.name = key;\n                columns.push(col);\n            }\n        }\n    } else\n        columns.push(...schema.properties);\n\n    return columns.map((col) => {\n        if (!isObject(col)) col = {name: col};\n        if (!col.label) col.label = col.name;\n        if (!col.hidden) col.hidden = false;\n        if (!col.$parse) col.$parse = parsers[col.type] || parsers.string;\n        if (!col.$html) col.$html = formatters[col.type] || $html;\n        return col;\n    });\n}\n\n\nfunction $html (value) {\n    return value;\n}\n","import {require} from 'd3-require';\n//\n// Use clusterize.js to render the table\nexport default function (table, options) {\n    return require('clusterize.js@0.17.6').then(Clusterize => clusterize(Clusterize, table, options));\n}\n\n\nfunction clusterize(Clusterize) {\n    var cl = new Clusterize();\n    return cl;\n}\n","export default function (table) {\n    return table;\n}\n","//\n//  bootstrap styling for tabular component\n//  ==========================================\n//\nimport assign from 'object-assign';\n\n\nconst defaults = {\n    over: true,\n    small: true,\n    bordered: true,\n    loadingClass: 'table-info',\n    loadingTextClass: 'text-center'\n};\n\n\nexport default function (table, options) {\n    var style = table.model.style;\n    style.$update(assign({}, defaults, options));\n\n    style.tableClass = 'table table-responsive';\n    if (style.striped) style.tableClass += ' table-striped';\n    if (style.over) style.tableClass += ' table-hover';\n    if (style.bordered) style.tableClass += ' table-bordered';\n    if (style.small) style.tableClass += ' table-sm';\n}\n","import {inBrowser} from 'd3-let';\nimport {viewDebounce} from 'd3-view';\nimport {select} from 'd3-selection';\n\nimport {liveVisuals} from '../core/base';\nimport globalOptions from '../core/options';\n\n\nif (!globalOptions.resizeDelay)\n    globalOptions.resizeDelay = 200;\n\n\nif (inBrowser) {\n    var resize = viewDebounce(() => {\n        liveVisuals.forEach(p => p.resize());\n    }, globalOptions.resizeDelay);\n\n    select(window).on('resize.visuals', resize);\n}\n","// Title plot annotation\nimport {isString} from 'd3-let';\n\nimport {visualEvents} from '../core/base';\n\n\nvisualEvents.on('init.title', title);\n\n\nfunction title (options) {\n    var title = options.title || {};\n    if (isString(title)) title = {text: title};\n    this.title = title;\n}\n","//\n//  Plugins for visuals and tabular\n//\n//  This module depends on core but not on components\nimport clusterize from './clusterize';\nimport paginate from './paginate';\nimport bootstrap from './bootstrap';\n\n// visual plugins\nimport './responsive';\nimport './title';\n\n// plugins add functionalities to a d3 table\n// A plugin is a function accepting two parameters:\n//  * the table component\n//  * object with configuration parameters\nexport default {\n    bootstrap,\n    clusterize,\n    paginate\n};\n","// import {timeout} from 'd3-timer';\nimport assign from 'object-assign';\nimport {isString, isArray, isPromise} from 'd3-let';\n\nimport warn from '../utils/warn';\nimport createColumns from '../utils/columns';\nimport tablePlugins from '../plugins/index';\nimport {vizComponent} from './dashboard';\n\n\nconst tableTpl = `<table d3-class=\"[style.tableClass, loadingData ? 'loading' : null]\">\n<thead d3-class=\"style.headerClass\">\n<tr d3-class=\"style.headerRowClass\">\n  <th d3-for=\"col in columns\"\n        d3-html=\"col.label\"\n        d3-if=\"!col.hidden\">\n  </th>\n</tr>\n<tr d3-if=\"loadingData\" d3-class=\"style.loadingClass\">\n    <td d3-attr-colspan=\"columns.length\">\n        <p d3-class=\"style.loadingTextClass\">loading data</p>\n    </td>\n</tr>\n</thead>\n<tbody></tbody>\n</table>`;\n\n\nexport default assign({}, vizComponent, {\n\n\tmodel () {\n        return {\n            header: true,            // show header\n            columns: [],             // table columns\n            loadingData: false,\n            style: {\n                tableClass: null,\n                headerClass: null,\n                headerRowClass: null,\n                loadingClass: 'loading',\n                loadingTextClass: null\n            }\n        };\n\t},\n\n\tbuild (schema) {\n\t\tvar self = this,\n            model = this.model,\n            plugins = schema.plugins || [];\n        // model.allData = crossfilter([]);\n        this.records = {};\n        this.data = [];\n        this.template = tableTpl;\n\n\t\tmodel.columns = createColumns(schema);\n\t\t// if (data.dataurl) model.dataLoader = new DataLoader(data.dataurl);\n\n        if (!isArray(plugins)) {\n            warn('plugins should be an array');\n        } else {\n            var promises = [];\n            let promise;\n            plugins.forEach(plugin => {\n                if (isString(plugin)) plugin = {name: plugin};\n                if (!tablePlugins[plugin.name])\n                    warn(`Unknown table plugin ${plugin.name}`);\n                else {\n                    promise = tablePlugins[plugin.name](self, plugin);\n                    if (isPromise(promise)) promises.push(promise);\n                }\n            });\n            if (promises.length)\n                 return Promise.all(promises).then(() => self.viewElement(self.template));\n        }\n\n\t\treturn this.viewElement(this.template);\n\t},\n\n\tmounted () {\n        var vm = this,\n            model = this.model;\n\t\tif (model.dataLoader) {\n\t\t\tvar p = model.dataLoader.load(model.columns);\n            if (p) {\n                model.loadingData = true;\n                p.then((data) => {\n                    // var allData = model.allData;\n                    model.loadingData = false;\n                    addData(vm, data);\n                }, (err) => {\n                    model.loadingData = false;\n                    return err;\n                });\n            }\n        }\n\t}\n});\n\n// new data to include in the table\nfunction addData (vm, newData) {\n    var records = vm.records,\n        data = vm.data,\n        model = vm.model,\n        delayData = newData;\n\n    let record, value;\n\n    newData = delayData.splice(0, 100);\n\n    newData.forEach((d) => {\n        if (d.id) {\n            record = d.id ? records[d.id] : null;\n            if (record)\n                d = assign(record, d);\n            else {\n                data.push(d);\n                records[d.id] = d;\n            }\n        } else\n            data.push(d);\n        model.columns.forEach((col) => {\n            d[col.name] = col.$parse(d[col.name]);\n        });\n    });\n\n    //if (delayData.length)\n    //    timeout(() => addData(vm, delayData));\n\n    var rows = vm.sel.select('tbody')\n                .selectAll('tr').data(data);\n\n    rows\n        .enter()\n            .append('tr')\n            .attr('scope', 'row')\n            .selectAll('td')\n            .data(model.columns)\n            .enter()\n                .append('td')\n                .style('display', (col) => {\n                    return col.hidden ? 'none' : null;\n                })\n                .html(function (col) {\n                    record = this.parentNode.__data__;\n                    value = record[col.name];\n                    return col.$html(value === undefined ? '' : value);\n                });\n}\n","//\n//  d3-view components\n//  ======================\n//\n//  d3-view plugin for visualization components\n//\nimport dashboard from './dashboard';\nimport visual from './visual';\nimport tabular from './tabular';\nimport tabularPlugins from '../plugins/index';\n\n\n// Visual components plugin\nexport default {\n    tabularPlugins,\n\n    install (vm) {\n        vm.addComponent('dashboard', dashboard);\n        vm.addComponent('visual', visual);\n        vm.addComponent('tabular', tabular);\n    }\n\n};\n"],"names":["defaults","size","options","assign","t","range","S","sigma","drift","data","x","y","norm","randomNormal","dx","i","length","config","isArray","isObject","pop","prefix","msg","logger","warn","schemes","value","isString","indexOf","split","isUrl","url","fetch","viewProviders","then","parse","response","ct","headers","get","text","csvParse","json","opts","expression","type","name","dataName","viewExpression","model","store","eval","dataEvents","dispatch","dataSourcePrototype","cf","cfg","arguments","add","self","load","isPromise","d","map","entry","_id","call","source","DataSource","prototype","set","sources","values","init","initDataSource","dataSource","crossfilter","defineProperties","series","dataSources","array","remote","DataStore","dataCount","create","serie","p","remove","def","timeFormat","symbol","locales","source1","source2","Promise","all","number","locale","time","formatDate","date","formatDateTime","dateTime","n","Math","round","pow","WIDTH","HEIGHT","getSize","element","width","height","getWidth","widthElement","getWidthElement","getHeight","heightElement","getHeightElement","heightPercentage","parseFloat","el","getParentElementRect","elementWidth","elementHeight","w","getBoundingClientRect","s","select","left","padding","style","right","top","bottom","key","parent","node","v","tagName","parentNode","substring","boundingBox","h","minHeight","max","liveVisuals","visualTypes","visualEvents","visualPrototype","viewBase","RootElement","sel","classed","visual","currentSize","root","draw","proto","Visual","globalOptions","initialise","createVisual","group","visualGroup","Error","push","visuals","resize","idx","splice","forEach","destroy","vizComponent","props","attrs","html","dataStore","getSchema","schema","build","inner","input","createGroup","createElement","mount","parsers","isoParse","formatters","columns","col","properties","label","hidden","$parse","string","$html","table","require","clusterize","Clusterize","cl","$update","tableClass","striped","over","bordered","small","resizeDelay","inBrowser","viewDebounce","window","on","title","tableTpl","plugins","records","template","createColumns","promises","promise","plugin","tablePlugins","viewElement","vm","dataLoader","loadingData","err","addData","newData","delayData","record","id","rows","selectAll","enter","append","attr","__data__","undefined","addComponent","dashboard","tabular"],"mappings":"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"}