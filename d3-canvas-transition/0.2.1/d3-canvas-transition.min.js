// https://github.com/quantmind/d3-canvas-transition Version 0.2.1. Copyright 2016 undefined.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-transition"),require("d3-collection"),require("d3-timer"),require("d3-color"),require("d3-selection")):"function"==typeof define&&define.amd?define("d3-canvas-transition",["exports","d3-transition","d3-collection","d3-timer","d3-color","d3-selection"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o){"use strict";function a(t,e,n,r){return{pen:t,time:e,data:n,index:r||0}}function s(){return new u}function u(){this._head=null,this._tail=null,this._length=0,Object.defineProperty(this,"length",{get:function(){return this._length}})}function c(t,e,n){for(var r=t.split(" "),i=0;i<r.length;++i){t=r[i];for(var o=t.split("."),a=o[0],s=o.splice(1).join(" "),u=e._head;u;){if(!a||u.tag===a)if(s&&u.class!==s);else{if(!n)return u;n.push(u)}u=u._next}}return n}function l(t){var e=t.attrs.get("stroke");if(e&&"none"!==e){e=i.color(e);var n=t.getValue("stroke-opacity");return(n||0===n)&&(e.opacity=n),t.context.strokeStyle=""+e,t.context.lineWidth=t.factor*(t.getValue("stroke-width")||1),t.context.stroke(),e}}function h(t){var e=t.attrs.get("fill");if(e&&"none"!==e){e=i.color(e);var n=t.getValue("fill-opacity");return(n||0===n)&&(e.opacity=n),t.context.fillStyle=""+e,t.context.fill(),e}}function f(t,e){if(e){var n,r,i,o=e.indexOf("translate(");return o>-1&&(r=e.substring(o+10),n=r.indexOf(")"),i=r.substring(0,n).split(","),t.context.translate(t.factor*i[0],t.factor*i[1])),!0}}function d(t){var e=t.attrs;t.context.moveTo(t.factor*(e.get("x1")||0),t.factor*(e.get("y1")||0)),t.context.lineTo(t.factor*e.get("x2"),t.factor*e.get("y2"))}function p(t){var e=_(t);t.context.textAlign=H[t.getValue("text-anchor")]||H.middle,t.context.textBaseline=t.getValue("text-baseline")||G,t.context.fillText(t.textContent||"",v(t,"x",e),v(t,"y",e))}function y(t,e){e&&("function"==typeof e.draw?e.draw(t):e.context&&e.context(t.context)())}function _(t){for(var e=[],n=0,r=void 0,i=void 0,o=0;o<J.length;++o)r=J[o],i=t.getValue("font-"+r),i&&("size"===r&&(n=t.factor*i,i=n+"px"),e.push(i));return n&&(t.context.font=e.join(" ")),n}function v(t,e,n){var r=t.attrs.get(e)||0,i=t.attrs.get("d"+e)||0;return i&&("em"==i.substring(i.length-2)?i=n*i.substring(0,i.length-2):"px"==i.substring(i.length-2)&&(i=+i.substring(0,i.length-2))),t.factor*(r+i)}function g(t,e){t._touches||(t._touches=0),t._touches+=e,t._touches&&!t._inloop&&(t._inloop=r.timeout(x(t)))}function x(t){return function(){var e=t.context;t._touches=0,e.beginPath(),e.closePath(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),t.draw(),t._inloop=!1,g(t,0)}}function m(t,n){var r=this.node();return r instanceof K&&a.test(t,n)?e.transition.prototype.attrTween.call(this,t,k(n)):Q.call(this,t,n)}function k(t){return function(e,n){return function(r){return a(t,r,e,n)}}}function b(t,e){e||(e=X());var n=o.selection();return n._groups[0][0]=new K(t,e),n}function w(t,e){if(arguments.length>1){var n=this._parents[0]||this.node();n instanceof K&&a.test(t,e)&&(arguments[1]=a(e,1))}return Y.apply(this,arguments)}function q(t){return t}function A(t,e,n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"}function P(t,e,n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"}function O(t){var e=t.bandwidth()/2;return function(n){return t(n)+e}}function j(t,e){function n(n){var c=null==i?e.ticks?e.ticks.apply(e,r):e.domain():i,l=null==o?e.tickFormat?e.tickFormat.apply(e,r):q:o,h=Math.max(a,0)+u,f=t===$||t===et?A:P,d=e.range(),p=d[0],y=d[d.length-1],_=(e.bandwidth?O:q)(e.copy()),v=n.selection?n.selection():n,g=v.selectAll(".domain").data([null]),x=v.selectAll(".tick").data(c,e).order(),m=x.exit(),k=x.enter().append("g",".domain").attr("class","tick"),b=x.select("line"),w=x.select("text");switch(g=g.merge(g.enter().append("line").attr("class","domain")),x=x.merge(k),b=b.merge(k.append("line")),w=w.merge(k.append("text")),n!==v&&(g=g.transition(n),x=x.transition(n),m=m.transition(n).style("opacity",rt).attr("transform",function(t){return f(_,this.parentNode.__axis||_,t)}),k.style("opacity",rt).attr("transform",function(t){return f(this.parentNode.__axis||_,_,t)}),b=b.transition(n),w=w.transition(n)),x.style("opacity",1).attr("transform",function(t){return f(_,_,t)}),m.remove(),w.text(l),t){case $:g.attr("x1",p).attr("y1",-s).attr("x2",y).attr("y2",-s),b.attr("x2",0).attr("y2",-a),w.attr("x",0).attr("y",-h).attr("dy","0em").style("text-anchor","middle");break;case tt:g.attr("x1",s).attr("y1",p).attr("x2",s).attr("y2",y),b.attr("y2",0).attr("x2",a),w.attr("y",0).attr("x",h).attr("dy",".32em").style("text-anchor","start");break;case et:g.attr("x1",p).attr("y1",s).attr("x2",y).attr("y2",s),b.attr("x2",0).attr("y2",a),w.attr("x",0).attr("y",h).attr("dy",".71em").style("text-anchor","middle");break;case nt:g.attr("x1",-s).attr("y1",p).attr("x2",-s).attr("y2",y),b.attr("y2",0).attr("x2",-a),w.attr("y",0).attr("x",-h).attr("dy",".32em").style("text-anchor","end")}v.each(function(){this.__axis=_})}var r=[],i=null,o=null,a=6,s=6,u=3;return n.scale=function(t){return arguments.length?(e=t,n):e},n.ticks=function(){return r=Z.call(arguments),n},n.tickArguments=function(t){return arguments.length?(r=null==t?[]:Z.call(t),n):r.slice()},n.tickValues=function(t){return arguments.length?(i=null==t?null:Z.call(t),n):i&&i.slice()},n.tickFormat=function(t){return arguments.length?(o=t,n):o},n.tickSize=function(t){return arguments.length?(a=s=+t,n):a},n.tickSizeInner=function(t){return arguments.length?(a=+t,n):a},n.tickSizeOuter=function(t){return arguments.length?(s=+t,n):s},n.tickPadding=function(t){return arguments.length?(u=+t,n):u},n}function S(t){return j($,t)}function V(t){return j(tt,t)}function C(t){return j(et,t)}function N(t){return j(nt,t)}var T=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},E=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),F=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},z=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},R=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},B=function(){function t(e){T(this,t),this.factor=e||1,this.time=1/0,this.data1=[]}return E(t,[{key:"update",value:function(t){this.pen=t.pen,this.time=t.time,this.current=t.data}},{key:"draw",value:function(t){t.context.beginPath(),this.pen.context(t.context)()}},{key:"accessor",value:function(t,e){var n,r,i=this.factor,o=this.data0,a=this.data1,s=this.time;return function(u,c){return n=o[c][e],r=void 0===n?i*t(u):i*(s*t(u)+(1-s)*n),a[c][e]=r,r}}}]),t}(),D=function(t){function e(){return T(this,e),R(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return z(e,t),E(e,[{key:"update",value:function(t){if(t.time<this.time){for(var n=this.data1;n.length<t.data.length;)n.push(new Array(2));this.data0=this.data1,this.x=t.pen.x(),this.y=t.pen.y()}F(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t)}},{key:"draw",value:function(t){t.context.beginPath(),this.pen.context(t.context).x(this.accessor(this.x,0)).y(this.accessor(this.y,1))(this.current)}}]),e}(B),I={symbol:B,line:D,arc:D,area:D},M=function(t,e,n){var r=t.attrs.get(e);if(r===n)return!1;if("d"===e&&n&&n.pen){if(!r){var i=I[n.pen.name];r=new i(t.factor),t.attrs.set(e,r)}return r.update(n),!0}return t.attrs.set(e,n),!0};a.test=function(t,e){return"d"===t&&e&&"function"==typeof e.context},u.prototype=s.prototype={prepend:function(t,e){this._length?e?(t._prev=e._prev,t._next=e,e._prev&&(e._prev.next=t),e._prev=t):(t._prev=this._tail,t._next=null,this._tail._next=t):(t._prev=null,t._next=null),t._prev||(this._head=t),t._next||(this._tail=t),this._length++},remove:function(t){t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),this._head===t&&(this._head=t._next),this._tail===t&&(this._tail=t._prev),delete t._prev,delete t._next,this._length--},list:function t(){for(var e=this._head,t=[];e;)t.push(e),e=e._next;return t},each:function(t){for(var e=this._head;e;)t(e),e=e._next}};var L="canvas",U="line",W="text",G="middle",H={start:"start",middle:"center",end:"end"},J=["style","variant","weight","size","family"],K=function(){function t(e,n){T(this,t),this.context=e,this.factor=n||1}return E(t,[{key:"querySelectorAll",value:function(t){return this._deque?"*"===t?this.childNodes:c(t,this._deque,[]):[]}},{key:"querySelector",value:function(t){if(this._deque)return"*"===t?this._deque._head:c(t,this._deque)}},{key:"createElementNS",value:function(e,n){var r=new t(this.context,this.factor);return r.tag=n,r}},{key:"hasChildNodes",value:function(){return!!this._deque&&this._deque.length>0}},{key:"contains",value:function(t){for(;t;){if(t._parent==this)return!0;t=t._parent}return!1}},{key:"appendChild",value:function(t){return this.insertBefore(t)}},{key:"insertBefore",value:function(e,n){if(e===this)throw Error("inserting self into children");if(!(e instanceof t))throw Error("Cannot insert a non canvas element into a canvas element");return e._parent&&e._parent.removeChild(e),this._deque||(this._deque=s()),this._deque.prepend(e,n),e._parent=this,g(this.root,1),e}},{key:"removeChild",value:function(t){if(t._parent===this)return delete t._parent,this._deque.remove(t),g(this.root,1),t}},{key:"setAttribute",value:function(t,e){"class"===t?this.class=e:"id"===t?this.id=e:(this.attrs||(this.attrs=n.map()),M(this,t,e)&&g(this.root,1))}},{key:"removeAttribute",value:function(t){this.attrs&&(this.attrs.remove(t),g(this.root,1))}},{key:"getAttribute",value:function(t){if(this.attrs)return this.attrs.get(t)}},{key:"draw",value:function(t){var e=this.context,n=this.attrs;n&&(e.save(),f(this,this.attrs.get("transform")),e.save(),this.tag===U?d(this):this.tag===W?p(this):y(this,n.get("d"),t),h(this),l(this),e.restore()),this._deque&&this._deque.each(function(e){e.draw(t)}),n&&e.restore()}},{key:"each",value:function(t){this._deque&&this._deque.each(t)}},{key:"getValue",value:function(t){var e=this.getAttribute(t);return void 0===e&&this._parent?this._parent.getValue(t):e}},{key:"removeProperty",value:function(t){this.removeAttribute(t)}},{key:"setProperty",value:function(t,e){this.setAttribute(t,e)}},{key:"getProperty",value:function(t){return this.getAttribute(t)}},{key:"getPropertyValue",value:function(t){return this.getAttribute(t)}},{key:"getComputedStyle",value:function(){return this}},{key:"onStart",value:function(){}},{key:"childNodes",get:function(){return this._deque?this._deque.list():[]}},{key:"firstChild",get:function(){return this._deque?this._deque._head:null}},{key:"lastChild",get:function(){return this._deque?this._deque._tail:null}},{key:"parentNode",get:function(){return this._parent}},{key:"previousSibling",get:function(){return this._prev}},{key:"nextSibling",get:function(){return this._next}},{key:"namespaceURI",get:function(){return L}},{key:"countNodes",get:function(){return this._deque?this._deque._length:0}},{key:"root",get:function(){return this._parent?this._parent.root:this}},{key:"ownerDocument",get:function(){return this}},{key:"style",get:function(){return this}},{key:"defaultView",get:function(){return this}},{key:"document",get:function(){return this}}]),t}(),Q=e.transition.prototype.attr;e.transition.prototype.attr=m;var X=function(t){return t||window.devicePixelRatio||1};b.prototype=o.selection.prototype;var Y=b.prototype.attr;b.prototype.attr=w;var Z=Array.prototype.slice,$=1,tt=2,et=3,nt=4,rt=1e-6,it="0.2.1";t.tweenAttr=m,t.selection=b,t.resolution=X,t.CanvasElement=K,t.fontProperties=J,t.axisTop=S,t.axisRight=V,t.axisBottom=C,t.axisLeft=N,t.canvasVersion=it,t.creator=o.creator,t.matcher=o.matcher,t.mouse=o.mouse,t.namespace=o.namespace,t.namespaces=o.namespaces,t.select=o.select,t.selectAll=o.selectAll,t.selector=o.selector,t.selectorAll=o.selectorAll,t.touch=o.touch,t.touches=o.touches,t.window=o.window,t.event=o.event,Object.defineProperty(t,"__esModule",{value:!0})});