// d3-visualize Version 0.2.0. Copyright 2017 quantmind.com.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("object-assign"),require("d3-array"),require("d3-random"),require("d3-collection"),require("d3-let"),require("d3-view"),require("d3-dsv"),require("d3-dispatch"),require("crossfilter"),require("d3-time-format"),require("d3-selection"),require("d3-transition"),require("d3-scale"),require("d3-format"),require("d3-axis"),require("d3-shape"),require("d3-color"),require("d3-svg-legend")):"function"==typeof define&&define.amd?define(["exports","object-assign","d3-array","d3-random","d3-collection","d3-let","d3-view","d3-dsv","d3-dispatch","crossfilter","d3-time-format","d3-selection","d3-transition","d3-scale","d3-format","d3-axis","d3-shape","d3-color","d3-svg-legend"],e):e(t.d3=t.d3||{},t.assign,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.crossfilter,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,a,o,s,l,u,c,d,h,f,p,g,m,v,y){"use strict";function x(t){var e=(t.headers.get("content-type")||"").split(";")[0];return ht.has(e)?t.text().then(s.csvParse):"application/json"===e?t.json():(ut("Cannot load content type '"+e+"'"),[])}function w(t,e,n){a.isArray(t)&&(t={store:n,data:t,dimensions:{},series:i.map()}),Object.defineProperties(this,{_inner:{get:function(){return t}},store:{get:function(){return t.store}},data:{get:function(){return t.data}},dimensions:{get:function(){return t.dimensions}},series:{get:function(){return t.series}}}),this.serie=e}function b(t,e){return t.reduce(function(t,n){return void 0!==e(n)&&(t+=1),t},0)}function k(t,e){var n=void 0;return e?(e.forEach(function(e){e&&(n=e(t),a.isArray(n)?t=t.new(n):n&&(t=n))}),t):t}function S(t,e,n,r){var i=r.dataName(a.pop(n,"name")),o=[];Object.defineProperties(t,{name:{get:function(){return i}},store:{get:function(){return r}},type:{get:function(){return e}},transforms:{get:function(){return o}},config:{get:function(){return n}}}),t.initialise(n),t.addTransforms(a.pop(n,"transforms")),r.sources.set(i,t),Ft.call("init",void 0,t)}function M(t){var n=i.map();Object.defineProperties(this,{sources:{get:function(){return n}}}),this.transforms=e({},qt),this.dataCount=0,this.model=t}function z(t,e){return"string"==typeof t&&t.indexOf("%")===t.length-1?Et(.01*parseFloat(t)*e):+t}function A(t,e){var n={width:e.width,height:e.height};return n.width||(n.width=_(t),n.width?n.widthElement=P(t):n.width=Yt),n.height||(n.height=O(t),n.height?n.heightElement=T(t):n.height=Ht),n.height=z(n.height,n.width),n}function _(t){var e=q(t,"width");if(e)return C(e)}function O(t){var e=q(t,"width");if(e)return W(e)}function P(t){return q(t,"width")}function T(t){return q(t,"height")}function C(t){var e=t.getBoundingClientRect().width,n=d.select(t);return e-F(n.style("padding-left"))-F(n.style("padding-right"))}function W(t){var e=t.getBoundingClientRect().height,n=d.select(t);return e-F(n.style("padding-top"))-F(n.style("padding-bottom"))}function q(t,e){for(var n=t.node?t.node():t;n&&"BODY"!==n.tagName;){if(n.getBoundingClientRect()[e])return n;n=n.parentNode}}function F(t){return t&&"px"==t.substring(t.length-2)?+t.substring(0,t.length-2):0}function D(t){if(a.isArray(t))return t.map(D);if(a.isObject(t)){var e={};for(var n in t)e[n]=D(t[n]);return e}return t}function j(t){t.forEach(function(t){var e=t.removedNodes;e&&e.length&&e.forEach(function(t){"#text"!==t.nodeName&&(t.__visual__?E.call(t):d.select(t).selectAll(".d3-visual").each(E))})})}function E(){var t=this.__visual__;t?(t.destroy(),o.viewDebug('Removed "'+t.toString()+'" from DOM, '+Bt.live.length+" live visuals left")):wt("d3-visual without __visual__ object")}function Y(t,n){function r(e){var n=this.initialise(e);Object.defineProperties(this,{element:{get:function(){return n}},sel:{get:function(){return d.select(n)}},paperType:{get:function(){return t}}})}return r.prototype=e({},Kt,n),Bt.papers[t]=r,r}function H(t){var e=t.getModel("menu"),n=t.dim(e.height,t.height,e.minHeight,e.maxHeight);t.menu.style("height",n+"px")}function R(t){var e=t.dataStore,n=a.pop(t.options,"data");e||(e=new M(t.getModel("dataContext")),t.model.root.dataStore=e),e.addSources(n)}function B(t){var e=t.dataStore,n=a.pop(t,"data");n&&(a.isString(n)&&(n={source:n}),n.name||(n.name=t.model.uid),n=e.addSources(n),n?t.model.$set("data",n.name):wt("Could not create data source "+n.name))}function X(t,e,n){var r=L(t.menu.style("height")),i=e.maxFontSize?Math.min(r-4,e.maxFontSize):r-4,a=n.dim(e.fontSize,t.width,e.minFontSize,i);t.menu.select(".title").html(e.text).style("font-size",a+"px").style("line-height",r+"px")}function L(t){return+t.substring(0,t.length-2)}function V(t,e){var n=e.options[t];if(void 0!==n&&!a.isObject(n)){var r=n||0;e.options[t]={left:r,right:r,top:r,bottom:r}}}function N(t,e,n){return ee.reduce(function(r,i){return r[i]=z(t[i],ne.indexOf(i)>-1?e:n),r},{})}function G(t,e,n,r){var i=re.get(t)(e).tickSize(n.tickSize);return null!==n.tickSizeOuter&&i.tickSizeOuter(n.tickSizeOuter),a.isDate(r)?i.tickFormat(c.timeFormat(n.timeFormat)):null!==n.format&&i.tickFormat(p.format(n.format)),i.ticks(n.ticks)}function $(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function I(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function K(t,e,n){return{x:e.width-t.width-n.offsetX,y:e.total.top+(e.innerHeight-t.height)/2}}function U(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function Z(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function J(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}}function Q(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function tt(t,e,n){return{x:e.width-t.width-n.offsetX,y:e.height-t.height-n.offsetY}}function et(){function t(t){var c=this;t.each(function(d,h){d=d.map(o).sort(n.ascending);var p=d.length,g=d[0],m=d[p-1],v=d.quartiles=l(d),y=s&&s(d),x=y&&y.map(function(t){return d[t]}),w=y?n.range(0,y[0]).concat(n.range(y[1]+1,p)):n.range(p),b=f.scaleLinear().domain(a&&a.call(c,d,h)||[g,m]).range([r,0]),k=c.__chart__||f.scaleLinear().domain([0,1/0]).range(b.range());c.__chart__=b;var S=t.selectAll("line.center").data(x?[x]:[]);S.enter().insert("line","rect").attr("class","center").attr("x1",e/2).attr("y1",function(t){return k(t[0])}).attr("x2",e/2).attr("y2",function(t){return k(t[1])}).style("opacity",1e-6).transition().duration(i).style("opacity",1).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}),S.transition().duration(i).style("opacity",1).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}),S.exit().transition().duration(i).style("opacity",1e-6).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}).remove();var M=t.selectAll("rect.box").data([v]);M.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(t){return k(t[2])}).attr("width",e).attr("height",function(t){return k(t[0])-k(t[2])}).transition().duration(i).attr("y",function(t){return b(t[2])}).attr("height",function(t){return b(t[0])-b(t[2])}),M.transition().duration(i).attr("y",function(t){return b(t[2])}).attr("height",function(t){return b(t[0])-b(t[2])});var z=t.selectAll("line.median").data([v[1]]);z.enter().append("line").attr("class","median").attr("x1",0).attr("y1",k).attr("x2",e).attr("y2",k).transition().duration(i).attr("y1",b).attr("y2",b),z.transition().duration(i).attr("y1",b).attr("y2",b);var A=t.selectAll("line.whisker").data(x||[]);A.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",k).attr("x2",e).attr("y2",k).style("opacity",1e-6).transition().duration(i).attr("y1",b).attr("y2",b).style("opacity",1),A.transition().duration(i).attr("y1",b).attr("y2",b).style("opacity",1),A.exit().transition().duration(i).attr("y1",b).attr("y2",b).style("opacity",1e-6).remove();var _=t.selectAll("circle.outlier").data(w,Number);_.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",function(t){return k(d[t])}).style("opacity",1e-6).transition().duration(i).attr("cy",function(t){return b(d[t])}).style("opacity",1),_.transition().duration(i).attr("cy",function(t){return b(d[t])}).style("opacity",1),_.exit().transition().duration(i).attr("cy",function(t){return b(d[t])}).style("opacity",1e-6).remove();var O=u||b.tickFormat(8),P=t.selectAll("text.box").data(v);P.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(t,e){return 1&e?6:-6}).attr("x",function(t,n){return 1&n?e:0}).attr("y",k).attr("text-anchor",function(t,e){return 1&e?"start":"end"}).text(O).transition().duration(i).attr("y",b),P.transition().duration(i).text(O).attr("y",b);var T=t.selectAll("text.whisker").data(x||[]);T.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",k).text(O).style("opacity",1e-6).transition().duration(i).attr("y",b).style("opacity",1),T.transition().duration(i).text(O).attr("y",b).style("opacity",1),T.exit().transition().duration(i).attr("y",b).style("opacity",1e-6).remove()})}var e=1,r=1,i=0,a=null,o=Number,s=nt,l=rt,u=null;return t.width=function(n){return arguments.length?(e=n,t):e},t.height=function(e){return arguments.length?(r=e,t):r},t.tickFormat=function(e){return arguments.length?(u=e,t):u},t.duration=function(e){return arguments.length?(i=e,t):i},t.domain=function(e){return arguments.length?(a=null===e?e:ue(e),t):a},t.value=function(e){return arguments.length?(o=e,t):o},t.whiskers=function(e){return arguments.length?(s=e,t):s},t.quartiles=function(e){return arguments.length?(l=e,t):l},t}function nt(t){return[0,t.length-1]}function rt(t){return[n.quantile(t,.25),n.quantile(t,.5),n.quantile(t,.75)]}function it(t,e,n,r){this.data=t,this.stacked=r,this.x=e,this.y=n}function at(t){return t}e=e&&e.hasOwnProperty("default")?e.default:e,u=u&&u.hasOwnProperty("default")?u.default:u;var ot={sigma:.1,drift:0},st=function(t,i){i=e({},ot,i);for(var a,o=n.range(0,+t,1),s=i.sigma,l=i.drift,u=[{x:0,y:0}],c=r.randomNormal(0,1),d=1;d<o.length;d++)a=l+s*c(),u[d]={x:d,y:u[d-1].y+a};return u},lt={initialise:function(t){this._data=t.data},getConfig:function(t){return a.isArray(t)?{data:t}:a.isObject(t)&&a.isArray(t.data)?t:void 0},getData:function(){return o.resolvedPromise(this.asFrame(this._data))}},ut=function(t){o.viewProviders.logger.warn("[d3-data-source] "+t)},ct=["http","https","ws","wss"],dt=function(t){return a.isString(t)&&ct.indexOf(t.split("://")[0])>-1},ht=i.set(["text/plain","text/csv","application/vnd.ms-excel"]),ft={getConfig:function(t){return dt(t)?{url:t}:a.isObject(t)&&t.url?t:void 0},initialise:function(t){this.url=t.url},getData:function(){var t=o.viewProviders.fetch,e=this;return t?t(this.url).then(x).then(function(t){return e.asFrame(t)}):(ut("fetch provider not available, cannot submit"),[])}},pt={initialise:function(t){this.source=t.source},getConfig:function(t){if(a.isObject(t)&&t.source)return a.isArray(t.source)||(t.source=[t.source]),t},getData:function(){var t=this.store,e=this.source,n=this;return Promise.all(e.map(function(e){return t.getData(e)})).then(function(t){return 1===t.length?t[0]:n.config.merge?n.mergeFrames(t):t.reduce(function(t,n,r){return t[e[r]]=n,t},{type:"frameCollection"})})},mergeFrames:function(t){return t[0]}},gt={initialise:function(t){this.expression=o.viewExpression(t.expression)},getConfig:function(t){if(a.isObject(t)&&t.expression)return t},getData:function(){var t=this,e=this.store.model,n=this.expression.eval(e);return a.isPromise(n)?n.then(function(e){return t.asFrame(e)}):t.asFrame(n)}},mt=function(t){return function(e){return e[t]}};w.prototype={size:function(){return this.data.length},new:function(t){return a.isArray(t)?new w(t,null,this.store):new w(this._inner,t)},cf:function(){return this._inner.cf||(this._inner.cf=u(this.data)),this._inner.cf},dimension:function(t,e,n){1===arguments.length&&(n=!0);var r=this.dimensions[t];if(r){if(n)return r;r.dispose()}return e||(e=mt(t)),this.dimensions[t]=this.cf().dimension(e),this.dimensions[t]},sortby:function(t,e){return this.new(this.dimension(t).top(e||1/0))},pivot:function(t,e,n,r){function i(i){var a=void 0,o=void 0;return function(s,l){return a=""+l[e],o=i*l[n],s[t]=l[t],a in s?s[a]+=o:s[a]=o,r in s?s[r]+=o:s[r]=o,s}}var a=this.dimension(t).group();return r||(r="total"),this.new(a.reduce(i(1),i(-1),Object).all().map(function(t){return t.value}))},add:function(){},map:function(t){return this.new(this.data.map(t))}};var vt=function(t){function e(t){function e(e){return n(e,t)}return i.validate(t)?e:i.logError()}var n=t.transform,r=t.schema||{},i=o.viewProviders.jsonValidator?o.viewProviders.jsonValidator(t.schema):yt;return r.type||(r.type="object"),e.schema=r,e},yt={validate:function(){return!0}},xt=vt({schema:{description:"The filter transform removes objects from a data frame based on a provided filter expression",properties:{expr:{type:"string"}},required:["expr"]},transform:function(t,e){var n=o.viewExpression(e.expr);return t.data.reduce(function(e,r,i){return n.safeEval({d:r,index:i,frame:t})&&e.push(r),e},[])}}),wt=function(t){o.viewProviders.logger.warn("[d3-visualize] "+t)},bt=function(t,e){var n=new Array(t);return n.fill(e),n},kt=i.map({count:b,max:n.max,min:n.min,sum:n.sum,mean:n.mean,median:n.median,variance:n.variance,deviation:n.deviation}),St=i.map({count:function(t){return t+1},sum:function(t,e){return t+e},max:Math.max,min:Math.min}),Mt=function(t){function e(t){var e=void 0;return t.data.reduce(function(t,n){for(e in n)e in t?t[e]+=1:t[e]=1;return t},{})}function n(t){var e,n,a=[];return l?r(t):(i.forEach(function(r,i){e=o[i],n=b,e&&((n=kt.get(e))||(n=b,wt("Operation "+o[i]+" is not supported, use count"))),a.push({label:s[i]||r,data:n(t.data,function(t){return t[r]})})}),a)}function r(t){var e=void 0,n=void 0,r=void 0,a=i.map(function(t,e){return n=o[e],r=St.get("count"),n&&((r=St.get(n))||(r=St.get("count"),wt("Operation "+n+" is not supported, use count"))),{field:t,as:s[e]||t,op:r}});return t.dimension(l).group().reduce(function(t,n){return a.reduce(function(t,r){return e=0,r.as in t&&(e=t[r.as]),t[r.as]=r.op(e,n[r.field]),t},t)},null,Object).all().map(function(t){return t.value[l]=t.key,t.value})}var i=t.fields,o=t.ops,s=t.as,l=t.groupby;return i||o?a.isArray(i)?(o||(o="count"),a.isString(o)&&(o=bt(i.length,o)),a.isArray(o)?(o.length<i.length&&wt("Aggregate transforms expects an ops array with same length as fields"),s||(s=[]),a.isArray(s)?n:wt("Aggregate transform expects an array of as fields")):wt("Aggregate transform expects an array of ops")):wt("Aggregate transforms expect an array of fields"):e},zt=function(t){function e(t){var e=void 0,i=void 0;return n.forEach(function(n,o){i=r[o],a.isString(i)&&(i=t.store.eval(i)),e=t.dimension(n).filterAll(),i&&e.filter(i)}),e?t.new(e.top(1/0)):t}var n=t.fields,r=t.query;return a.isArray(n)?a.isArray(r)?r.length!=n.length?wt("crossfilter transform expects an query array with same length as fields"):e:wt("crossfilter transform expects an array of query"):wt("crossfilter transform expects an array of fields")},At=function(t){function e(t){if(n){if(r){var e,i=t.dimension(r),a=i.group().top(1/0),o=t.new([]);return a.forEach(function(r){e=t.new(i.filterExact(r.key).top(1/0)).dimension(n).group().top(1/0),o.series.set(r.key,t.new(e).dimension("key").top(1/0))}),o}return t.new(t.dimension(n).top(1/0))}return t}var n=t.sortby,r=t.groupby;return n||wt('timeseries transform requires a "sortby" entry'),e},_t={dataSource:null,size:{width:null,height:"70%"}};_t.dateFormat="%d-%b-%y";var Ot={date:function(t){return c.utcParse(t.dateFormat||_t.dateFormat)},number:function(){return parseFloat}},Pt=vt({shema:{description:"map a field values into another type",properties:{fields:{type:"object"},dateFormat:{type:"string"}},required:["fields"]},transform:function(t,e){var n=i.map(e.fields),r=[],o=void 0,s=void 0;return n.each(function(t,e){a.isString(t)&&(t={type:t}),s=Ot[t.type],s?r.push([e,s(t)]):wt("Cannot convert field "+e+" to type "+t.type)}),r.length&&(t=t.map(function(t){for(o=0;o<r.length;++o)t[r[o][0]]=r[o][1](t[r[o][0]]);return t})),t}}),Tt=function(t,e,n){return Math.max(Math.min(t,n),e)},Ct=vt({shema:{description:"Create moving average series from existing one. The new series override the existing one unless the as array is provided",properties:{method:{type:"string"},alpha:{type:"number"},period:{type:"number"},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}}},required:["fields"]},transform:function(t,e){var n=e.as||[],r=e.method||"ema",i=void 0,a=void 0,o=void 0;e.fields.forEach(function(s,l){if(i=n[l]||s,"sma"===r){var u=Math.max(e.period||10,1),c=[],d=[];t.data.forEach(function(t,e){a=t[s],c.length===u&&(a-=d.splice(0,1)[0]),d.push(a),e&&(a+=c[c.length-1]),c.push(a),t[i]=a/c.length})}else{var h=Tt(e.alpha||.5,1-.999999,.999999);t.data.forEach(function(t,e){a=t[s],o=e?h*o+(1-h)*a:a,t[i]=o})}})}}),Wt=vt({schema:{description:"Group entries which are below a given aggregate cutoff",properties:{field:{type:"string"},cutoff:{type:"number"}},required:["field","cutoff"]},transform:function(t,e){var r=mt(e.field),i=n.sum(t.data,r),a=[],o=0;return t.dimension(e.field).bottom(1/0).reduce(function(t,n){return o+=r(n),o/i<e.cutoff?a.push(n):a?(a.push(n),n={label:"other",children:a},n[e.field]=o,a=null,t.push(n)):t.push(n),t},[])}}),qt=i.map({filter:xt,aggregate:Mt,mapfields:Pt,timeseries:At,crossfilter:zt,movingaverage:Ct,groupsmall:Wt}),Ft=l.dispatch("init","data"),Dt={getConfig:function(){},initialise:function(){},getData:function(){},addTransforms:function(t){var e=this,n=void 0;t&&(a.isArray(t)||(t=[t]),t.forEach(function(t){n=qt.get(t.type),n?e.transforms.push(n(t)):wt('Transform type "'+t.type+'" not known')}))},asFrame:function(t){return a.isArray(t)&&(t=t.map(function(t){return t.constructor!==Object&&(t={data:t}),t}),t=new w(t,null,this.store)),k(t,this.transforms)}},jt=e(i.map(),{events:Ft,add:function(t,n){function r(e,n){S(this,t,e,n)}return r.prototype=e({},Dt,n),this.set(t,r),r},create:function(t,e){for(var n,r=this.values(),i=0;i<r.length;++i)if(n=r[i].prototype.getConfig(t))return new r[i](n,e)}});jt.add("array",lt),jt.add("remote",ft),jt.add("composite",pt),jt.add("expression",gt),M.prototype={size:function(){return this.sources.size()},addSources:function(t){if(a.isString(t)&&(t={source:t}),a.isArray(t)){var e=this;return t.map(function(t){return jt.create(t,e)})}if(t)return jt.create(t,this)},addTransforms:function(t){e(this.transforms,t)},source:function(t,e){if(1===arguments.length)return this.sources.get(t);if(null===e){var n=this.sources.get(t);return this.sources.remove(t),n}return this.sources.set(t,e),this},clearCache:function(){this.sources.each(function(t){delete t.cachedFrame})},getData:function(t){var e=this.sources.get(t);if(!e)throw new Error("Data source "+t+" not available");if(e.cachedFrame)return o.resolvedPromise(e.cachedFrame);var n=e.getData();return a.isPromise(n)||(n=o.resolvedPromise(n)),n.then(function(t){return e.config.cache&&(e.cachedFrame=t),t})},eval:function(t,e){var n=this.model;return e&&(n=n.$child(e)),o.viewExpression(t).safeEval(n)},dataName:function(t){return this.dataCount++,t?""+t:this.source("default")?"source"+this.dataCount:"default"}};var Et=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},Yt=400,Ht="75%",Rt=["visual","container"],Bt={live:[],types:{},papers:{},options:_t,events:l.dispatch("before-init","after-init","before-draw","after-draw")},Xt=e({},{initialise:function(){},draw:function(){},redraw:function(t){if(this.drawing){var e=this,n="after-draw."+this.toString();Bt.events.on(n,function(){Bt.events.on(n,null),e.redraw(t)})}else this.drawing=this.draw(t);return this.drawing},select:function(t){return d.select(t)},destroy:function(){},toString:function(){return this.visualType+"-"+this.model.uid},getModel:function(t){t||(t=this.visualType);var e=this.model[t];if(!e&&t in _t){var n=a.pop(this.options,t),r=this;this.visualParent?e=this.visualParent.getModel(t).$child(n):(e=this.model.$new(_t[t]),e.$update(n)),this.model[t]=e,e.$on(function(){return r.redraw(!1)})}return e},dim:function(t,e,n,r){return t=Math.max(z(t,e),n||0),r&&(r=Math.max(r,n||0),t=Math.min(t,r)),t},pop:function(t){if(t){var e=t.live.indexOf(this);e>-1&&t.live.splice(e,1)}},getVisualSchema:function(t){var e=this.options.visuals?this.options.visuals[t]:null,n=this.visualParent;if(n&&a.isString(e)?(t=e,e=n.getVisualSchema(t)):n&&!e&&(e=n.getVisualSchema(t)),a.isObject(e))return D(e)}},o.viewBase),Lt=function(t,n){function r(e,n,r,i){Object.defineProperties(this,{visualType:{get:function(){return t}},isViz:{get:function(){return-1===Rt.indexOf(t)}},visualRoot:{get:function(){return this.visualParent?this.visualParent.visualRoot:this}}}),this.visualParent=r,this.model=r?r.model.$new():i||o.viewModel(),this.options=n||{},this.drawing=!1,Bt.events.call("before-init",void 0,this),this.initialise(e),Bt.events.call("after-init",void 0,this)}var i=a.pop(n,"options");return i&&(_t[t]=i),r.prototype=e({},Xt,n),Bt.types[t]=r,r},Vt=Lt("visual",{options:{render:"svg",width:null,height:"70%",heightElement:null},initialise:function(t){if(!t)throw new Error("HTMLElement required by visual group");if(this.visualParent&&"container"!==this.visualParent.visualType)throw new Error("Visual parent can be a container only");this.select(t).select(".paper").node()||this.select(t).append("div").classed("paper",!0),Object.defineProperties(this,{element:{get:function(){return t}},paper:{get:function(){return this.sel.select(".paper")}},sel:{get:function(){return d.select(t)}},size:{get:function(){return[this.width,this.height]}}}),this.sel.classed("d3-visual",!0),this.layers=[],this.drawCount=0,Bt.live.push(this),t.__visual__=this,this.visualParent&&this.visualParent.live.push(this)},draw:function(t){if(this.drawing)return wt(this.toString()+" already drawing"),this.drawing;this.drawCount?(this.drawCount++,this.clear()):(this.drawCount=1,this.fit());var e=this;return Bt.events.call("before-draw",void 0,this),Promise.all(this.layers.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Bt.events.call("after-draw",void 0,e)},function(t){delete e.drawing,wt("Could not draw "+e.toString()+": "+t)})},clear:function(){},addVisual:function(t){var e=a.pop(t,"type"),n=Bt.types[e];if(n)return new n(this.element,t,this);wt('Cannot add visual "'+e+'", not available')},fit:function(){this.resize(null,!0)},resize:function(t,e){t||(t=A(this.element.parentNode||this.element,this.getModel()));var n=this.size;(e||n[0]!==t.width||n[1]!==t.height)&&(e||o.viewDebug('Resizing "'+this.toString()+'"'),this.width=t.width,this.height=t.height,this.paper.style("height",this.height+"px"),e||this.draw(!1))},destroy:function(){this.pop(this.visualParent),this.pop(Bt)}});if(a.inBrowser){new MutationObserver(j).observe(document.documentElement,{childList:!0,subtree:!0})}var Nt=function(t,e,n,r){return n.substring(0,e.length)!==e&&(n=""+e+n[0].toUpperCase()+n.substring(1)),r?t[n]:t[n]()},Gt=function(t){for(var n=[{},$t,It],r=1;r<arguments.length;++r)n.push(arguments[r]);return Lt(t,e.apply(void 0,n))},$t={initialise:function(t){var e=this.visualParent;if(e){if("visual"!==e.visualType)throw new Error("visual parent of "+this.visualType+' can only be "visual"')}else this.visualParent=e=new Vt(t,this.options,null,this.model),this.model=e.model.$new(),this.options={};e.layers.push(this)},paper:function(){var t=this.getModel("visual"),e=this._paper;if(e&&e.paperType===t.render)return e;var n=Bt.papers[t.render];if(!n)throw new Error("Unknown paper "+t.render);return e=new n(this),this._paper=e,e},group:function(t){return t||(t=this.visualType+"-"+this.model.uid),this.paper().group(t)},translate:function(t,e){return a.isFunction(t)?function(n){return"translate("+(t(n)||0)+", "+(e(n)||0)+")"}:"translate("+t+", "+e+")"},getScale:function(t){return Nt(f,"scale",t)},displayError:function(){}},It={draw:function(t){var e=this;if(this.drawing)return wt(this.toString()+" already drawing"),this.drawing;var n=this,r=this.doDraw;if(Bt.events.call("before-draw",void 0,this),!1!==t||!this._drawArgs)return Promise.all([this.requires?o.require.apply(void 0,this.requires):[],this.getData()]).then(function(t){delete n.drawing;var i=t[1];i&&(t=a.isArray(t[0])?t[0]:[t[0]],t.unshift(i),e._drawArgs=t,r.apply(n,t),Bt.events.call("after-draw",void 0,n))},function(t){delete n.drawing,wt("Could not draw "+n.toString()+": "+t),e.displayError(t)});delete n.drawing,r.apply(n,this._drawArgs),Bt.events.call("after-draw",void 0,n)}},Kt={initialise:function(){},transition:function(){},size:function(t){return this.sel.attr("width",t.width).attr("height",t.height),this},group:function(t){t||(t="main");var e=this.sel;return e.selectAll("."+t).data([0]).enter().append("g").classed(t,!0),e.select("."+t)},dim:function(t){return t}},Ut=Y("svg",{initialise:function(t){var e=t.visualParent.paper.select("svg#"+t.visualParent.model.uid);return e.size()||(e=t.visualParent.paper.append("svg").attr("id",t.visualParent.model.uid).classed(t.visualType,!0).style("position","absolute")),e.node()}}),Zt=Y("div",{initialise:function(t){return t.visualParent.paper.append("div").attr("id",t.model.uid).classed(t.visualType,!0).node()},group:function(t){t||(t="main");var e=this.sel;return e.selectAll("."+t).data([0]).enter().append("div").classed(t,!0),e.select("."+t)}});_t.menu={display:!1,height:"8%",maxHeight:50,minHeight:20},Bt.events.on("after-init.menu",function(t){if("visual"===t.visualType){t.getModel("menu").display&&(t.menu=t.sel.insert("nav",":first-child").classed("d3-nav navbar p-1",!0),t.menu.append("h4").classed("title",!0))}}),Bt.events.on("before-draw.menu",function(t){t&&t.menu&&H(t)});var Jt=i.map(),Qt=function(t,e){var n=Jt.get(t);return n||(n=p.format(t),Jt.set(t,n)),n(e)};if(Bt.options.dataContext={$format:Qt},$t.getData=function(){var t=this.model.data;return t?this.dataStore.getData(t):(wt("Visual "+this.visualType+" without data name, cannot get data"),o.resolvedPromise())},$t.getContext=function(t){return this.dataStore.model.$child(t)},Bt.events.on("before-init.data",function(t){t.isViz&&(t.data=a.pop(t.options,"data"))}),Bt.events.on("after-init.data",function(t){Object.defineProperties(t,{dataStore:{get:function(){return t.model.root.dataStore}}}),t.isViz?B(t):R(t)}),Bt.options.font={size:"3%",minSize:10,maxSize:20},$t.font=function(t){var e=this.getModel(),n=this.getModel("font"),r=this.dim(n.size,t.height,n.minSize,n.maxSize);return e.fontSizeMultiplier&&(r*=e.fontSizeMultiplier),r},_t.resizeDelay||(_t.resizeDelay=200),a.inBrowser){var te=o.viewDebounce(function(){Bt.live.forEach(function(t){return t.resize()})},_t.resizeDelay);d.select(window).on("resize.visuals",te)}_t.title={text:null,fontSize:"5%",minFontSize:15,maxFontSize:25},Bt.events.on("before-init.title",function(t){var e=t.options.title;a.isString(e)&&(t.options.title={text:e})}),Bt.events.on("before-draw.title",function(t){var e=t.getModel("title");if(e.text){var n=t.isViz?t.visualParent:t;"visual"===n.visualType&&n.menu&&X(n,e,t)}});var ee=["top","bottom","left","right"],ne=["left","right"];_t.margin={top:20,bottom:20,left:20,right:20},_t.padding={top:0,bottom:0,left:0,right:0},$t.boundingBox=function(){var t=this.visualParent.width,e=this.visualParent.height,n=N(this.getModel("margin"),t,e),r=N(this.getModel("padding"),t,e),i=ee.reduce(function(t,e){return t[e]=n[e]+r[e],t},{});return{width:t,height:e,margin:n,padding:n,total:i,innerWidth:t-i.left-i.right,innerHeight:e-i.top-i.bottom}},Bt.events.on("after-init.margin",function(t){t.margin=V("margin",t),t.padding=V("padding",t)});var re=i.map({top:g.axisTop,bottom:g.axisBottom,left:g.axisLeft,right:g.axisRight}),ie={ticks:5,tickSize:6,tickSizeOuter:null,format:null,timeFormat:"%Y-%m-%d",stroke:"#333",title:null,titleRotate:null,titleShift:2/3};Bt.options.xAxis=e({location:"bottom"},ie),Bt.options.yAxis=e({location:"left"},ie),$t.xAxis=function(t,e,n){var r=this.getModel("xAxis"),i=G(r.location,t,r);this.paper().group("x-axis").attr("transform",this.translate(e,n)).transition().call(i).select("path.domain").attr("stroke",r.stroke)},$t.yAxis=function(t,e,n){var r=this.getModel("yAxis"),i=G(r.location,t,r);this.paper().group("y-axis").attr("transform",this.translate(e,n)).transition().call(i).select("path.domain").attr("stroke",r.stroke)},$t.xAxis1=function(t,e,n,r){var i=this.getModel("xAxis"),a=G(t,e,i,r);this.paper().group("x-axis").attr("transform",this.translateAxis(t,n)).transition().call(a).select("path.domain").attr("stroke",i.stroke),i.title&&this.axisTitle(t,e,n,i)},$t.yAxis1=function(t,e,n,r){var i=this.getModel("yAxis"),a=G(t,e,i,r);this.paper().group("y-axis").attr("transform",this.translateAxis(t,n)).transition().call(a).select("path.domain").attr("stroke",i.stroke),i.title&&this.axisTitle(t,e,n,i)},$t.axis=function(t,e){return re.get(t)(e)},$t.axisTitle=function(t,e,n,r){var i=r.titleRotate||0,a=0,o=0,s=this.group("axis-"+t+"-title").attr("transform",this.translateAxis(t,n)).selectAll("text").data([r.title]);i||"right"!==t&&"left"!==t||(i=-90),"left"==t&&(a=-r.titleShift*n.margin.left,o=n.innerHeight/2);var l="translate("+a+","+o+") rotate("+i+")",u=this.font(n);s.enter().append("text").attr("transform",l).style("text-anchor","middle").style("font-size",u).style("fill",r.stroke).text(function(t){return t}).merge(s).transition().attr("transform",l).style("font-size",u).style("fill",r.stroke).text(function(t){return t})},$t.translateAxis=function(t,e){return"top"===t||"left"===t?this.translate(e.total.left,e.total.top):"bottom"===t?this.translate(e.total.left,e.total.top+e.innerHeight):this.translate(e.total.left+e.innerWidth,e.total.top)};var ae=i.map({circle:m.symbolCircle,square:m.symbolSquare,star:m.symbolStar});$t.getSymbol=function(t){var e=ae.get(t);return m.symbol().type(e)};var oe=i.map();_t.color={scale:"cool",scaleMinPoints:6,scaleOffset:0,stroke:"#333",strokeOpacity:1,fillOpacity:1},oe.set("viridis",function(){return f.scaleSequential(f.interpolateViridis)}),oe.set("inferno",function(){return f.scaleSequential(f.interpolateInferno)}),oe.set("magma",function(){return f.scaleSequential(f.interpolateMagma)}),oe.set("plasma",function(){return f.scaleSequential(f.interpolatePlasma)}),oe.set("warm",function(){return f.scaleSequential(f.interpolateWarm)}),oe.set("cool",function(){return f.scaleSequential(f.interpolateCool)}),oe.set("rainbow",function(){return f.scaleSequential(f.interpolateRainbow)}),oe.set("cubehelix",function(){return f.scaleSequential(f.interpolateCubehelixDefault)}),$t.colors=function(t){var e=this.getModel("color"),r=oe.get(e.scale);if(!r)throw new Error("Unknown scale "+e.scale);a.isObject(r)||(r={scale:r}),void 0===r.minPoints&&(r.minPoints=e.scaleMinPoints);var i=e.scaleOffset,o=t+i,s=Math.max(o,r.minPoints),l=r.reversed?[s-1,0]:[0,s-1],u=r.scale().domain(l);return n.range(i,Math.min(o,s)).map(function(t){return u(t)})},$t.linearGradient=function(t,e,n,r){var i=this.paper().sel,a=i.select("defs");a.node()||(a=i.append("defs"));var o=a.selectAll("#"+r).data([0]),s=v.color(t);s.opacity=.1,o.enter().append("linearGradient").attr("id",r).attr("x1","0%").attr("y1","0%").attr("x2","vertical"===n?"0%":"100%").attr("y2","vertical"===n?"100%":"0%");var l=a.select("#"+r).selectAll("stop").data([{offset:"0%",color:t},{offset:"100%",color:s}]);return l.enter().append("stop").merge(l).attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),"url(#"+r+")"},_t.legend={location:"top-right",orient:"vertical",fontSize:"3%",title:"",titleWidth:"20%",labelFormat:null,titleMinWidth:30,titleMaxWidth:60,minFontSize:10,maxFontSize:20,offsetX:10,offsetY:10,shapeWidth:15,shapeHeight:15};var se={color:y.legendColor,size:y.legendSize,symbol:y.legendSymbol};$t.legend=function(t,e){var n=this.getModel(),r=this.getModel("legend"),i=a.pop(t,"type")||n.legendType,o=this.dim(r.fontSize,e.height,r.minFontSize,r.maxFontSize);if(i){var s=se[i]
;if(!s)return wt("Could not load legend "+i);if(s=s().orient(r.orient),r.title){var l=this.dim(r.titleWidth,e.width,r.titleMinWidth,r.titleMaxWidth);s.title(r.title).titleWidth(l)}r.labelFormat&&s.labelFormat(r.labelFormat),s.shapeWidth(r.shapeWidth).shapeHeight(r.shapeHeight);for(var u in t)s[u](t[u]);var c=this.paper().group("legend").style("font-size",o+"px").html("").call(s),d=le.get(r.location)(c.node().getBBox(),e,r);c.attr("transform",this.translate(d.x,d.y))}};var le=i.map({top:$,bottom:I,right:K,left:U,"top-left":Z,"top-right":J,"bottom-left":Q,"bottom-right":tt}),ue=function(t){return function(){return t}},ce=function(t){return a.isFunction(t)?t:ue(t)},de=function(t){return t},he=i.map({darker:function(){function t(t,e){var n=t.getModel("mouse"),r=v.color(e.style("fill")),i=r.darker(n.darkerFactor);e.node().__mouse_over__.fill=r,e.style("fill",i)}return t.out=function(t,e){var n=e.node(),r=n.__mouse_over__.fill;r&&e.style("fill",r)},t}(),fill:function(){function t(t,e){var n=t.getModel("mouse"),r=v.color(e.style("fill"));e.node().__mouse_over__.fill=r,e.transition().style("fill",n.fillColor)}return t.out=function(t,e){var n=e.node(),r=n.__mouse_over__.fill;r&&e.transition().style("fill",r)},t}()});Bt.options.mouse={over:["darker"],darkerFactor:.5,fillColor:"#addd8e"},$t.mouseOver=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),a=void 0;e.over.forEach(function(e){a=he.get(e),a?a(t,i,n,r):wt("Unknown mouse strategy "+e)})}},$t.mouseOut=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),a=void 0;e.over.forEach(function(e){a=he.get(e),a?a.out(t,i,n,r):wt("Unknown mouse strategy "+e)})}},Bt.options.tooltip={location:"top",offset:[0,0],html:""},a.inBrowser?$t.tooltip=function(){function t(){return null===m&&(m=d.select(document.body).append("div").classed("d3-tooltip",!0).style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box").node(),v=d.select(document.body).append("svg").style("opacity",0).style("pointer-events","none").node().createSVGPoint()),d.select(m)}function e(){}function n(t){var e=h(t);return{top:e.n.y-m.offsetHeight,left:e.n.x-m.offsetWidth/2}}function r(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function a(t){var e=h(t);return{top:e.e.y-m.offsetHeight/2,left:e.e.x}}function o(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function s(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function l(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}}function u(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function c(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function h(t){for(;null==t.getScreenCTM&&null==t.parentNode;)t=t.parentNode;var e={},n=t.getScreenCTM(),r=t.getBBox(),i=r.width,a=r.height,o=r.x,s=r.y;return v.x=o,v.y=s,e.nw=v.matrixTransform(n),v.x+=i,e.ne=v.matrixTransform(n),v.y+=a,e.se=v.matrixTransform(n),v.x-=i,e.sw=v.matrixTransform(n),v.y-=a/2,e.w=v.matrixTransform(n),v.x+=i,e.e=v.matrixTransform(n),v.x-=i/2,v.y-=a/2,e.n=v.matrixTransform(n),v.y+=a,e.s=v.matrixTransform(n),e}var f=ce("top"),p=ce([0,0]),g=ce(" "),m=null,v=null,y=i.map({top:n,bottom:r,right:a,left:o,"top-left":s,"top-right":l,"bottom-left":u,"bottom-right":c}),x=y.keys();return e.show=function(n){var r,i=Array.prototype.slice.call(arguments),a=t(),o=g.apply(this,i)||"",s=p.apply(this,i),l=f.apply(this,i),u=document.documentElement.scrollTop||document.body.scrollTop,c=document.documentElement.scrollLeft||document.body.scrollLeft;a.html(o).style("opacity",1).style("pointer-events","all");for(var d=x.length;d--;)a.classed(x[d],!1);return r=y.get(l).call(this,n),a.classed(l,!0).style("top",r.top+s[0]+u+"px").style("left",r.left+s[1]+c+"px"),e},e.hide=function(){return t().style("opacity",0).style("pointer-events","none"),e},e.location=function(t){return arguments.length?(f=null===t?t:ce(t),e):f},e.html=function(t){return arguments.length?(g=null===t?t:ce(t),e):g},e.offset=function(t){return arguments.length?(p=null==t?t:ce(t),e):p},e}():$t.tooltip=de,he.set("tooltip",function(){function t(t,e,n,r){var i=t.tooltipHtml(e,n,r);if(i){var a=t.getModel("tooltip");t.tooltip.location(a.location).offset(a.offset).html(i).show(e.node())}}return t.out=function(t){t.tooltip.hide()},t}()),$t.tooltipHtml=function(t,e,n){var r=this.getModel("tooltip");if(r.html)return this.dataStore.eval(r.html,{d:e,index:n,model:this.getModel()})};var fe=Lt("container",{initialise:function(){this.live=[],this.visualParent&&this.visualParent.live.push(this)},draw:function(t){if(this.drawing)return wt(this.toString()+" already drawing"),this.drawing;var e=this;return Bt.events.call("before-draw",void 0,e),Promise.all(this.live.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Bt.events.call("after-draw",void 0,e)})},destroy:function(){this.pop(this.visualParent)}}),pe={props:["schema","datasource","plugins"],render:function(t,e,n){var r=this,i=this.select(n).html();return this.getSchema(t.schema,function(t){return a.isObject(t)||(t={}),r.build(t,i,e)})},getSchema:function(t,e){var n=this.model.visual;if(n&&n!==this.model&&a.isString(t)){var r=n.getVisualSchema(t);r&&(t=r)}return a.isString(t)?this.json(t).then(e).catch(function(e){wt("Could not reach "+t+": "+e)}):e(t)},build:function(){}},ge=e({},pe,{build:function(t,e,n){var r=this.model,i=this.createElement("div"),a=r.root;return n.class&&i.attr("class",n.class),t.visuals||(t.visuals={}),r.visual=new fe(i.node(),t,r.visual,r.visual?null:r.$new()),a.visualDashboard||(a.visualDashboard=r.visual),this.mountInner(i,e)}}),me=e({},pe,{build:function(t){var e,n=this.createElement("div"),r=t.type||"visual",i=this.model,o={};return"visual"===r?(e=a.pop(t,"layers"),o=t):o.visual=a.pop(t,"visual")||{},i.visual=new Vt(n.node(),o,i.visual,i.visual?null:i.$new()),"visual"!==r?i.visual.addVisual(t):e&&e.forEach(function(t){return i.visual.addVisual(t)}),n},mounted:function(){!1!==this.model.visualDrawOnMount&&this.model.visual.redraw()}}),ve={install:function(t){t.addComponent("dashboard",ge),t.addComponent("visual",me)}},ye=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},xe=function(){function t(t){var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0,h=void 0,f=void 0,p=void 0,g=void 0,m=t.length,v=.5*i/r,y=new Array(m),x=new Array(m);for(a=0;a<m;++a)y[x[a]=a]=+e(t[a],a,t);for(x.sort(function(t,e){return ye(y[t],y[e])}),f=y[x[0]],c=null,a=m-1;a>=0;--a)l=[],null===c?l.push([0,0]):(h=c+p,d=h*v,l.push([d,h]),l.push([-d,h])),o=x[a],s=m-a-1,u=y[o]/f,g=Math.sqrt(u),c=r*g,p=a?n(g,s):0,h=c-p,d=h*v,l.push([-d,h]),l.push([d,h]),y[o]={index:s,value:y[o],fraction:u,points:l,data:t[o]};return y}var e=de,n=ue(0),r=1,i=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:ue(+n),t):e},t.base=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(r=e,t):r},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:ue(+e),t):n},t},we=function(t,e){var n=t[0],r=t[1],i=(r-n)/e,a=Math.floor(Math.log10(i)),o=Math.pow(10,a);i/o>5&&(o*=10),o*=.1;var s=o*Math.ceil(i/o),l=o*Math.floor(n/o);return[l,l+e*s]},be={getDataInfo:function(t){var e=this.getModel(),n=this.newRange(),r=t.series.size(),i=r?t.series.values():[t.data],a=r?t.series.keys():[e.y],o=mt(e.x),s=mt(e.y),l=this;return{data:i,range:n,meta:a.map(function(t,e){return{index:e,label:t,range:l.range(i[e],o,s,n)}})}},fill:function(t){function e(t,e){return n[e]}var n=this.colors(t.length);return e.colors=n,e},curve:function(t){var e=Nt(m,"curve",t,!0);return e||(wt('Could not locate curve type "'+t+'"'),e=Nt(m,"curve","cardinalOpen",!0)),e},range:function(t,e,r,i){var a={x:n.extent(t,e),y:n.extent(t,r)};i&&(Array.prototype.push.apply(i.x,a.x),Array.prototype.push.apply(i.y,a.y))},newRange:function(){return{x:[],y:[]}},x:function(t,e){var r=this.getModel(),i=this.getScale(r.scaleX).domain(n.extent(e)).range([0,t.innerWidth]);return function(t){return i(t[r.x])}},y:function(t,e,r){var i=this.getModel(),a=this.getScale(i.scaleY).domain(n.extent(e)).range([t.innerHeight,0]);return 2===arguments.length&&(r=function(t){return t[i.y]}),function(t){return a(r(t))}},getStack:function(){var t=this.getModel();if(t.stack){var e=m.stack();return t.stackOrder&&e.order(t.stackOrder),e}}},ke=Gt("linechart",be,{options:{lineWidth:1,curve:"cardinalOpen",x:"x",y:"y",scaleX:"linear",scaleY:"linear"},doDraw:function(t){var e=this,n=this.newRange(),r=this.getModel(),i=this.getModel("color"),a=mt(r.x),o=mt(r.y),s=t.series.values(),l=t.series.keys().map(function(t,r){return{index:r,label:t,range:e.range(s[r],a,o,n)}}),u=this.boundingBox(),c=this.paper(),d=c.size(u).group().attr("transform",this.translate(u.total.left,u.total.top)).selectAll(".line").data(s),h=this.fill(l),f=m.line().x(this.x(u,n.x)).y(this.y(u,n.y)).curve(this.curve(r.curve));d.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",h).attr("stroke-opacity",0).attr("stroke-width",r.lineWidth).merge(d).attr("stroke",h).attr("stroke-opacity",i.strokeOpacity).attr("stroke-width",r.lineWidth).attr("d",f),d.exit().remove()}}),Se=Gt("barchart",be,{options:{orientation:"vertical",sortby:null,stack:!0,normalize:!1,scale:"linear",padding:.2,x:"x",y:"y",groupby:null,axisY:!0,axisX:!0,valueformat:".1f",legendType:"color",legendLabel:"label"},doDraw:function(t){function e(t){return k(t[1-P])-k(t[P])}function r(t){return b(t.data[y])}function i(t){return k(t[P])}function a(t){return b(t[y])}function o(t){return k(t.value)}function s(t){return k(0)-k(t.value)}function l(t){return t.forEach(function(e){e.key=t.key,e.value=e.data[t.key]}),t}function u(t){return T.map(function(e){return{key:e,value:t[e]}})}var c=this,d=this.getModel(),h=this.getModel("color"),f=t.data,p=this.boundingBox(),g=this.paper().size(p),v=g.group().attr("transform",this.translate(p.total.left,p.total.top)).selectAll(".group"),y=d.x,x=d.y,w=d.groupby,b=this.getScale("band"),k=this.getScale(d.scale),S=this.getScale("ordinal"),M=!1,z=null,A=null,_=void 0,O=void 0,P=void 0,T=void 0,C=void 0,W=void 0;if("vertical"===d.orientation?(b.rangeRound([0,p.innerWidth]).paddingInner(d.padding),k.rangeRound([p.innerHeight,0]),z=b.bandwidth,A=e):(b.rangeRound([0,p.innerHeight]).paddingInner(d.padding),k.rangeRound([0,p.innerWidth]),z=e,A=b.bandwidth),w&&(T=t.dimension(w).group().top(1/0).map(function(t){return t.key}),T.length<=1&&(T=null)),T){var q=t.pivot(y,w,x);"y"===d.sortby&&(q=q.sortby("total")),f=q.data,S.domain(T).range(this.colors(T.length)),d.stack&&(d.normalize&&(f=this.normalize(q)),M=!0)}if(b.domain(f.map(function(t){return t[y]})),M)"vertical"===d.orientation?(_=r,O=i,P=1):(_=i,O=r,P=0),k.domain([0,n.max(f,function(t){return t.total})]).nice(),f=m.stack().order(m.stackOrderDescending).keys(T)(f),C=v.data(f).enter().append("g").classed("group",!0).attr("fill",function(t){return S(t.key)}).merge(v).attr("fill",function(t){return S(t.key)}).attr("stroke",h.stroke).attr("stroke-opacity",h.strokeOpacity).attr("fill-opacity",h.fillOpacity).selectAll("rect").data(l),C.enter().append("rect").attr("x",_).attr("y",O).attr("height",A).attr("width",z).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(C).transition().attr("x",_).attr("y",O).attr("height",A).attr("width",z);else if(T){var F=this.getScale("band").domain(T).paddingInner(.5*d.padding);k.domain([0,n.max(t.data,function(t){return t[x]})]).nice(),"vertical"===d.orientation?(F.rangeRound([0,b.bandwidth()]),_=a,z=F.bandwidth,A=s):(O=a,A=F.bandwidth,z=s),v=v.data(f),v.exit().remove(),C=v.enter().append("g").classed("group",!0).attr("transform",function(t){return c.translate(_(t),0)}).merge(v).attr("transform",function(t){return c.translate(_(t),0)}).selectAll("rect").data(u),C.exit().transition().style("opacity",0).remove(),C.enter().append("rect").attr("x",function(t){return F(t.key)}).attr("y",o).attr("height",A).attr("width",z).attr("stroke",h.stroke).attr("stroke-opacity",0).attr("fill-opacity",0).attr("fill",function(t){return S(t.key)}).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(C).transition().attr("x",function(t){return F(t.key)}).attr("y",o).attr("height",A).attr("width",z).attr("stroke",h.stroke).attr("stroke-opacity",h.strokeOpacity).attr("fill-opacity",h.fillOpacity).attr("fill",function(t){return S(t.key)}),C.exit().remove()}"vertical"===d.orientation?(d.axisX&&this.xAxis1(!0===d.axisX?"bottom":d.axisX,b,p),d.axisY&&this.yAxis1(!0===d.axisY?"left":d.axisY,k,p)):(W=this.axis("left",b).tickSizeOuter(0),g.group("axis").attr("transform",this.translate(p.total.left,p.total.top)).call(W),d.axisY&&this.yAxis1(!0===d.axisY?"bottom":d.axisY,k,p)),d.legendType&&T&&this.legend({scale:S},p)}}),Me=Gt("boxchart",be,{options:{orientation:"vertical",lineWidth:1,x:"x",y:"y",scaleX:"linear",scaleY:"linear",gradient:!0},doDraw:function(t){var e=this,r=this.getModel(),i=e.getDataInfo(t),a=this.boundingBox(),o=et(),s=this.paper().size(a),l=mt(r.x),u=s.group().attr("transform",this.translate(a.total.left,a.total.top)).selectAll(".box").data(i.data),c=t.groupby(r.x),d=this.getScale(r.scaleX).domain(n.extent(t.data,l)),h=a.innerWidth;"vertical"===r.orientation?d.range([0,a.innerWidth]):(d.range([0,a.innerHeight]),h=this.innerHeight),o.width(this.dim(r.width,h,h/c.length-2)),u.enter().append("g").classed("box",!0).call(o)}}),ze=function(){function t(t){var s=!1,l=void 0,u=void 0,c=void 0;return e&&(u=t.dimension(e).group().top(1/0).map(function(t){return t.key}),u.length<=1&&(u=null)),u?(t=t.pivot(n,e,r),i&&(t=t.sortby("total")),l=t.data,a&&(o&&(l=at(l)),l=a.keys(u)(l),s=!0)):(l=t.data,u=[r]),s||(l=u.map(function(t,e){return c=l.map(function(e){return c=[0,e[t]],c.data=e,c}),c.index=e,c.key=t,c})),new it(l,n,r,s)}var e=null,n="x",r="y",i=!1,a=null,o=!1;return t.groupby=function(n){return arguments.length?(e=n,t):e},t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.normalize=function(e){return arguments.length?(o=e,t):o},t.stack=function(e){return arguments.length?(a=e,t):a},t};it.prototype={rangeX:function(){return this.range(this.x)},rangeY:function(){return this.range()},range:function(t){function e(t){return t[0]}function r(t){return t[1]}function i(e){return e.data[t]}var a=void 0,o=void 0;return o=t?this.data.reduce(function(t,e){return a=n.extent(e,i),t.push(a[0]),t.push(a[1]),t},[]):this.data.reduce(function(t,i){return a=n.extent(i,e),t.push(a[0]),t.push(a[1]),a=n.extent(i,r),t.push(a[0]),t.push(a[1]),t},[]),n.extent(o)}};var Ae=Gt("areachart",be,{options:{lineWidth:1,curve:"natural",x:"x",y:"y",groupby:null,scaleX:"linear",scaleY:"linear",gradient:!0,lineDarken:.2,axisX:!0,axisXticks:5,axisY:!0,axisYticks:5,axisFormat:",",axisTimeFormat:"%Y-%m-%d",axisTickSizeOuter:0},doDraw:function(t){function e(t){return p(t.data[s])}function n(t){return g(t[0])}function r(t){return g(t[1])}function i(t){var i=m.area().curve(b).x(e).y1(r).y0(n),a=m.line().curve(b).x(e).y(r),s=v.color(x[t.index]);return[{type:"area",data:t,draw:i(t),stroke:"none",fill:w[t.index]},{type:"line",data:t,draw:a(t),fill:"none",stroke:s.darker(o.lineDarken)}]}var a=this,o=this.getModel(),s=o.x,l=o.y,u=this.getModel("color"),c=this.boundingBox(),d=ze().groupby(o.groupby).stack(this.getStack()).x(s).y(l)(t),h=d.rangeX(),f=d.rangeY(),p=this.getScale(o.scaleX).domain(h).rangeRound([0,c.innerWidth]),g=this.getScale(o.scaleY).domain(f).rangeRound([c.innerHeight,0]).nice(),y=this.group().attr("transform",this.translate(c.total.left,c.total.top)).selectAll(".areagroup").data(d.data),x=this.colors(d.data.length),w=o.gradient?x.map(function(t,e){return a.linearGradient(t,c,"vertical","fill"+a.model.uid+"-"+e)}):x,b=this.curve(o.curve);this.paper().size(c);var k=y.enter().append("g").classed("areagroup",!0).merge(y).selectAll("path").data(i);k.enter().append("path").attr("class",function(t){return t.type}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("d",function(t){return t.draw}).merge(k).attr("d",function(t){return t.draw}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("fill-opacity",u.fillOpacity).attr("stroke-width",o.lineWidth).attr("stroke-opacity",u.strokeOpacity),k.exit().transition().remove(),o.axisX&&this.xAxis1(!0===o.axisX?"bottom":o.axisX,p,c,h[0]),o.axisY&&this.yAxis1(!0===o.axisY?"left":o.axisY,g,c,f[0])},ticks:function(t,e){return Math.max(Math.floor(t/e),1)}}),_e=function(t,e){t.each(function(){for(var t,n=d.select(this),r=n.text().split(/\s+/).reverse(),i=[],a=parseFloat(n.attr("dy"))||0,o=n.text(null).append("tspan").attr("x",0).attr("dy",a+"em");t=r.pop();)i.push(t),o.text(i.join(" ")),o.node().getComputedTextLength()>e&&i.length>1&&(i.pop(),o.text(i.join(" ")),i=[t],o=n.append("tspan").attr("x",0).attr("dy",1.2+a+"em").text(t))})},Oe=Math.PI,Pe=Oe/180,Te={fill:function(t){function e(t,e){return n[e]}var n=this.colors(t.length);return e.colors=n,e},proportionalData:function(t,e){return t.dimension(e).top(1/0)},total:function(t){function e(e){return n+=e[t],e[t]}var n=0;return e.total=function(){return n},e}},Ce=Gt("piechart",Te,{options:{field:"data",label:"label",startAngle:0,endAngle:360,sort:!1,innerRadius:0,padAngle:0,cornerRadius:0,lineWidth:1,fractionFormat:".1%",legendType:"color",legendLabel:"label + ' - ' + format(fraction)",center:null,centerOpacity:1,centerFontSize:"7%"},doDraw:function(t){var e=this.getModel(),n=this.getModel("color"),r=e.field,i=this.boundingBox(),a=Math.min(i.innerWidth,i.innerHeight)/2,s=z(e.innerRadius,a),l=this.total(r),u=m.pie().padAngle(Pe*e.padAngle).startAngle(Pe*e.startAngle).endAngle(Pe*e.endAngle).value(l),c=m.arc().innerRadius(s).outerRadius(a).cornerRadius(e.cornerRadius),d=this.paper().size(i),h=u(this.proportionalData(t,r)),g=this.fill(h),v=d.group().attr("transform",this.translate(i.total.left+i.innerWidth/2,i.total.top+i.innerHeight/2)).selectAll(".slice").data(h);if(v.enter().append("path").attr("class","slice").attr("stroke",n.stroke).attr("stroke-opacity",0).attr("fill-opacity",0).attr("fill",g).attr("stroke-width",e.lineWidth).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(v).transition().attr("stroke",n.stroke).attr("stroke-opacity",n.strokeOpacity).attr("d",c).attr("fill",g).attr("fill-opacity",n.fillOpacity),v.exit().transition().remove(),e.center){var y=this.dataStore.eval(e.center,{total:l.total()});if(y){var x=this.dim(e.centerFontSize,i.innerWidth),w=d.group("center-notation").attr("transform",this.translate(i.total.left+i.innerWidth/2,i.total.top+i.innerHeight/2)).selectAll(".info").data([y]);w.enter().append("text").attr("class","info").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",x+"px").style("fill-opacity",0).merge(w).text(y).style("fill-opacity",e.centerOpacity).call(_e,1.5*(s||a))}}if(e.legendType){l=l.total();var b=o.viewExpression(e.legendLabel),k=p.format(e.fractionFormat),S=h.map(function(t,n){return b.eval({d:t,value:t.value,format:k,total:l,fraction:t.value/l,label:t.data[e.label]||n})});this.legend({scale:f.scaleOrdinal().domain(S).range(g.colors)},i)}}}),We=function(t){return{draw:function(e){t.forEach(function(t,n){n?e.lineTo(t[0],t[1]):e.moveTo(t[0],t[1])}),e.closePath()}}},qe=Gt("pyramidchart",Te,{options:{field:"data",label:"label",pad:.005,lineWidth:1,inverted:!1,legendType:"color",invereted:!1,legendLabel:"label + ' - ' + format('.1%', fraction)"},doDraw:function(t){var e=this.getModel(),n=e.field,r=this.getModel("color"),i=this.boundingBox(),a=this.dim(e.pad,Math.min(i.innerWidth,i.innerHeight)),s=xe().pad(a).value(function(t){return t[n]}),l=this.getScale("linear").rangeRound([0,i.innerWidth]),u=this.getScale("linear").rangeRound(e.inverted?[i.innerHeight,0]:[0,i.innerHeight]),c=t.new(s(this.proportionalData(t,n))).dimension("fraction").bottom(1/0),d=m.symbol().type(function(t){return We(t.points.map(function(t){return[l(t[0]),u(t[1])]}))}).size(1),h=this.fill(c),f=this.paper(),p=f.size(i).group().attr("transform",this.translate(i.total.left+i.innerWidth/2,i.total.top)).style("shape-rendering","crispEdges").selectAll(".segment").data(c);if(p.enter().append("path").attr("class","segment").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill-opacity",0).attr("fill",h).attr("stroke-width",e.lineWidth).attr("d",d).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(p).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",d).attr("fill",h).attr("fill-opacity",r.fillOpacity),p.exit().remove(),e.legendType){var g=o.viewExpression(e.legendLabel),v=this,y=c.map(function(t,n){return g.eval(v.getContext({d:t,value:t.value,fraction:t.fraction,label:t.data[e.label]||n}))});this.legend({scale:this.getScale("ordinal").domain(y).range(h.colors)},i)}}}),Fe=function(t,e,n){return t=v.color(t),.299*t.r+.587*t.g+.114*t.b>186?n||"#000":e||"#fff"},De=Gt("treemap",{requires:["d3-hierarchy"],options:{label:"label",field:"data",padding:2,tile:"resquarify",format:","},doDraw:function(t,e){function n(t){t.parent?(t.data._counter=t.parent.data._counter,t.parent.data._counter++):t.data._counter=0}function r(t){var e=x.font({height:Math.min(t.x1-t.x0,t.y1-t.y0)}),n=u(t.data).split(/(?=[A-Z][^A-Z])/g);return n.push(d(t.value)),n.map(function(t){return{size:e,text:t}})}function i(t){return[t]}function a(t){var e=void 0;return t.map(function(t){return e=t.children,e&&(t._children=a(e),delete t.children),t})}var o=this,s=this.getModel(),l=this.boundingBox(),u=mt(s.label),c=mt(s.field),d=p.format(s.format),h=e.hierarchy(function(t){return t={children:a(t)},t[s.label]="root",t}(t.data)).sum(c).sort(function(t,e){return e.value-t.value}).eachBefore(n),f=e.treemap().tile(Nt(e,"treemap",s.tile,!0)).size([l.innerWidth,l.innerHeight]).round(!0).padding(s.padding),g=this.colors(h.children.length),m=this.group().attr("transform",this.translate(l.total.left,l.total.top)).style("shape-rendering","crispEdges"),v=f(h).leaves(),y=m.selectAll("g").data(v),x=this;this.paper().size(l),y.exit().remove(),y=y.enter().append("g").attr("transform",function(t){return o.translate(t.x0,t.y0)}).merge(y).attr("transform",function(t){return o.translate(t.x0,t.y0)});var w=y.selectAll("rect").data(i);w.enter().append("rect").attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return g[t.data._counter]}).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(w).transition().attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return g[t.data._counter]}),w=y.selectAll("text").data(i),w.enter().append("text").style("fill",function(t){return Fe(g[t.data._counter])}).selectAll("tspan").data(r).enter().append("tspan").style("font-size",function(t){return t.size}).attr("x",4).attr("y",function(t,e){return 1.5*t.size+1.2*e*t.size}).text(function(t){return t.text})}}),je=Gt("text",{options:{label:"label",data:"data",text:'label + " " + data'},doDraw:function(t){function e(t,e){return n.translate((e+.5)*l,0)}var n=this,r=this.getModel(),i=this.getModel("color"),a=this.boundingBox(),o=this.font(a),s=this.group().attr("transform",this.translate(a.total.left,a.total.top)).selectAll("text").data(t.data),l=a.innerWidth/t.data.length,u=.4*l,c=this.dataStore;this.paper().size(a),s.enter().append("text").attr("transform",e).attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",o+"px").style("fill-opacity",0).merge(s).attr("transform",e).text(function(t){return c.eval(r.text,t)}).style("fill-opacity",i.fillOpacity).call(_e,u),s.exit().remove()}}),Ee=Gt("heatmap",be,{options:{shape:"square",layout:"heatmap",buckets:10,pad:.005,x:"x",y:"y",z:"data",axisX:"bottom",axisY:"left"},doDraw:function(t){var e=this.getModel(),r=this.getModel("color"),i=e.layout,a=this.boundingBox(),o=n.extent(t.data,mt(e.z)),s=this.paper().size(a);o[0]<0&&"punchcard"===i&&(i="heatmap");var l=this.heatmap(i,t,a,o),u=(a.innerWidth-l.width)/2,c=(a.innerHeight-l.height)/2,d=this.getSymbol(e.shape).size(function(t){return t.size*t.size}),h=s.group().attr("transform",this.translate(a.total.left+u,a.total.top+c)).selectAll(".shape").data(l.data);n.range[0]<0&&"punchcard"===i&&(i="heatmap"),h.enter().append("path").classed("shape",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill",function(t){return t.color}).attr("fill-opacity",0).attr("stroke-opacity",0).attr("stroke",r.stroke).attr("d",d).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(h).transition().attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill-opacity",r.fillOpacity).attr("fill",function(t){return t.color}).attr("stroke-opacity",r.strokeOpacity).attr("stroke",r.stroke).attr("d",d),"bottom"===e.axisX&&this.xAxis(l.scaleX,a.total.left,a.total.top+l.height+c),"left"===e.axisY&&this.yAxis(l.scaleY,a.total.left,a.total.top+c),"heatmap"===i?this.legend({type:"color",shape:e.shape,scale:l.colors},a):"punchcard"===i&&this.legend({type:"size",shape:e.shape,scale:l.sizes},a)},heatmap:function(t,e,r,a){var o=this.getModel(),s=o.pad,l=o.x,u=o.y,c=o.z,d=e.dimension(o.x).group().size(),h=e.dimension(o.y).group().size(),f=Math.min(o.buckets,d*h),p=(1-s*(d+1))*r.innerWidth/d,g=(1-s*(h+1))*r.innerHeight/h,m=[],v=[],y=[],x=i.map(),w=i.map(),b=void 0,k=void 0,S=void 0,M=void 0,z=void 0,A=void 0,_=void 0,O=void 0,P=void 0,T=void 0;if(p<g?(O=p,P=r.innerWidth,s*=P,T=h*(O+s)+s):(O=g,T=r.innerHeight,s*=T,P=d*(O+s)+s),a=we(a,f),"heatmap"===t)A=this.getScale("quantile").range(this.colors(f).reverse()).domain(a),_=function(){return 1};else{var C=this.colors(1)[0];A=function(){return C},_=this.getScale("quantile").range(n.range(f).map(function(t){return(t+1)/f})).domain(a)}return e.data.forEach(function(t){b=t[l],k=t[u],S=t[c],x.has(b)||(x.set(b,v.length),v.push(b)),w.has(k)||(w.set(k,y.length),y.push(k)),M=x.get(b),z=w.get(k),m.push({i:M,j:z,x:s+O/2+M*(O+s),y:s+O/2+z*(O+s),color:A(S),size:O*_(S),data:t})}),{data:m,size:O,width:P,height:T,scaleX:this.getScale("band").domain(v).range([0,P]),scaleY:this.getScale("band").domain(y).range([0,T]),colors:A,sizes:_}}}),Ye=Gt("geochart",{requires:["d3-geo","topojson","d3-geo-projection","leaflet"],options:{geometry:"countries",geoKey:"id",dataKey:"id",dataLabelKey:"label",dataValueKey:"value",buckets:10,choroplethScale:"quantile",boundGeometry:null,boundScaleFactor:.9,projection:null,graticule:!1,leaflet:!1,scale:200,mouseover:["darken","tooltip"]},doDraw:function(t,e){var n=this.getGeoData(t);if(!n)return wt("Topojson data not available - cannot draw topology");this._geoPath||this.createGeoPath(e,n),this.update(e,n)},update:function(t,e){var n=this.getModel(),r=this.getModel("color"),i=this.boundingBox(),a=this.paper().size(i),o=a.group().attr("transform",this.translate(i.total.left,i.total.top)),s=this._geoPath,l=t.feature(e.topology,e.topology.objects[n.geometry]).features,u=o.selectAll(".geometry").data(l),c="none";this.center(t,e),e.data&&(c=this.choropleth(e.data,i)),u.enter().append("path").attr("class","geometry").attr("d",s).style("fill","none").style("stroke",r.stroke).style("stroke-opacity",0).style("fill-opacity",0).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(u).transition().attr("d",s).style("stroke",r.stroke).style("stroke-opacity",r.strokeOpacity).style("fill",c).style("fill-opacity",r.fillOpacity),u.exit().remove()},createGeoPath:function(t,e){function n(e,n){var i=r.latLngToLayerPoint(new t.LatLng(n,e));this.stream.point(i.x,i.y)}var r,i=this.getModel(),a=Nt(t,"geo",e.projection).scale(i.scale),o=t.geoPath().projection(a),s=this;if(this._geoPath=o,this.center(t,e),i.leaflet){var l="leaflet-"+i.uid,u=this.paper();this.visualParent.paper.append("div").attr("id",l),r=new t.Map(l,{center:[37.8,-96.9],zoom:4}).addLayer(new t.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")),r.getPanes().overlayPane.appendChild(u.element),a=t.transform({point:n}),r.on("viewreset",function(){return s.update(t,e)})}return o},getGeoData:function(t){var e={};if("frameCollection"===t.type)for(var n in t)"Topology"===t[n].type?e.topology=t[n]:e.data=t[n];else"Topology"===t.type&&(e.topology=t);if(e.topology){var r=this.getModel();return r.projection?e.projection=r.proection:e.projection="kavrayskiy7",e}},center:function(t,e){var n=this.getModel();if(n.boundGeometry){var r=this._geoPath,i=r.projection(),a=this.boundingBox(),o=t.feature(e.topology,e.topology.objects[n.boundGeometry]).features;i.scale(1).translate([0,0]);var s=r.bounds(o[0]),l=s[0],u=s[1],c=(u[0]-l[0])/a.innerWidth,d=(u[1]-l[1])/a.innerHeight,h=Math.round(n.boundScaleFactor/Math.max(c,d)),f=[(a.innerWidth-h*(u[0]+l[0]))/2,(a.innerHeight-h*(u[1]+l[1]))/2];i.scale(h).translate(f)}},choropleth:function(t,e){var r=this.getModel(),i=Math.min(r.buckets,t.data.length),a=r.dataKey,o=r.dataLabelKey,s=r.dataValueKey,l=r.geoKey,u=we(n.extent(t.data,mt(s)),i),c=this.getScale(r.choroplethScale).range(this.colors(i).reverse()).domain(u),d=t.data.reduce(function(t,e){return t[e[a]]=e,t},{}),h=void 0,f=void 0;return this.legend({type:"color",scale:c},e),function(t){return h=t.properties[l],f=d[h],t.choropleth={label:f[o]||h,value:f[s],color:c(f[s])},t.choropleth.color}}});t.visualizeVersion="0.2.0",t.randomPath=st,t.DataStore=M,t.dataSources=jt,t.visuals=Bt,t.createChart=Gt,t.createPaper=Y,t.Svg=Ut,t.Div=Zt,t.visualTransforms=qt,t.visualComponents=ve,t.colorScales=oe,t.pyramid=xe,t.niceRange=we,t.Visual=Vt,t.BarChart=Se,t.BoxChart=Me,t.LineChart=ke,t.AreaChart=Ae,t.PieChart=Ce,t.PyramidChart=qe,t.Treemap=De,t.TextChart=je,t.Heatmap=Ee,t.Geochart=Ye,Object.defineProperty(t,"__esModule",{value:!0})});