!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-collection"),require("d3-selection"),require("d3-timer"),require("d3-dispatch")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-selection","d3-timer","d3-dispatch"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i){"use strict";function o(t){return"[object Object]"===nt.call(t)}function a(t){return"[object String]"===nt.call(t)}function s(t){return"[object Function]"===nt.call(t)}function u(t){return"[object Array]"===nt.call(t)}function c(t){return"[object Number]"===nt.call(t)}function l(t){return"[object Promise]"===nt.call(t)}function f(t){ut.logger.info(at+" "+t)}function d(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function p(t){function e(t){wt(this).el=t}return e.prototype=gt({},xt,t),e}function h(t,e,n){return Et(function(){e.$set(n,t.value())})}function v(t){var e=rt?window.handlebars:require("handlebars");if(e)return e.compile(t);ct("compile function requires handlebars")}function m(t,e){if(a(t)){if(!e)return t;if(!v(t))return t}return t(e)}function g(t,e){var r=n.select(document.createElement("div"));r.html(m(t,e));var i=r.node().children;return 1!==i.length&&ct("HtmlElement function should return one root element only, got "+i.length),i[0]}function y(t){var e=(t.headers.get("content-type")||"").split(";")[0];if("application/json"===e)return t.json();throw new Error("Expected JSON content type, got "+e)}function b(t,e){switch(e.type){case At.IDENTIFIER:return t[e.name];case At.LITERAL:return e.value;case At.ARRAY_EXP:return e.elements.map(function(e){return b(t,e)});case At.LOGICAL_EXP:case At.BINARY_EXP:return O(e.operator,b(t,e.left),b(t,e.right));case At.CALL_EXP:return w(t,e.callee,e.arguments);case At.MEMBER_EXP:return b(b(t,e.object),e.property);case At.CONDITIONAL_EXP:return b(t,e.test)?b(t,e.consequent):b(t,e.alternate);case At.UNARY_EXP:return x(e.operator,b(t,e.argument))}}function E(t,n){switch(1===arguments.length&&(n=e.set()),t.type){case At.IDENTIFIER:n.add(t.name);break;case At.ARRAY_EXP:t.elements.forEach(function(t){return E(t,n)});break;case At.BINARY_EXP:E(t.left,n),E(t.right,n);break;case At.CALL_EXP:E(t.callee,n),t.arguments.forEach(function(t){return E(t,n)});break;case At.MEMBER_EXP:n.add(P(t));break;case At.CONDITIONAL_EXP:E(t.test,n),E(t.consequent,n),b(t.alternate,n);break;case At.UNARY_EXP:E(t.argument,n)}return n}function w(t,e,n){var r;if(n=n.map(function(e){return b(t,e)}),e.type!==At.IDENTIFIER&&(t=b(t,e.object),e=e.property),!(r=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return r.apply(t,n)}function x(t,e){return Bt[t]||(Bt[t]=new Function("arg","return "+t+" arg")),Bt[t](e)}function O(t,e,n){return Yt[t]||(Yt[t]=new Function("a","b","return a "+t+" b")),Yt[t](e,n)}function P(t){return t.type===At.IDENTIFIER?t.name:P(t.object)+"."+t.property.name}function $(t){this.codes=At,this.expr=t,this.parsed=Ft(t)}function _(t,n){var r=e.map(),i=null;r.set("",Jt()),Object.defineProperties(zt(t),{$events:{get:function(){return r}}}),t.$child=function(e){return null===i&&(i=j(t)),new i(e)},t.$update(n)}function j(t){function e(e){_(this,e),Object.defineProperty(this,"parent",{get:function(){return t}})}return e.prototype=t,e}function C(t,e,n){function r(r){if(i&&(r=i.get.call(t)),r!==n){var o=n;n=Wt(r)?t.$new(r):r;var a=t.name||"model";st("updating "+a+"."+e),t.$change(e,o),t.$change()}}var i;t.$events.set(e,Jt()),Object.defineProperty(t,e,function(){var o={get:function(){return n}};return s(n)&&(n={get:n}),Wt(n)&&s(n.get)?(n=(i=n).get.call(t),i.reactOn?i.reactOn.forEach(function(n){t.$on(n+"."+e,r)}):ct("reactive lazy property "+e+" does not specify 'reactOn' list or properties"),s(i.set)&&(o.set=i.set)):o.set=r,o}()),n=Wt(n)?t.$new(n):n,t.$change(e)}function A(t,e){var n=t.$events.get(e);return!n&&t.parent?A(t.parent,e):n}function I(t,e){e?t.on("change."+e,null):t.on("change",null)}function L(t){_(this,t)}function D(t){return new L(t)}function N(t,n,r){var i=t.get(n.uid),o=3===arguments.length?n[r]:void 0;i||(i={model:n,events:e.set()},t.set(n.uid,i)),s(o)||2===arguments.length?i.events.add(""):o instanceof D?(i.events.add(""),N(t,o)):i.events.add(r)}function k(t,n,r,o){function a(n){var r=ot(n,"parent"),a=e.map(r?r.components:null),u=e.map(r?r.directives:o),c=i.dispatch("message","mounted"),h={};l.each(function(t,e){a.set(e,t)}),f.each(function(t,e){u.set(e,t)}),R(a,ot(n,"components")),M(u,ot(n,"directives")),Object.defineProperties(this,{name:{get:function(){return t}},components:{get:function(){return a}},directives:{get:function(){return u}},parent:{get:function(){return r}},root:{get:function(){return r?r.root:this}},cache:{get:function(){return r?r.cache:h}},props:{get:function(){return p}},uid:{get:function(){return this.model.uid}},events:{get:function(){return c}}}),this.model=gt({},s(d)?d():d,ot(n,"model")),this.init(n)}function u(t){return new a(t)}s(n)&&(n={render:n});var c=gt({},n),l=R(e.map(),ot(c,"components")),f=M(e.map(),ot(c,"directives")),d=ot(c,"model"),p=ot(c,"props");return a.prototype=gt({},r,c),u.prototype=a.prototype,u}function T(t){var e=t.isMounted;return e||Object.defineProperty(t,"isMounted",{get:function(){return!0}}),e}function R(t,n){return e.map(n).each(function(e,n){t.set(n,k(n,e,ee))}),t}function M(t,n){return e.map(n).each(function(e,n){t.set(n,Qt(e))}),t}function S(t,e,r){Object.defineProperty(wt(t),"el",{get:function(){return e}});var i=n.select(e).view(t).mount(null,r);if(l(i))return i.then(function(){t.mounted(),r&&r(t)});t.mounted(),r&&r(t)}function X(t,e,r,i){return r?(1!==(r=Zt(r)).size()&&ct("render function must return a single HTML node"),r=r.node(),e.parentNode.insertBefore(r,e),n.select(e).remove(),S(t,r,i)):ct("render function must return a single HTML node. It returned nothing!")}function q(t){for(var e={},n=void 0,r=0;r<t.attributes.length;++r)e[(n=t.attributes[r]).name]=n.value;return e}function U(){this.attrs={},this.all=[]}function F(t,e,n,r){var i=e.components.get(t.tagName.toLowerCase()),o=re(t,e.directives),a=o.preMount();if(a)return a.execute(e.model);var s=void 0;if(i)s=(e=i({parent:e})).mount(t,n,r);else{for(var u=[],c=dt(t.children),f=0;f<c.length;++f)l(s=F(c[f],e,n,r))&&u.push(s);u.length&&(s=Promise.all(u))}return l(s)?s.then(function(){return o.execute(e.model)}):o.execute(e.model)}function B(t){if(!t)return ct("element not defined, pass an identifier or an HTMLElement object");var e=(s(t.node)?t:n.select(t)).node();if(e)return e;ct("could not find "+t+" element")}function Y(){document.removeEventListener("DOMContentLoaded",Y),window.removeEventListener("load",Y),G()}function G(){for(var t=void 0;ut.readyCallbacks.length;)t=ut.readyCallbacks.shift(),r.timeout(t)}function H(t,e,n){var r,i,a;if(o(n))for(i in n)o(r=n[i])&&("d3-"===i.substring(0,3)?(a=i.replace("-","_"),e.$set(a,r),r=a):r=JSON.stringify(r)),t.attr(i,r||"")}function V(t){var e=t.type||"text";return de[e]||e}function z(t){var e=this.model.data.children;if(e){if(!u(e))return ce("children should be an array of fields, for "+(void 0===e?"undefined":yt(e))),t;t.selectAll(".d3form").data(e).enter().append(J).classed("d3form",!0)}return t}function J(t){var e=V(t);return e||(ce("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3-form-"+e)}function W(t){var e=t.attr("min"),n=t.attr("max");return e=null===e?-1/0:+e,n=null===n?1/0:+n,[e,n]}function K(t,e){return{set:function(e,n){n[t]},validate:function(t,n){return e(t,n)}}}function Q(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[srOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}function Z(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+e+"</span>\n<slot></slot>\n</div>"}function tt(t){return'<div class="form-check">\n<label class="form-check-label">\n<slot></slot>\n'+t+"\n</label>\n</div>"}function et(t,e,n){var r=$e[n.attr("type")]||$e[n.node().tagName.toLowerCase()];if(!r)return e;var i=void 0;return r.forEach(function(r){(i=$e.wrappers[r])?e=i(t,e,n):ce("Could not find form field wrapper "+r)}),e}var nt=Object.prototype.toString,rt="undefined"!=typeof window&&"[object Object]"!==nt.call(window),it=rt?window.console:require("console"),ot=function(t,e){var n=void 0;if(o(t))return n=t[e],delete t[e],n;if(u(t)){var r=+e;return r===r?t.splice(r,1)[0]:(n=t[e],delete t[e],n)}},at="[d3-view-debug]",st=function(t){ut.logger.debug&&ut.logger.debug(t)};it.debug=null;var ut={logger:it,fetch:function(){if(rt)return window.fetch}(),readyCallbacks:[],setDebug:function(t){!arguments.length||t?this.logger.debug=s(t)?t:f:this.logger.debug=null}},ct=function(t){ut.logger.warn("[d3-view] "+t)},lt=["disabled","readonly","required"],ft={create:function(t){return this.arg?t:ct("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,e){return"class"===this.arg?this.refreshClass(e):u(e)?ct("Cannot apply array to attribute "+this.arg):void(lt.indexOf(this.arg)>-1?this.sel.property(this.arg,e||!1):this.sel.attr(this.arg,e||null))},refreshClass:function(t){var e=this.sel;u(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&e.classed(t,!1)}),this.oldValue=t.map(function(t){var n=!0;return u(t)&&(n=t[1],t=t[0]),t&&e.classed(t,n),t})}},dt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(t,e)},pt={refresh:function(t,e){if(c(e)&&(e=""+e),a(e)){this.sel.html(e);for(var r=dt(this.el.children),i=0;i<r.length;++i)n.select(r[i]).mount()}}},ht=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,gt=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,r,i=d(t),o=1;o<arguments.length;o++){n=Object(arguments[o]);for(var a in n)vt.call(n,a)&&(i[a]=n[a]);if(ht){r=ht(n);for(var s=0;s<r.length;s++)mt.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i},yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt=(function(){function t(t){this.value=t}function e(e){function n(i,o){try{var a=e[i](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(a.done?"return":"normal",a.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?n(i.key,i.arg):o=null}var i,o;this._invoke=function(t,e){return new Promise(function(r,a){var s={key:t,arg:e,resolve:r,reject:a,next:null};o?o=o.next=s:(i=o=s,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}),Et=function(t,e){var n=null;return function(){if(null!==n)return n;var i=this,o=arguments;return n=new Promise(function(a,s){r.timeout(function(){n=null;try{a(t?t.call.apply(t,[i].concat(bt(o))):void 0)}catch(t){s(t)}},e)})}},wt=function(t){return Object.defineProperty(t,"sel",{get:function(){return n.select(this.el)}}),t},xt={on:function(t,e){var n=h(this,t,e);this.sel.on("input",n).on("change",n)},off:function(){this.sel.on("input",null).on("change",null)},value:function(t){if(!arguments.length)return this.sel.property("value");this.sel.property("value",t)}},Ot=p(),Pt=p({value:function(t){if(!arguments.length)return this.sel.property("checked");this.sel.property("checked",t)}}),$t={input:Ot,textarea:Ot,select:p({value:function(t){var e,r=this.sel,i=r.selectAll("option"),o=t;if(!arguments.length)return o=[],i.each(function(){(e=n.select(this)).property("selected")&&o.push(e.attr("value")||"")}),r.property("multiple")?o:o[0]||"";u(o)||(o=[t||""]),i.each(function(){e=n.select(this),t=e.attr("value")||"",e.property("selected",o.indexOf(t)>-1)})}}),checkbox:Pt},_t={create:function(t){var e=this.sel.attr("type"),n=this.el.tagName.toLowerCase(),r=$t[e]||$t[n];return r?(this.tag=new r(this.el),t):ct("Cannot apply d3-value directive to "+n)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return ct('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var n=this.expression.expr;return t.$set(n,this.tag.value()),this.tag.on(t,n),t},refresh:function(t,e){this.tag.value(e)},destroy:function(){this.tag.off()}},jt={mount:function(t){var e=this.arg||"click",n=this.expression;this.sel.on(e+"."+this.uid,function(){n.eval(t)})}},Ct={isd3:!0,providers:ut,viewElement:g,createElement:function(t){return n.select(document.createElement(t))},fetch:function(t,e){var n=ut.fetch;return 1==arguments.length?n(t):n(t,e)},fetchText:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(function(t){return t.text()})},json:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(y)},renderFromUrl:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.cache;return t in r?new Promise(function(e){return e(n?g(r[t]):r[t])}):this.fetchText(t).then(function(i){return r[t]=i,n?g(i,e):m(i,e)})}},At={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},It=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},Lt={"-":!0,"!":!0,"~":!0,"+":!0},Dt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Nt=function(t){var e,n=0;for(var r in t)(e=r.length)>n&&t.hasOwnProperty(r)&&(n=e);return n},kt=Nt(Lt),Tt=Nt(Dt),Rt={true:!0,false:!1,null:null},Mt=function(t){return Dt[t]||0},St=function(t,e,n){return{type:"||"===t||"&&"===t?At.LOGICAL_EXP:At.BINARY_EXP,operator:t,left:e,right:n}},Xt=function(t){return t>=48&&t<=57},qt=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Dt[String.fromCharCode(t)]},Ut=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!Dt[String.fromCharCode(t)]},Ft=function(t){for(var e,n,r=0,i=t.charAt,o=t.charCodeAt,a=function(e){return i.call(t,e)},s=function(e){return o.call(t,e)},u=t.length,c=function(){for(var t=s(r);32===t||9===t;)t=s(++r)},l=function t(){var e,n,i=d();return c(),63!==s(r)?i:(r++,(e=t())||It("Expected expression",r),c(),58===s(r)?(r++,(n=t())||It("Expected expression",r),{type:At.CONDITIONAL_EXP,test:i,consequent:e,alternate:n}):void It("Expected :",r))},f=function(){c();for(var e=t.substr(r,Tt),n=e.length;n>0;){if(Dt.hasOwnProperty(e))return r+=n,e;e=e.substr(0,--n)}return!1},d=function(){var t,e,n,i,o,a,s,u;if(a=p(),!(e=f()))return a;for(o={value:e,prec:Mt(e)},(s=p())||It("Expected expression after "+e,r),i=[a,o,s];(e=f())&&0!==(n=Mt(e));){for(o={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)s=i.pop(),e=i.pop().value,a=i.pop(),t=St(e,a,s),i.push(t);(t=p())||It("Expected expression after "+e,r),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=St(i[u-1].value,i[u-2],t),u-=2;return t},p=function e(){var n,i,o;if(c(),n=s(r),Xt(n)||46===n)return h();if(39===n||34===n)return v();if(qt(n)||40===n)return y();if(91===n)return E();for(o=(i=t.substr(r,kt)).length;o>0;){if(Lt.hasOwnProperty(i))return r+=o,{type:At.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},h=function(){for(var t,e,n="";Xt(s(r));)n+=a(r++);if(46===s(r))for(n+=a(r++);Xt(s(r));)n+=a(r++);if("e"===(t=a(r))||"E"===t){for(n+=a(r++),"+"!==(t=a(r))&&"-"!==t||(n+=a(r++));Xt(s(r));)n+=a(r++);Xt(s(r-1))||It("Expected exponent ("+n+a(r)+")",r)}return e=s(r),qt(e)?It("Variable names cannot start with a number ("+n+a(r)+")",r):46===e&&It("Unexpected period",r),{type:At.LITERAL,value:parseFloat(n),raw:n}},v=function(){for(var t,e="",n=a(r++),i=!1;r<u;){if((t=a(r++))===n){i=!0;break}if("\\"===t)switch(t=a(r++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||It('Unclosed quote after "'+e+'"',r),{type:At.LITERAL,value:e,raw:n+e+n}},m=function(){var e,n=s(r),i=r;for(qt(n)?r++:It("Unexpected "+a(r),r);r<u&&(n=s(r),Ut(n));)r++;return e=t.slice(i,r),Rt.hasOwnProperty(e)?{type:At.LITERAL,value:Rt[e],raw:e}:"this"===e?{type:At.THIS_EXP}:{type:At.IDENTIFIER,name:e}},g=function(t){for(var e,n,i=[],o=!1;r<u;){if(c(),(e=s(r))===t){o=!0,r++;break}44===e?r++:((n=l())&&n.type!==At.COMPOUND||It("Expected comma",r),i.push(n))}return o||It("Expected "+String.fromCharCode(t),r),i},y=function(){var t,e;for(e=40===(t=s(r))?b():m(),c(),t=s(r);46===t||91===t||40===t;)r++,46===t?(c(),e={type:At.MEMBER_EXP,computed:!1,object:e,property:m()}):91===t?(e={type:At.MEMBER_EXP,computed:!0,object:e,property:l()},c(),93!==(t=s(r))&&It("Unclosed [",r),r++):40===t&&(e={type:At.CALL_EXP,arguments:g(41),callee:e}),c(),t=s(r);return e},b=function(){r++;var t=l();if(c(),41===s(r))return r++,t;It("Unclosed (",r)},E=function(){return r++,{type:At.ARRAY_EXP,elements:g(93)}},w=[];r<u;)59===(e=s(r))||44===e?r++:(n=l())?w.push(n):r<u&&It('Unexpected "'+a(r)+'"',r);return 1===w.length?w[0]:{type:At.COMPOUND,body:w}};Ft.addUnaryOp=function(t){return kt=Math.max(t.length,kt),Lt[t]=!0,this},Ft.addBinaryOp=function(t,e){return Tt=Math.max(t.length,Tt),Dt[t]=e,this},Ft.addLiteral=function(t,e){return Rt[t]=e,this},Ft.removeUnaryOp=function(t){return delete Lt[t],t.length===kt&&(kt=Nt(Lt)),this},Ft.removeBinaryOp=function(t){return delete Dt[t],t.length===Tt&&(Tt=Nt(Dt)),this},Ft.removeLiteral=function(t){return delete Rt[t],this};var Bt={},Yt={},Gt={eval:function(t){return b(t,this.parsed)},safeEval:function(t){try{return b(t,this.parsed)}catch(t){ct("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return E(this.parsed).values()}};$.prototype=Gt;var Ht=function(t){return new $(t)},Vt=0,zt=function(t){var e="d3v"+ ++Vt;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},Jt=function(){var t=i.dispatch("change"),e=0;return{on:function(e,n){return arguments.length<2?t.on(e):(t.on(e,n),this)},trigger:Et(function(){t.apply("change",this,arguments),e+=1}),triggered:function(){return e}}},Wt=function(t){return t&&t.constructor===Object};D.prototype=L.prototype,L.prototype.toString=function(){return"[object d3Model]"},L.prototype.$on=function(t,e){1===arguments.length&&s(t)&&(e=t,t="");var n=t.split("."),r=n[0],i=A(this,r);return i?(this.$events.get(r)||n.push(this.uid),n[0]="change",i.on(n.join("."),e)):ct('Cannot bind to "'+r+'" - no such reactive property')},L.prototype.$change=function(t){var e,n=arguments.length?t:"",r=this.$events.get(n),i=dt(arguments,1);return r?(e=r.trigger).call.apply(e,[this].concat(bt(i))):ct("attribute '"+n+"' is not a reactive property this model"),this},L.prototype.$update=function(t,e){if(t){e=2!==arguments.length||e;for(var n in t)(e||void 0===this[n])&&("$"===n.substring(0,1)?this.constructor.prototype[n]?ct("Cannot set attribute method "+n+", it is protected"):this[n]=t[n]:this.$set(n,t[n]))}return this},L.prototype.$set=function(t,e){this.$events.get(t)?this[t]=e:C(this,t,e)},L.prototype.$new=function(t){var e=this,n=D(t);return Object.defineProperty(n,"parent",{get:function(){return e}}),n},L.prototype.$off=function(t){if(void 0===t)this.$events.each(function(t){return I(t)});else{var e=t.split("."),n=e.splice(0,1)[0],r=this.$events.get(n);r&&I(r,e.join("."))}},Object.defineProperty(L.prototype,"root",{get:function(){return this.parent?this.parent.root:this}});var Kt=gt({},Ct,{priority:1,create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){var n=this;if(this.active&&(this.removeAttribute(),t=this.mount(t))){var r=this,i=this.sel,a=function(){var e=r.expression?r.expression.eval(t):void 0;r.refresh(t,e)},s=void 0,u=void 0,c=void 0,l=void 0;if(r.identifiers=[],this.expression){var f=e.map();this.expression.identifiers().forEach(function(e){for(s=e.split("."),u=t,c=null,l=0;l<s.length-1;++l)if(u=u[s[l]],!o(u)){c=s.slice(0,l+1).join("."),ct("Property "+c+" is not an object. Directive "+r.name+" cannot bind to "+e);break}if(null===c){if(!(u instanceof D))return ct(e+" is not a reactive model. Directive "+r.name+" cannot bind to it");N(f,u,s[s.length-1])}}),f.each(function(t){t.events.has("")?r.identifiers.push({model:t.model,attr:""}):t.events.each(function(e){r.identifiers.push({model:t.model,attr:e})})})}else r.identifiers.push({model:t,attr:""});this.identifiers.forEach(function(t){var e=t.attr+"."+r.uid;t.model.$on(e,a)}),i.on("remove."+r.uid,function(){n.identifiers.forEach(function(t){t.model.$off(t.attr+"."+r.uid)}),r.destroy(t)}),a()}}}),Qt=function(t){function e(t,e,n){this.el=t,this.name=e.name,this.arg=n;var r=wt(zt(this)).create(e.value);r&&(this.expression=Ht(r)),this.active=!e.value||this.expression}function n(t,n,r){return new e(t,n,r)}return e.prototype=gt({},Kt,t),n.prototype=e.prototype,n},Zt=function(t){return t&&!s(t.size)?n.select(t):t},te=function(t){if(a(t))try{return JSON.parse(t)}catch(e){return t}return t},ee=gt({},Ct,{init:function(){},render:function(){},mounted:function(){},mount:function(t,e,r){if(!T(this)){var i=n.select(t),o=i.directives(),s=o?o.attrs:q(t),c=this.model,f=void 0,d=void 0,p=void 0;e=gt({},i.datum(),e);for(f in c)void 0!==(p=void 0===e[f]?s:e)[f]&&(c[f]=te(ot(p,f)));this.model=c=this.parent.model.$child(c),u(this.props)&&this.props.forEach(function(t){void 0!==(d=te(void 0===e[t]?s[t]:e[t]))&&(a(d)&&c[d]&&(d=c[d]),e[t]=d)}),c.name||(c.name=this.name);var h=this.render(e,s);if(l(h)){var v=this;return h.then(function(e){return X(v,t,e,r)})}return X(this,t,h,r)}ct("already mounted")}}),ne=["name","class","disabled","readonly","required","href"],re=function(t,e){var r=n.select(t),i=r.directives();if(i)return i;if(i=new U,!e)return i;for(var o=0;o<t.attributes.length;++o){var a=t.attributes[o],s=a.name.split("-"),u=s[2],c="d3"===s[0]?s[1]:null;if(c){!u&&ne.indexOf(c)>-1&&(u=c,c="attr");var l=e.get(c);l?i.add(l(t,a,u)):ct(t.tagName+' cannot find directive "'+c+'". Did you forget to register it?')}i.attrs[a.name]=a.value}return i.size()&&r.directives(i),i};U.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size()){var e=[],n=void 0;return this.forEach(function(r){l(n=r.execute(t))&&e.push(n)}),e.length?Promise.all(e):void 0}}},n.selection.prototype.mount=function(t,e){var r=[],i=void 0;return this.each(function(){var o=n.select(this).view();o?l(i=F(this,o,t,e))&&r.push(i):ct("Cannot mount, no view object available to mount to")}),r.length?Promise.all(r):null},n.selection.prototype.view=function(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),n=e.__d3_view__,r=e.parentNode;r&&!n;)n=r.__d3_view__,r=r.parentNode;return n},n.selection.prototype.model=function(){var t=this.view();return t?t.model:null},n.selection.prototype.directives=function(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__};var ie=gt({},ee,{use:function(t){return o(t)?t.install(this):t(this),this},addComponent:function(t,e){if(this.isMounted)return ct("already mounted, cannot add component");var n=k(t,e,ee);return this.components.set(t,n),n},addDirective:function(t,e){if(this.isMounted)return ct("already mounted, cannot add directive");var n=Qt(e);return this.directives.set(t,n),n},mount:function(t,e){if(T(this))ct("already mounted");else if(t=B(t))return this.model=this.parent?this.parent.model.$child(this.model):D(this.model),S(this,t,e)}}),oe=k("forView",null,ie),ae={attr:ft,html:pt,value:_t,on:jt,for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?ct('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,n.select(this.creator).remove(),this.el)return t},refresh:function(t,e){if(u(e)){var n=this.creator,r=n.tagName+"."+this.itemClass,i=this.itemName,o=this.sel,a=o.selectAll(r).data(e),s=o.view(),c=void 0;a.exit().remove(),a.enter().append(function(){return n.cloneNode(!0)}).classed(this.itemClass,!0).each(function(t,n){(c={index:n})[i]=t,oe({model:c,parent:s}).mount(this,function(t){e[n]=t.model[i]})})}}},if:{mount:function(t){return this.display=this.sel.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){e?this.sel.style("display",this.display):this.sel.style("display","none")}}},se=k("view",null,ie,M(e.map(),ae)),ue={logger:it},ce=function(t){ue.logger.warn("[d3-form] "+t)},le={inputData:function(t,e){var n=this.model;return e||(e={}),e.id=e.id||n.uid,n.data=e,t.attr("id",e.id),e.classes&&t.classed(e.classes,!0),H(t,n,e.attributes),e.disabled&&(a(e.disabled)?t.attr("d3-attr-disabled",e.disabled):t.property("disabled",!0)),e},wrap:function(t){var e=this,n=t;return e.model.$formExtensions.forEach(function(r){n=r(e,n,t)||n}),n},wrapTemplate:function(t,e){var r=document.createElement("div"),i=n.select(r).html(e).select("slot");if(!i.size())return ce("template does not provide a slot element"),t;var o=n.select(i.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),i.remove(),n.selectAll(r.children)}},fe=gt({},le,{model:{value:null,error:"",isDirty:null,changed:!1,srOnly:!1,placeholder:"",showError:{reactOn:["error","isDirty"],get:function(){return!!this.error&&this.isDirty}},$validate:function(){}},inputData:function(t,e){if(!(e=le.inputData.call(this,t,e)).name)return ce("Input field without a name");t.attr("name",e.name),e.placeholder=e.placeholder||e.label||e.name;var n=this.model;return n.form.inputs[e.name]=n,n.name=e.name,n.$on("value",function(){null===n.isDirty?n.isDirty=!1:(n.isDirty=!0,n.changed=!0),n.form.$change()}),e}}),de={text:"input",email:"input",password:"input",checkbox:"input",number:"input",date:"input",url:"input","datetime-local":"input"},pe=gt({},le,{render:function(t){var e=t?t.tag||"fieldset":"fieldset",n=this.createElement(e);return t=this.inputData(n,t),z.call(this,n)}}),he={get:function(t){var e=this.all.slice(0);if(o(t))for(var n in t)e.push(K(n,t[n]));return e},set:function(t,e){var n=t.model;n._view=t,n.validators.forEach(function(t){return t.set(e,n.data)}),n.$on("value.validate",this.validate),n.$validate=this.validate},validate:function(){for(var t,e,n=this,r=n._view,i=n.validators,o=n.value,a=r.sel.attr("id")===n.data.id?r.sel:r.sel.select("#"+n.data.id),s=0;s<i.length;++s)if(t=i[s],e=t.validate(a,o)){!0===e&&(e="");break}n.error=e||""},all:[{set:function(t,e){var n=e.required;a(n)?t.attr("d3-required",n):t.property("required",n||null)},validate:function(t,e){if(t.property("required")){if(!e)return"required";if(""===e)return!0}}},{set:function(t,e){var n=e.minLength;a(n)?t.attr("d3-attr-minlength",n):void 0!==n&&t.attr("minlength",n)},validate:function(t,e){var n=+t.attr("minlength");if(n===n&&n>0&&e.length<n)return"too short - "+n+" characters or more expected"}},{set:function(t,e){var n=e.maxLength;a(n)?t.attr("d3-attr-maxlength",n):void 0!==n&&t.attr("maxlength",n)},validate:function(t,e){var n=+t.attr("maxlength");if(n===n&&n>0&&e&&e.length>n)return"too long - "+n+" characters or less expected"}},{set:function(t,e){var n=e.minimum;a(n)?t.attr("d3-attr-min",n):void 0!==n&&t.attr("min",n)},validate:function(t,e){var n=W(t);if(n&&+e<n[0])return"must be greater or equal "+n[0]}},{set:function(t,e){var n=e.maximum;a(n)?t.attr("d3-attr-max",n):void 0!==n&&t.attr("max",n)},validate:function(t,e){var n=W(t);if(n&&+e>n[1])return"must be less or equal "+n[1]}}]},ve=["checkbox","radio"],me=gt({},fe,{render:function(t){var e=this.createElement("input");return t=this.inputData(e,t),e.attr("type",t.type||"text").attr("d3-value","value"),-1===ve.indexOf(e.attr("type"))&&e.attr("placeholder",t.placeholder),he.set(this,e),this.wrap(e)}}),ge=gt({},fe,{render:function(t){var e=this.createElement("textarea");return t=this.inputData(e,t),e.attr("placeholder",t.placeholder).attr("d3-value","value"),he.set(this,e),this.wrap(e)}}),ye=gt({},fe,{model:gt({options:[],$optionLabel:function(){return u(this.option)?this.option[1]||this.option[0]:this.option},$optionValue:function(){return u(this.option)?this.option[0]:this.option}},fe.model),render:function(t){var e=this.createElement("select");return t=this.inputData(e,t),e.attr("d3-value","value").attr("placeholder",t.placeholder).append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),he.set(this,e),this.wrap(e)}}),be=gt({},le,{render:function(t){var e=t?t.tag||"button":"button",r=this.createElement(e);t=this.inputData(r,t);var i=this.model;return i.type=t.type||"submit",t.endpoint&&(i.endpoint=t.endpoint),i.$submit=function(){i.actions.submit.call(i,n.event)},a(t.disabled)||(this.model.$set("disabled",t.disabled||null),t.disabled="disabled"),t.submit||(t.submit="$submit()"),r.attr("type",i.type).attr("name",i.name).attr("d3-attr-disabled",t.disabled).attr("d3-on-click",t.submit).html(t.label||"submit"),this.wrap(r)}}),Ee={default:function(t){this.message(t)},redirect:function(t){window.location.href=t.redirectTo||"/"}},we={submit:function(t){var e=this,n=e.form,r=gt({},xe,e.endpoint);t&&(t.preventDefault(),t.stopPropagation());var i=ue.fetch,o=n.$inputData(),a={};if(i)if(r.url){if("application/json"===r.contentType)a.headers={"Content-Type":r.contentType},a.body=JSON.stringify(o);else{a.body=new FormData;for(var s in o)a.body.set(s,o[s])}n.$setSubmit()?(a.method=r.method,i(r.url,a).then(function(t){n.$setSubmitDone();var e=(t.headers.get("content-type")||"").split(";")[0];"application/json"===e?t.json().then(function(e){n.$response(e,t.status,t.headers)}):ce("Cannot load content type '"+e+"'")},function(){n.$setSubmitDone()})):n.$setSubmitDone()}else ce("No url, cannot submit");else ce("fetch provider not available, cannot submit")}},xe={contentType:"application/json",method:"post"},Oe={props:["schema"],components:{"d3-form-fieldset":pe,"d3-form-input":me,"d3-form-textarea":ge,"d3-form-select":ye,"d3-form-submit":be},model:{formSubmitted:!1,formPending:!1,$isValid:function(t){var e=void 0,n=!0;for(var r in this.inputs)e=this.inputs[r],t&&(e.isDirty=!0),e.$validate(),e.error&&(n=!1);return n},$setSubmit:function(){return this.formSubmitted=!0,this.formPending=!0,this.$isValid(!0)},$setSubmitDone:function(){this.formPending=!1},$inputData:function(){var t,e=this.inputs,n={};for(var r in e)((t=e[r].value)||me.changed)&&(n[r]=t);return n},$response:function(t,e,n){if(e<300)if(this.data.resultHandler){var r=Ee[this.data.resultHandler];r?r.call(this,t,e,n):ce("Could not find "+this.data.resultHandler+" result handler")}else Ee.default.call(this,t,e,n);else this.$responseError(t,e,n)},$responseError:function(t){t.level="error",this.$message(t)}},render:function(t){function e(t){t=le.inputData.call(i,r,t),n.validators=he.get(t.validators);for(var e in we){var o=t[e];a(o)&&(o=i.model.$get(o)),n.actions[e]=o||we[e]}return z.call(i,r),r}var n=this.model,r=this.createElement("form").attr("novalidate",""),i=this;n.$formExtensions=this.root.$formExtensions||[],n.inputs={},n.actions={},n.form=n;var o=t.schema;return a(o)?(0,ue.fetch)(o,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(e);ce("Could not load form from "+o+": status "+t.status)}):e(o)}},Pe={install:function(t){t.addComponent("d3form",Oe),t.$formExtensions=[];for(var e in t.providers)ue[e]=t.providers[e]},actions:we,responses:Ee},$e={input:["inputGroup","label","formGroup"],checkbox:["formCheck"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t,e){var n=t.model.data;return t.wrapTemplate(e,Q(n))},formGroup:function(t,e,n){var r=t.model.data;return n.classed("form-control",!0).attr("d3-class","["+(r.required||!1)+' ? "form-control-required" : null, showError ? "form-control-danger" : null]'),t.wrapTemplate(e,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e,n){var r=t.model.data.group;if(!r)return e;var i="g"+n.attr("id");return n.attr("aria-describedby",i),t.wrapTemplate(e,Z(i,r))},formCheck:function(t,e,n){var r=t.model.data;return n.classed("form-check-input",!0),t.wrapTemplate(e,tt(r.label))},submit:function(t,e,n){var r=t.model.data.theme||"primary";return n.classed("btn",!0).classed("btn-"+r,!0),t.wrapTemplate(e,'<div class="form-group">\n<slot></slot>\n</div>')}}},_e={install:function(t){if(!t.$formExtensions)return ce("form bootstrap requires the form plugin installed first!");t.$formExtensions.push(et)}};t.view=se,t.viewMount=function(t,e,r,i){var o=n.select(t).html(e).mount(r,i);return o||(o=new Promise(function(t){t()})),o},t.viewModel=D,t.viewExpression=Ht,t.viewReady=function(t){ut.readyCallbacks.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",Y),window.addEventListener("load",Y)):G()},t.viewProviders=ut,t.viewWarn=ct,t.viewDebug=st,t.viewForms=Pe,t.viewBootstrapForms=_e,t.viewUid=zt,t.viewDebounce=Et,t.viewVersion="0.5.1",t.viewElement=g,t.viewTemplate=v,t.viewHtml=m,t.jsonResponse=y,Object.defineProperty(t,"__esModule",{value:!0})});