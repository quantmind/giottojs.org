// d3-visualize Version 0.1.1. Copyright 2017 quantmind.com.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("object-assign"),require("d3-array"),require("d3-random"),require("d3-collection"),require("d3-let"),require("d3-view"),require("d3-dsv"),require("d3-dispatch"),require("crossfilter"),require("d3-time-format"),require("d3-format"),require("d3-selection"),require("d3-transition"),require("d3-scale"),require("d3-axis"),require("d3-svg-legend"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","object-assign","d3-array","d3-random","d3-collection","d3-let","d3-view","d3-dsv","d3-dispatch","crossfilter","d3-time-format","d3-format","d3-selection","d3-transition","d3-scale","d3-axis","d3-svg-legend","d3-shape"],e):e(t.d3=t.d3||{},t.assign,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.crossfilter,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,i,r,a,o,s,l,u,d,c,h,f,p,g,m,v){"use strict";function y(t){var e=(t.headers.get("content-type")||"").split(";")[0];return"text/plain"===e||"text/csv"===e?t.text().then(s.csvParse):"application/json"===e?t.json():(st("Cannot load content type '"+e+"'"),[])}function w(t,e,n){a.isArray(t)&&(t={store:n,data:t,dimensions:{},series:r.map()}),Object.defineProperties(this,{_inner:{get:function(){return t}},store:{get:function(){return t.store}},data:{get:function(){return t.data}},dimensions:{get:function(){return t.dimensions}},series:{get:function(){return t.series}}}),this.serie=e}function x(t,e){return t.reduce(function(t,n){return void 0!==e(n)&&(t+=1),t})}function b(t,e){var n=void 0;return e?(e.forEach(function(e){e&&(n=e(t),a.isArray(n)?t=t.new(n):n&&(t=n))}),t):t}function S(t,e,n,i){var r=i.dataName(a.pop(n,"name")),o=[];Object.defineProperties(t,{name:{get:function(){return r}},store:{get:function(){return i}},type:{get:function(){return e}},transforms:{get:function(){return o}},config:{get:function(){return n}}}),t.initialise(n),t.addTransforms(a.pop(n,"transforms")),i.sources.set(r,t),Ot.call("init",void 0,t)}function k(t){var n=r.map();Object.defineProperties(this,{sources:{get:function(){return n}}}),this.transforms=e({},zt),this.dataCount=0,this.model=t}function C(t,e){return"string"==typeof t&&t.indexOf("%")===t.length-1?_t(.01*parseFloat(t)*e):+t}function P(t,e){var n={width:e.width,height:e.height};return n.width||(n.width=A(t),n.width?n.widthElement=z(t):n.width=Ft),n.height||(n.height=M(t),n.height?n.heightElement=O(t):n.height=Tt),n.height=C(n.height,n.width),n}function A(t){var e=E(t,"width");if(e)return D(e)}function M(t){var e=E(t,"width");if(e)return q(e)}function z(t){return E(t,"width")}function O(t){return E(t,"height")}function D(t){var e=t.getBoundingClientRect().width,n=h.select(t);return e-_(n.style("padding-left"))-_(n.style("padding-right"))}function q(t){var e=t.getBoundingClientRect().height,n=h.select(t);return e-_(n.style("padding-top"))-_(n.style("padding-bottom"))}function E(t,e){for(var n=t.node?t.node():t;n&&"BODY"!==n.tagName;){if(n.getBoundingClientRect()[e])return n;n=n.parentNode}}function _(t){return t&&"px"==t.substring(t.length-2)?+t.substring(0,t.length-2):0}function F(t){t.forEach(function(t){var e=t.removedNodes;e&&e.length&&e.forEach(function(t){"#text"!==t.nodeName&&(t.__visual__?T.call(t):h.select(t).selectAll(".d3-visual").each(T))})})}function T(){var t=this.__visual__;t?(t.destroy(),o.viewDebug('Removed "'+t.toString()+'" from DOM, '+jt.live.length+" live visuals left")):pt("d3-visual without __visual__ object")}function W(t,n){function i(e){var n=this.initialise(e);Object.defineProperties(this,{element:{get:function(){return n}},sel:{get:function(){return h.select(n)}},paperType:{get:function(){return t}}})}return i.prototype=e({},Nt,n),jt.papers[t]=i,i}function j(t){var e=t.getModel("menu"),n=t.dim(e.height,t.height,e.minHeight,e.maxHeight);t.menu.style("height",n+"px")}function R(t){var e=t.dataStore,n=a.pop(t.options,"data");e||(e=new k(t.getModel("dataContext")),t.model.dataStore=e),e.addSources(n)}function B(t){var e=t.dataStore,n=a.pop(t,"data");n&&(a.isString(n)&&(n={source:n}),n.name||(n.name=t.model.uid),n=e.addSources(n),n?t.model.$set("data",n.name):pt("Could not create data source "+n.name))}function $(t,e,n){var i=H(t.menu.style("height")),r=e.maxFontSize?Math.min(i-4,e.maxFontSize):i-4,a=n.dim(e.fontSize,t.width,e.minFontSize,r);t.menu.select(".title").html(e.text).style("font-size",a+"px").style("line-height",i+"px")}function H(t){return+t.substring(0,t.length-2)}function L(t,e){var n=e.options[t];if(void 0!==n&&!a.isObject(n)){var i=n||0;e.options[t]={left:i,right:i,top:i,bottom:i}}}function Y(t,e,n){return Jt.reduce(function(i,r){return i[r]=C(t[r],Kt.indexOf(r)>-1?e:n),i},{})}function V(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function N(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function X(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}}function I(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function U(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}}function G(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}}function J(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}function K(t,e,n){return{x:e.width-t.width-n.offsetX,y:e.height-t.height-n.offsetY}}function Q(t){return new t}function Z(t){return t}function tt(t,n){var i=t.records,r=t.data,a=t.model,o=n,s=void 0,l=void 0;n=o.splice(0,100),n.forEach(function(t){t.id?(s=t.id?i[t.id]:null,s?t=e(s,t):(r.push(t),i[t.id]=t)):r.push(t),a.columns.forEach(function(e){t[e.name]=e.$parse(t[e.name])})}),t.sel.select("tbody").selectAll("tr").data(r).enter().append("tr").attr("scope","row").selectAll("td").data(a.columns).enter().append("td").style("display",function(t){return t.hidden?"none":null}).html(function(t){return s=this.parentNode.__data__,l=s[t.name],t.$html(void 0===l?"":l)})}function et(){function t(t){var d=this;t.each(function(c,h){c=c.map(o).sort(n.ascending);var f=c.length,g=c[0],m=c[f-1],v=c.quartiles=l(c),y=s&&s(c),w=y&&y.map(function(t){return c[t]}),x=y?n.range(0,y[0]).concat(n.range(y[1]+1,f)):n.range(f),b=p.scaleLinear().domain(a&&a.call(d,c,h)||[g,m]).range([i,0]),S=d.__chart__||p.scaleLinear().domain([0,1/0]).range(b.range());d.__chart__=b;var k=t.selectAll("line.center").data(w?[w]:[]);k.enter().insert("line","rect").attr("class","center").attr("x1",e/2).attr("y1",function(t){return S(t[0])}).attr("x2",e/2).attr("y2",function(t){return S(t[1])}).style("opacity",1e-6).transition().duration(r).style("opacity",1).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}),k.transition().duration(r).style("opacity",1).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}),k.exit().transition().duration(r).style("opacity",1e-6).attr("y1",function(t){return b(t[0])}).attr("y2",function(t){return b(t[1])}).remove();var C=t.selectAll("rect.box").data([v]);C.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(t){return S(t[2])}).attr("width",e).attr("height",function(t){return S(t[0])-S(t[2])}).transition().duration(r).attr("y",function(t){return b(t[2])}).attr("height",function(t){return b(t[0])-b(t[2])}),C.transition().duration(r).attr("y",function(t){return b(t[2])}).attr("height",function(t){return b(t[0])-b(t[2])});var P=t.selectAll("line.median").data([v[1]]);P.enter().append("line").attr("class","median").attr("x1",0).attr("y1",S).attr("x2",e).attr("y2",S).transition().duration(r).attr("y1",b).attr("y2",b),P.transition().duration(r).attr("y1",b).attr("y2",b);var A=t.selectAll("line.whisker").data(w||[]);A.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",S).attr("x2",e).attr("y2",S).style("opacity",1e-6).transition().duration(r).attr("y1",b).attr("y2",b).style("opacity",1),A.transition().duration(r).attr("y1",b).attr("y2",b).style("opacity",1),A.exit().transition().duration(r).attr("y1",b).attr("y2",b).style("opacity",1e-6).remove();var M=t.selectAll("circle.outlier").data(x,Number);M.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",function(t){return S(c[t])}).style("opacity",1e-6).transition().duration(r).attr("cy",function(t){return b(c[t])}).style("opacity",1),M.transition().duration(r).attr("cy",function(t){return b(c[t])}).style("opacity",1),M.exit().transition().duration(r).attr("cy",function(t){return b(c[t])}).style("opacity",1e-6).remove();var z=u||b.tickFormat(8),O=t.selectAll("text.box").data(v);O.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(t,e){return 1&e?6:-6}).attr("x",function(t,n){return 1&n?e:0}).attr("y",S).attr("text-anchor",function(t,e){return 1&e?"start":"end"}).text(z).transition().duration(r).attr("y",b),O.transition().duration(r).text(z).attr("y",b);var D=t.selectAll("text.whisker").data(w||[]);D.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",S).text(z).style("opacity",1e-6).transition().duration(r).attr("y",b).style("opacity",1),D.transition().duration(r).text(z).attr("y",b).style("opacity",1),D.exit().transition().duration(r).attr("y",b).style("opacity",1e-6).remove()})}var e=1,i=1,r=0,a=null,o=Number,s=nt,l=it,u=null;return t.width=function(n){return arguments.length?(e=n,t):e},t.height=function(e){return arguments.length?(i=e,t):i},t.tickFormat=function(e){return arguments.length?(u=e,t):u},t.duration=function(e){return arguments.length?(r=e,t):r},t.domain=function(e){return arguments.length?(a=null===e?e:me(e),t):a},t.value=function(e){return arguments.length?(o=e,t):o},t.whiskers=function(e){return arguments.length?(s=e,t):s},t.quartiles=function(e){return arguments.length?(l=e,t):l},t}function nt(t){return[0,t.length-1]}function it(t){return[n.quantile(t,.25),n.quantile(t,.5),n.quantile(t,.75)]}e=e&&e.hasOwnProperty("default")?e.default:e,u=u&&u.hasOwnProperty("default")?u.default:u;var rt={sigma:.1,drift:0},at=function(t,r){r=e({},rt,r);for(var a,o=n.range(0,+t,1),s=r.sigma,l=r.drift,u=[{x:0,y:0}],d=i.randomNormal(0,1),c=1;c<o.length;c++)a=l+s*d(),u[c]={x:c,y:u[c-1].y+a};return u},ot={initialise:function(t){this._data=t.data},getConfig:function(t){return a.isArray(t)?{data:t}:a.isObject(t)&&a.isArray(t.data)?t:void 0},getData:function(){return o.resolvedPromise(this.asFrame(this._data))}},st=function(t){o.viewProviders.logger.warn("[d3-data-source] "+t)},lt=["http","https","ws","wss"],ut=function(t){return a.isString(t)&&lt.indexOf(t.split("://")[0])>-1},dt={getConfig:function(t){return ut(t)?{url:t}:a.isObject(t)&&t.url?t:void 0},initialise:function(t){this.url=t.url},getData:function(){var t=o.viewProviders.fetch,e=this;return t?t(this.url).then(y).then(function(t){return e.asFrame(t)}):(st("fetch provider not available, cannot submit"),o.resolvedPromise([]))}},ct={initialise:function(t){this.source=t.source},getConfig:function(t){if(a.isObject(t)&&t.source)return a.isArray(t.source)||(t.source=[t.source]),t},getData:function(){var t=this.store,e=this,n=void 0;return Promise.all(this.source.map(function(e){return t.getData(e)})).then(function(t){return n=1===t.length?t[0]:e.mergeFrames(t),e.asFrame(n)})},mergeFrames:function(t){return t[0]}},ht={initialise:function(t){this.expression=o.viewExpression(t.expression)},getConfig:function(t){if(a.isObject(t)&&t.expression)return t},getData:function(){var t=this,e=this.store.model;return o.resolvedPromise(this.expression.eval(e)).then(function(e){return t.asFrame(e)})}},ft=function(t){return function(e){return e[t]}};w.prototype={size:function(){return this.data.length},new:function(t){return a.isArray(t)?new w(t,null,this.store):new w(this._inner,t)},cf:function(){return this._inner.cf||(this._inner.cf=u(this.data)),this._inner.cf},dimension:function(t,e,n){1===arguments.length&&(n=!0);var i=this.dimensions[t];if(i){if(n)return i;i.dispose()}return e||(e=ft(t)),this.dimensions[t]=this.cf().dimension(e),this.dimensions[t]},sortby:function(t,e){return this.new(this.dimension(t).top(e||1/0))},pivot:function(t,e,n,i){function r(r){var a=void 0,o=void 0;return function(s,l){return a=""+l[e],o=r*l[n],s[t]=l[t],a in s?s[a]+=o:s[a]=o,i in s?s[i]+=o:s[i]=o,s}}var a=this.dimension(t).group();return i||(i="total"),this.new(a.reduce(r(1),r(-1),Object).all().map(function(t){return t.value}))},add:function(){},map:function(t){return this.new(this.data.map(t))}};var pt=function(t){o.viewProviders.logger.warn("[d3-visualize] "+t)},gt=function(t){function e(t){if(n){var e=t.dimension(n);return t.new(e.group())}}var n=t.dimension;return n||pt('Filter transform requires a "dimenstion" entry'),e},mt=function(t,e){var n=new Array(t);return n.fill(e),n},vt=r.map({count:x,max:n.max,min:n.min,sum:n.sum,mean:n.mean,median:n.median,variance:n.variance,deviation:n.deviation}),yt=r.map({count:function(t){return t+1},sum:function(t,e){return t+e},max:Math.max,min:Math.min}),wt=function(t){function e(t){var e=void 0;return t.data.reduce(function(t,n){for(e in n)e in t?t[e]+=1:t[e]=1;return t},{})}function n(t){var e,n,a=[];return l?i(t):(r.forEach(function(i,r){e=o[r],n=x,e&&((n=vt.get(e))||(n=x,pt("Operation "+o[r]+" is not supported, use count"))),a.push({label:s[r]||i,data:n(t.data,function(t){return t[i]})})}),a)}function i(t){var e=void 0,n=void 0,i=void 0,a=r.map(function(t,e){return n=o[e],i=yt.get("count"),n&&((i=yt.get(n))||(i=yt.get("count"),pt("Operation "+n+" is not supported, use count"))),{field:t,as:s[e]||t,op:i}});return t.dimension(l).group().reduce(function(t,n){return a.reduce(function(t,i){return e=0,i.as in t&&(e=t[i.as]),t[i.as]=i.op(e,n[i.field]),t},t)},null,Object).all().map(function(t){return t.value[l]=t.key,t.value})}var r=t.fields,o=t.ops,s=t.as,l=t.groupby;return r||o?a.isArray(r)?(o||(o="count"),a.isString(o)&&(o=mt(r.length,o)),a.isArray(o)?(o.length<r.length&&pt("Aggregate transforms expects an ops array with same length as fields"),s||(s=[]),a.isArray(s)?n:pt("Aggregate transform expects an array of as fields")):pt("Aggregate transform expects an array of ops")):pt("Aggregate transforms expect an array of fields"):e},xt=function(t){function e(t){var e=void 0,r=void 0;return n.reduce(function(n,o,s){return r=i[s],a.isString(r)&&(r=t.store.eval(r)),r&&(e=n.dimension(o).filterAll(),n=n.new(e.filter(r).top(1/0))),n},t)}var n=t.fields,i=t.query;return a.isArray(n)?a.isArray(i)?i.length!=n.length?pt("crossfilter transform expects an query array with same length as fields"):e:pt("crossfilter transform expects an array of query"):pt("crossfilter transform expects an array of fields")},bt=function(t){function e(t){if(n){if(i){var e,r=t.dimension(i),a=r.group().top(1/0),o=t.new([]);return a.forEach(function(i){e=t.new(r.filterExact(i.key).top(1/0)).dimension(n).group().top(1/0),o.series.set(i.key,t.new(e).dimension("key").top(1/0))}),o}return t.new(t.dimension(n).top(1/0))}return t}var n=t.sortby,i=t.groupby;return n||pt('timeseries transform requires a "sortby" entry'),e},St={dataSource:null,size:{width:null,height:"70%"}};St.dateFormat="%d-%b-%y";var kt={date:function(t){return d.utcParse(t.dateFormat||St.dateFormat)},number:function(){return parseFloat}},Ct=function(t){function n(t){var e=[];return i.each(function(t,n){a.isString(t)&&(t={type:t}),s=kt[t.type],s?e.push([n,s(t)]):pt("Cannot convert field "+n+" to type "+t.type)}),e.length&&(t=t.map(function(t){for(o=0;o<e.length;++o)t[e[o][0]]=e[o][1](t[e[o][0]]);return t})),t}t=e({},St.dateFormat,t);var i=r.map(t.fields),o=void 0,s=void 0;return n},Pt={validate:function(){return!0}},At=function(t,e,n){return Math.max(Math.min(t,n),e)},Mt=function(t){function e(t){function e(e){return n(e,t)}return r.validate(t)?e:r.logError()}var n=t.transform,i=t.schema||{},r=o.viewProviders.jsonValidator?o.viewProviders.jsonValidator(t.schema):Pt;return i.type||(i.type="object"),e.schema=i,e}({shema:{description:"Create moving average series from existing one. The new series override the existing one unless the as array is provided",properties:{method:{type:"string"},alpha:{type:"number"},period:{type:"number"},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}}},required:["fields"]},transform:function(t,e){var n=e.as||[],i=e.method||"ema",r=void 0,a=void 0,o=void 0;e.fields.forEach(function(s,l){if(r=n[l]||s,"sma"===i){var u=Math.max(e.period||10,1),d=[],c=[];t.data.forEach(function(t,e){a=t[s],d.length===u&&(a-=c.splice(0,1)[0]),c.push(a),e&&(a+=d[d.length-1]),d.push(a),t[r]=a/d.length})}else{var h=At(e.alpha||.5,1-.999999,.999999);t.data.forEach(function(t,e){a=t[s],o=e?h*o+(1-h)*a:a,t[r]=o})}})}}),zt=r.map({filter:gt,aggregate:wt,mapfields:Ct,timeseries:bt,crossfilter:xt,movingaverage:Mt}),Ot=l.dispatch("init","data"),Dt={getConfig:function(){},initialise:function(){},getData:function(){},addTransforms:function(t){var e=this,n=void 0;t&&(a.isArray(t)||(t=[t]),t.forEach(function(t){n=zt.get(t.type),n?e.transforms.push(n(t)):pt('Transform "'+t.type+'" not known')}))},asFrame:function(t){return a.isArray(t)&&(t=t.map(function(t){return t.constructor!==Object&&(t={data:t}),t}),t=new w(t,null,this.store)),b(t,this.transforms)}},qt=e(r.map(),{events:Ot,add:function(t,n){function i(e,n){S(this,t,e,n)}return i.prototype=e({},Dt,n),this.set(t,i),i},create:function(t,e){for(var n,i=this.values(),r=0;r<i.length;++r)if(n=i[r].prototype.getConfig(t))return new i[r](n,e)}});qt.add("array",ot),qt.add("remote",dt),qt.add("composite",ct),qt.add("expression",ht),k.prototype={size:function(){return this.sources.size()},addSources:function(t){if(a.isString(t)&&(t={source:t}),a.isArray(t)){var e=this;return t.map(function(t){return qt.create(t,e)})}if(t)return qt.create(t,this)},addTransforms:function(t){e(this.transforms,t)},source:function(t,e){if(1===arguments.length)return this.sources.get(t);if(null===e){var n=this.sources.get(t);return this.sources.remove(t),n}return this.sources.set(t,e),this},clearCache:function(){this.sources.each(function(t){delete t.cachedFrame})},getData:function(t){var e=this.sources.get(t);if(!e)throw new Error("Data source "+t+" not available");return e.cachedFrame?o.resolvedPromise(e.cachedFrame):e.getData().then(function(t){return e.config.cache&&(e.cachedFrame=t),t})},eval:function(t,e){var n=this.model;return e&&(n=n.$child(e)),o.viewExpression(t).safeEval(n)},dataName:function(t){return this.dataCount++,t?""+t:this.source("default")?"source"+this.dataCount:"default"}};var Et={formatDate:d.timeFormat("%d/%m/%Y"),formatDateTime:d.timeFormat("%a %e %b %X %Y"),load:function(t){var e=this,n=qt.create("https://unpkg.com/d3-format/locale/"+t+".json"),i=qt.create("https://unpkg.com/d3-time-format/locale/"+t+".json");return Promise.all([n.load().then(function(n){e.symbol=t,e.number=n,c.formatDefaultLocale(n)}),i.load().then(function(t){e.time=t,e.formatDate=d.timeFormat(t.date),e.formatDateTime=d.timeFormat(t.dateTime),d.timeFormatDefaultLocale(t)})])}},_t=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},Ft=400,Tt="75%",Wt=["visual","container"],jt={live:[],types:{},papers:{},options:St,events:l.dispatch("before-init","after-init","before-draw","after-draw")},Rt=e({},{initialise:function(){},draw:function(){},redraw:function(){if(this.drawing){var t=this,e="after-draw."+this.toString();jt.events.on(e,function(){jt.events.on(e,null),t.redraw()})}else this.drawing=this.draw();return this.drawing},select:function(t){return h.select(t)},destroy:function(){},toString:function(){return this.visualType+"-"+this.model.uid},getModel:function(t){t||(t=this.visualType);var e=this.model[t];if(!e&&t in St){var n=a.pop(this.options,t),i=this;this.visualParent?e=this.visualParent.getModel(t).$child(n):(e=this.model.$new(St[t]),e.$update(n)),this.model[t]=e,e.$on(function(){return i.draw()})}return e},dim:function(t,e,n,i){return t=Math.max(C(t,e),n||0),i&&(i=Math.max(i,n||0),t=Math.min(t,i)),t},pop:function(t){if(t){var e=t.live.indexOf(this);e>-1&&t.live.splice(e,1)}}},o.viewBase),Bt=function(t,n){function i(e,n,i,r){Object.defineProperties(this,{visualType:{get:function(){return t}},isViz:{get:function(){return-1===Wt.indexOf(t)}}}),this.visualParent=i,this.model=i?i.model.$new():r||o.viewModel(),this.options=n||{},this.drawing=!1,jt.events.call("before-init",void 0,this),this.initialise(e),jt.events.call("after-init",void 0,this)}var r=a.pop(n,"options");return r&&(St[t]=r),i.prototype=e({},Rt,n),jt.types[t]=i,i},$t=Bt("visual",{options:{render:"svg",width:null,height:"70%",heightElement:null},initialise:function(t){if(!t)throw new Error("HTMLElement required by visual group");if(this.visualParent&&"container"!==this.visualParent.visualType)throw new Error("Visual parent can be a container only");this.select(t).select(".paper").node()||this.select(t).append("div").classed("paper",!0),Object.defineProperties(this,{element:{get:function(){return t}},paper:{get:function(){return this.sel.select(".paper")}},sel:{get:function(){return h.select(t)}},size:{get:function(){return[this.width,this.height]}}}),this.sel.classed("d3-visual",!0),this.layers=[],this.drawCount=0,jt.live.push(this),t.__visual__=this,this.visualParent&&this.visualParent.live.push(this)},toString:function(){return"visual "+this.model.uid},draw:function(){if(this.drawing)return pt(this.toString()+" already drawing"),this.drawing;this.drawCount?(this.drawCount++,this.clear()):(this.drawCount=1,this.fit());var t=this;return jt.events.call("before-draw",void 0,this),Promise.all(this.layers.map(function(t){return t.redraw()})).then(function(){delete t.drawing,jt.events.call("after-draw",void 0,t)},function(e){delete t.drawing,pt("Could not draw "+t.toString()+": "+e)})},clear:function(){},addVisual:function(t){var e=a.pop(t,"type"),n=jt.types[e];if(n)return new n(this.element,t,this);pt("Cannot add visual "+t.type)},fit:function(){this.resize(null,!0)},resize:function(t,e){t||(t=P(this.element.parentNode||this.element,this.getModel()));var n=this.size;(e||n[0]!==t.width||n[1]!==t.height)&&(e||o.viewDebug('Resizing "'+this.toString()+'"'),this.width=t.width,this.height=t.height,this.paper.style("width",this.width+"px").style("height",this.height+"px"),e||this.draw())},destroy:function(){this.pop(this.visualParent),this.pop(jt)}});if(a.inBrowser){new MutationObserver(F).observe(document.documentElement,{childList:!0,subtree:!0})}var Ht=function(t,e,n,i){return n.substring(0,e.length)!==e&&(n=""+e+n[0].toUpperCase()+n.substring(1)),i?t[n]:t[n]()},Lt=function(t){for(var n=[{},Yt,Vt],i=1;i<arguments.length;++i)n.push(arguments[i]);return Bt(t,e.apply(void 0,n))},Yt={initialise:function(t){var e=this.visualParent;if(e){if("visual"!==e.visualType)throw new Error("visual parent of "+this.visualType+' can only be "visual"')}else this.visualParent=e=new $t(t,this.options,null,this.model),this.model=e.model.$new(),this.options={};e.layers.push(this)},paper:function(){var t=this.getModel("visual"),e=this._paper;if(e&&e.paperType===t.render)return e;var n=jt.papers[t.render];if(!n)throw new Error("Unknown paper "+t.render);return e=new n(this),this._paper=e,e},translate:function(t,e){return a.isFunction(t)?function(n){return"translate("+(t(n)||0)+", "+(e(n)||0)+")"}:"translate("+t+", "+e+")"},getScale:function(t){return Ht(p,"scale",t)},displayError:function(){}},Vt={draw:function(){var t=this;if(this.drawing)return pt(this.toString()+" already drawing"),this.drawing;var e=this;jt.events.call("before-draw",void 0,this),this.getData().then(function(n){delete e.drawing,n&&(t.doDraw(n),jt.events.call("after-draw",void 0,e))},function(n){delete e.drawing,pt("Could not draw "+e.toString()+": "+n),t.displayError(n)})}},Nt={initialise:function(){},transition:function(){},size:function(t){return this.sel.attr("width",t.width).attr("height",t.height),this},group:function(t){t||(t="main");var e=this.sel;return e.selectAll("."+t).data([0]).enter().append("g").classed(t,!0),e.select("."+t)},dim:function(t){return t}},Xt=W("svg",{initialise:function(t){return t.visualParent.paper.append("svg").attr("id",t.model.uid).classed(t.visualType,!0).node()}});St.menu={display:!1,height:"8%",maxHeight:50,minHeight:20},jt.events.on("after-init.menu",function(t){if("visual"===t.visualType){t.getModel("menu").display&&(t.menu=t.sel.insert("nav",":first-child").classed("d3-nav navbar p-1",!0),t.menu.append("h4").classed("title",!0))}}),jt.events.on("before-draw.menu",function(t){t&&t.menu&&j(t)});var It=r.map(),Ut=function(t,e){var n=It.get(t);return n||(n=c.format(t),It.set(t,n)),n(e)};if(jt.options.dataContext={$format:Ut},Yt.getData=function(){var t=this.model.data;return t?this.dataStore.getData(t):(pt("Visual "+this.visualType+" without data name, cannot get data"),o.resolvedPromise())},Yt.getContext=function(t){return this.dataStore.model.$child(t)},jt.events.on("before-init.data",function(t){t.isViz&&(t.data=a.pop(t.options,"data"))}),jt.events.on("after-init.data",function(t){Object.defineProperties(t,{dataStore:{get:function(){return t.visualParent?t.visualParent.dataStore:t.model.dataStore}}}),t.isViz?B(t):R(t)}),St.resizeDelay||(St.resizeDelay=200),a.inBrowser){var Gt=o.viewDebounce(function(){jt.live.forEach(function(t){return t.resize()})},St.resizeDelay);h.select(window).on("resize.visuals",Gt)}St.title={text:null,fontSize:"5%",minFontSize:15,maxFontSize:25},jt.events.on("before-init.title",function(t){var e=t.options.title;a.isString(e)&&(t.options.title={text:e})}),jt.events.on("before-draw.title",function(t){var e=t.getModel("title");if(e.text){var n=t.isViz?t.visualParent:t;"visual"===n.visualType&&n.menu&&$(n,e,t)}});var Jt=["top","bottom","left","right"],Kt=["left","right"];St.margin={top:20,bottom:20,left:20,right:20},St.padding={top:0,bottom:0,left:0,right:0},Yt.boundingBox=function(){var t=this.visualParent.width,e=this.visualParent.height,n=Y(this.getModel("margin"),t,e),i=Y(this.getModel("padding"),t,e),r=Jt.reduce(function(t,e){return t[e]=n[e]+i[e],t},{});return{width:t,height:e,margin:n,padding:n,total:r,innerWidth:t-r.left-r.right,innerHeight:e-r.top-r.bottom}},jt.events.on("after-init.margin",function(t){t.margin=L("margin",t),t.padding=L("padding",t)});var Qt=r.map({top:g.axisTop,bottom:g.axisBottom,left:g.axisLeft,right:g.axisRight});St.xAxis={location:"bottom"},Yt.axis=function(t,e){return Qt.get(t)(e)};var Zt=r.map();St.color={scale:"cool",scaleMinPoints:6,scaleOffset:0,stroke:"#333",strokeOpacity:1,fillOpacity:1},Zt.set("viridis",function(){return p.scaleSequential(p.interpolateViridis)}),Zt.set("inferno",function(){return p.scaleSequential(p.interpolateInferno)}),Zt.set("magma",function(){return p.scaleSequential(p.interpolateMagma)}),Zt.set("plasma",function(){return p.scaleSequential(p.interpolatePlasma)}),Zt.set("warm",function(){return p.scaleSequential(p.interpolateWarm)}),Zt.set("cool",function(){return p.scaleSequential(p.interpolateCool)}),Zt.set("rainbow",function(){return p.scaleSequential(p.interpolateRainbow)}),Zt.set("cubehelix",function(){return p.scaleSequential(p.interpolateCubehelixDefault)}),Yt.colors=function(t){var e=this.getModel("color"),i=Zt.get(e.scale);if(!i)throw new Error("Unknown scale "+e.scale);a.isObject(i)||(i={scale:i}),void 0===i.minPoints&&(i.minPoints=e.scaleMinPoints);var r=e.scaleOffset,o=t+r,s=Math.max(o,i.minPoints),l=i.reversed?[s-1,0]:[0,s-1],u=i.scale().domain(l);return n.range(r,Math.min(o,s)).map(function(t){return u(t)})},Yt.linearGradient=function(t,e){var n=o.viewUid(),i=this.paper.select("defs");i.node()||(i=this.paper.append(i));var r=i.append("linearGradient").attr("id",n).attr("x1","0%").attr("y1","0%");"vertical"===e?r.attr("x2","0%").attr("y2","100%"):r.attr("x2","100%").attr("y2","0%")},St.legend={location:"top-right",orient:"vertical",fontSize:"3%",title:"",titleWidth:"20%",titleMinWidth:30,titleMaxWidth:60,minFontSize:10,maxFontSize:20,offsetX:10,offsetY:10};var te={color:m.legendColor,size:m.legendSize,symbol:m.legendSymbol};Yt.legend=function(t,e){var n=this.getModel(),i=this.getModel("legend"),r=n.legendType,a=this.dim(i.fontSize,e.height,i.minFontSize,i.maxFontSize);if(r){var o=te[r];if(!o)return pt("Could not load legend "+r);if(o=o().orient(i.orient),i.title){var s=this.dim(i.titleWidth,e.width,i.titleMinWidth,i.titleMaxWidth);o.title(i.title).titleWidth(s)}for(var l in t)o[l](t[l]);var u=this.paper().group("legend").style("font-size",a+"px").call(o),d=ee.get(i.location)(u.node().getBBox(),e,i);u.attr("transform",this.translate(d.x,d.y))}};var ee=r.map({top:V,bottom:N,right:X,left:I,"top-left":U,"top-right":G,"bottom-left":J,"bottom-right":K}),ne=function(t,e){return t.require("clusterize.js@0.17.6").then(function(t){return Q(t)})},ie=function(t){return t},re={over:!0,small:!0,bordered:!0,loadingClass:"table-info",loadingTextClass:"text-center"},ae=function(t,n){var i=t.model.style;i.$update(e({},re,n)),i.tableClass="table table-responsive",i.striped&&(i.tableClass+=" table-striped"),i.over&&(i.tableClass+=" table-hover"),i.bordered&&(i.tableClass+=" table-bordered"),i.small&&(i.tableClass+=" table-sm")},oe={bootstrap:ae,clusterize:ne,paginate:ie},se=Bt("container",{initialise:function(){this.live=[],this.visualParent&&this.visualParent.live.push(this)},draw:function(){if(this.drawing)return pt(this.toString()+" already drawing"),this.drawing;var t=this;return jt.events.call("before-draw",void 0,t),Promise.all(this.live.map(function(t){return t.redraw()})).then(function(){delete t.drawing,jt.events.call("after-draw",void 0,t)})},destroy:function(){this.pop(this.visualParent)}}),le={props:["schema","datasource","plugins"],render:function(t,e,n){var i=this,r=this.select(n).html();return this.getSchema(t.schema,function(t){return a.isObject(t)||(t={}),i.build(t,r,e)})},getSchema:function(t,e){var n=this.model.visual;if(n&&n!==this.model&&a.isString(t)){var i=n.options.visuals[t];i&&(t=i)}return a.isString(t)?this.json(t).then(e):e(t)},build:function(){}},ue=e({},le,{build:function(t,e,n){var i=this.model,r=this.createElement("div"),a=i.root;return n.class&&r.attr("class",n.class),t.visuals||(t.visuals={}),i.visual=new se(r.node(),t,i.visual),a.visualDashboard||(a.visualDashboard=i.visual),this.mountInner(r,e)}}),de=e({},le,{build:function(t){var e,n=this.createElement("div"),i=t.type||"visual",r=this.model,o={};return"visual"===i?(e=a.pop(t,"layers"),o=t):o.visual=a.pop(t,"visual")||{},r.visual=new $t(n.node(),o,r.visual),"visual"!==i?r.visual.addVisual(t):e&&e.forEach(function(t){return r.visual.addVisual(t)}),n},mounted:function(){this.model.visual.redraw()}}),ce={date:d.isoParse,string:function(t){return""+t}},he={number:function(t){return t},date:function(t){return Et.formatDate(t)},boolean:function(t){return t}},fe=function(t){var e=[],n=void 0;if(!t)return e;if(a.isArray(t)&&(t={properties:t}),a.isObject(t.properties))for(var i in t.properties)n=t.properties[i],a.isObject(n)&&(n.name||(n.name=i),e.push(n));else Array.prototype.push.apply(e,t.properties);return e.map(function(t){return a.isObject(t)||(t={name:t}),t.label||(t.label=t.name),t.hidden||(t.hidden=!1),t.$parse||(t.$parse=ce[t.type]||ce.string),t.$html||(t.$html=he[t.type]||Z),t})},pe=e({},le,{model:function(){return{header:!0,columns:[],loadingData:!1,style:{tableClass:null,headerClass:null,headerRowClass:null,loadingClass:"loading",loadingTextClass:null}}},build:function(t){var e=this,n=this.model,i=t.plugins||[];if(this.records={},this.data=[],this.template='<table d3-class="[style.tableClass, loadingData ? \'loading\' : null]">\n<thead d3-class="style.headerClass">\n<tr d3-class="style.headerRowClass">\n  <th d3-for="col in columns"\n        d3-html="col.label"\n        d3-if="!col.hidden">\n  </th>\n</tr>\n<tr d3-if="loadingData" d3-class="style.loadingClass">\n    <td d3-attr-colspan="columns.length">\n        <p d3-class="style.loadingTextClass">loading data</p>\n    </td>\n</tr>\n</thead>\n<tbody></tbody>\n</table>',n.columns=fe(t),a.isArray(i)){var r=[],o=void 0;if(i.forEach(function(t){a.isString(t)&&(t={name:t}),oe[t.name]?(o=oe[t.name](e,t),
a.isPromise(o)&&r.push(o)):pt("Unknown table plugin "+t.name)}),r.length)return Promise.all(r).then(function(){return e.viewElement(e.template)})}else pt("plugins should be an array");return this.viewElement(this.template)},mounted:function(){var t=this,e=this.model;if(e.dataLoader){var n=e.dataLoader.load(e.columns);n&&(e.loadingData=!0,n.then(function(n){e.loadingData=!1,tt(t,n)},function(t){return e.loadingData=!1,t}))}}}),ge={tabularPlugins:oe,install:function(t){t.addComponent("dashboard",ue),t.addComponent("visual",de),t.addComponent("tabular",pe)}},me=function(t){return function(){return t}},ve=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},ye=function(t){return t},we=function(){function t(t){var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,h=void 0,f=void 0,p=void 0,g=void 0,m=t.length,v=.5*r/i,y=new Array(m),w=new Array(m);for(a=0;a<m;++a)y[w[a]=a]=+e(t[a],a,t);for(w.sort(function(t,e){return ve(y[t],y[e])}),f=y[w[0]],d=null,a=m-1;a>=0;--a)l=[],null===d?l.push([0,0]):(h=d+p,c=h*v,l.push([c,h]),l.push([-c,h])),o=w[a],s=m-a-1,u=y[o]/f,g=Math.sqrt(u),d=i*g,p=a?n(g,s):0,h=d-p,c=h*v,l.push([-c,h]),l.push([c,h]),y[o]={index:s,value:y[o],fraction:u,points:l,data:t[o]};return y}var e=ye,n=me(0),i=1,r=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:me(+n),t):e},t.base=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:me(+e),t):n},t},xe={getDataInfo:function(t){var e=this.getModel(),n=this.newRange(),i=t.series.size(),r=i?t.series.values():[t.data],a=i?t.series.keys():[e.y],o=ft(e.x),s=ft(e.y),l=this;return{data:r,range:n,meta:a.map(function(t,e){return{index:e,label:t,range:l.range(r[e],o,s,n)}})}},fill:function(t){function e(t,e){return n[e]}var n=this.colors(t.length);return e.colors=n,e},curve:function(t){var e=Ht(v,"curve",t,!0);return e||(pt('Could not locate curve type "'+t+'"'),e=Ht(v,"curve","cardinalOpen",!0)),e},range:function(t,e,i,r){var a={x:n.extent(t,e),y:n.extent(t,i)};r&&(Array.prototype.push.apply(r.x,a.x),Array.prototype.push.apply(r.y,a.y))},newRange:function(){return{x:[],y:[]}},x:function(t,e){var i=this.getModel(),r=this.getScale(i.scaleX).domain(n.extent(e)).range([0,t.innerWidth]);return function(t){return r(t[i.x])}},y:function(t,e,i){var r=this.getModel(),a=this.getScale(r.scaleY).domain(n.extent(e)).range([t.innerHeight,0]);return 2===arguments.length&&(i=function(t){return t[r.y]}),function(t){return a(i(t))}}},be=Lt("linechart",xe,{options:{lineWidth:1,curve:"cardinalOpen",x:"x",y:"y",scaleX:"linear",scaleY:"linear"},doDraw:function(t){var e=this,n=this.newRange(),i=this.getModel(),r=this.getModel("color"),a=ft(i.x),o=ft(i.y),s=t.series.values(),l=t.series.keys().map(function(t,i){return{index:i,label:t,range:e.range(s[i],a,o,n)}}),u=this.boundingBox(),d=this.paper(),c=d.size(u).group().attr("transform",this.translate(u.total.left,u.total.top)).selectAll(".line").data(s),h=this.fill(l),f=v.line().x(this.x(u,n.x)).y(this.y(u,n.y)).curve(this.curve(i.curve));c.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",h).attr("stroke-opacity",0).attr("stroke-width",i.lineWidth).merge(c).attr("stroke",h).attr("stroke-opacity",r.strokeOpacity).attr("stroke-width",i.lineWidth).attr("d",f),c.exit().remove()}}),Se=Lt("barchart",xe,{options:{orientation:"vertical",sortby:null,stack:!0,normalize:!1,scale:"linear",padding:.1,x:"x",y:"y",groupby:null,valueformat:".1f",legendType:"color",legendLabel:"label"},doDraw:function(t){function e(t){return y(t[1-P])-y(t[P])}function i(t){return m(t.data[f])}function r(t){return y(t[P])}var a,o,s=this.getModel(),l=this.getModel("color"),u=t.data,d=this.boundingBox(),c=this.paper().size(d),h=c.group().attr("transform",this.translate(d.total.left,d.total.top)).selectAll(".group"),f=s.x,p=s.y,g=s.groupby,m=this.getScale("band"),y=this.getScale(s.scale),w=this.getScale("ordinal"),x=!1,b=null,S=null,k=i,C=r,P=1;if("vertical"===s.orientation?(m.rangeRound([0,d.innerWidth]).paddingInner(s.padding),y.rangeRound([d.innerHeight,0]),b=m.bandwidth,S=e):(m.rangeRound([0,d.innerHeight]).paddingInner(s.padding),y.rangeRound([0,d.innerWidth]),P=0,b=e,S=m.bandwidth,k=r,C=i),g&&(a=t.dimension(g).group().top(1/0).map(function(t){return t.key}),a.length<=1&&(a=null)),a&&(t=t.pivot(f,g,p),"y"===s.sortby&&(t=t.sortby("total")),u=t.data,w.domain(a).range(this.colors(a.length)),s.stack&&(s.normalize&&this.normalize(t.data),x=!0)),m.domain(u.map(function(t){return t[f]})),!x){return self.getScale("band").padding(.5*s.padding)}y.domain([0,n.max(u,function(t){return t.total})]).nice(),u=v.stack().keys(a)(u);var A=h.data(u).enter().append("g").classed("group",!0).attr("fill",function(t){return w(t.key)}).merge(h).attr("fill",function(t){return w(t.key)}).attr("stroke",l.stroke).attr("stroke-opacity",l.strokeOpacity).attr("fill-opacity",l.fillOpacity).selectAll("rect").data(function(t){return t});A.enter().append("rect").merge(A).transition().attr("x",k).attr("y",C).attr("height",S).attr("width",b),"vertical"===s.orientation?(o=this.axis("bottom",m).tickSizeOuter(0),c.group("axis").attr("transform",this.translate(d.total.left,d.total.top+d.innerHeight)).call(o)):(o=this.axis("left",m).tickSizeOuter(0),c.group("axis").attr("transform",this.translate(d.total.left,d.total.top)).call(o)),s.legendType&&a&&this.legend({scale:w},d)}}),ke=Lt("boxchart",xe,{options:{orientation:"vertical",lineWidth:1,x:"x",y:"y",scaleX:"linear",scaleY:"linear",gradient:!0},doDraw:function(t){var e=this,i=this.getModel(),r=e.getDataInfo(t),a=this.boundingBox(),o=et(),s=this.paper().size(a),l=ft(i.x),u=s.group().attr("transform",this.translate(a.total.left,a.total.top)).selectAll(".box").data(r.data),d=t.groupby(i.x),c=this.getScale(i.scaleX).domain(n.extent(t.data,l)),h=a.innerWidth;"vertical"===i.orientation?c.range([0,a.innerWidth]):(c.range([0,a.innerHeight]),h=this.innerHeight),o.width(this.dim(i.width,h,h/d.length-2)),u.enter().append("g").classed("box",!0).call(o)}}),Ce=Lt("areachart",xe,{options:{lineWidth:1,curve:"cardinalOpen",x:"x",y:"y",scaleX:"linear",scaleY:"linear",gradient:!0},doDraw:function(t){var e=this,n=this.getModel(),i=this.getModel("color"),r=e.getDataInfo(t),a=this.boundingBox(),o=this.paper().size(a),s=o.group().attr("transform",this.translate(a.total.left,a.total.top)).selectAll(".area").data(r.data),l=o.group("lines").attr("transform",this.translate(a.total.left,a.total.top)).selectAll(".line").data(r.data),u=this.fill(r.meta),d=this.curve(n.curve);r.range.y[0]=0;var c=v.line().x(this.x(a,r.range.x)).y(this.y(a,r.range.y)).curve(d),h=v.area().x(this.x(a,r.range.x)).y1(this.y(a,r.range.y)).y0(this.y(a,r.range.y,me(0))).curve(d);l.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",i.stroke).attr("stroke-opacity",0).attr("stroke-width",n.lineWidth).attr("d",c).merge(l).transition().attr("d",c).attr("stroke",i.stroke).attr("stroke-opacity",i.strokeOpacity).attr("stroke-width",n.lineWidth),l.exit().remove(),s.enter().append("path").attr("class","area").attr("fill",u).attr("stroke","none").attr("stroke-width",0).attr("d",h).merge(s).transition().attr("d",h).attr("fill",u).attr("fill-opacity",i.fillOpacity),s.exit().remove()}}),Pe=Math.PI,Ae=Pe/180,Me={fill:function(t){function e(t,e){return n[e]}var n=this.colors(t.length);return e.colors=n,e},proportionalData:function(t,e){return t.dimension(e).top(1/0)},total:function(t){function e(e){return n+=e[t],e[t]}var n=0;return e.total=function(){return n},e}},ze=Lt("piechart",Me,{options:{field:"data",label:"label",startAngle:0,endAngle:360,sort:!1,innerRadius:0,padAngle:0,cornerRadius:0,lineWidth:1,fractionFormat:".1%",legendType:"color",legendLabel:"label + ' - ' + format(fraction)"},doDraw:function(t){var e=this.getModel(),n=this.getModel("color"),i=e.field,r=this.boundingBox(),a=Math.min(r.innerWidth,r.innerHeight)/2,s=C(e.innerRadius,a),l=this.total(i),u=v.pie().padAngle(Ae*e.padAngle).startAngle(Ae*e.startAngle).endAngle(Ae*e.endAngle).value(l),d=v.arc().innerRadius(s).outerRadius(a).cornerRadius(e.cornerRadius),h=this.paper(),f=u(this.proportionalData(t,i)),g=this.fill(f),m=h.size(r).group().attr("transform",this.translate(r.total.left+r.innerWidth/2,r.total.top+r.innerHeight/2)).selectAll(".slice").data(f);if(m.enter().append("path").attr("class","slice").attr("stroke",n.stroke).attr("stroke-opacity",0).attr("fill-opacity",0).attr("fill",g).attr("stroke-width",e.lineWidth).merge(m).transition().attr("stroke",n.stroke).attr("stroke-opacity",n.strokeOpacity).attr("d",d).attr("fill",g).attr("fill-opacity",n.fillOpacity),m.exit().remove(),e.legendType){l=l.total();var y=o.viewExpression(e.legendLabel),w=c.format(e.fractionFormat),x=f.map(function(t,n){return y.eval({d:t,value:t.value,format:w,total:l,fraction:t.value/l,label:t.data[e.label]||n})});this.legend({scale:p.scaleOrdinal().domain(x).range(g.colors)},r)}}}),Oe=function(t){return{draw:function(e){t.forEach(function(t,n){n?e.lineTo(t[0],t[1]):e.moveTo(t[0],t[1])}),e.closePath()}}},De=Lt("pyramidchart",Me,{options:{field:"data",label:"label",pad:0,lineWidth:1,inverted:!1,legendType:"color",invereted:!1,legendLabel:"label + ' - ' + format('.1%', fraction)"},doDraw:function(t){var e=this.getModel(),n=e.field,i=this.getModel("color"),r=this.boundingBox(),a=this.dim(e.pad,Math.min(r.innerWidth,r.innerHeight)),s=we().base(r.innerWidth).height(r.innerHeight).pad(a).value(function(t){return t[n]}),l=t.new(s(this.proportionalData(t,n))).dimension("fraction").bottom(1/0),u=v.symbol().type(function(t){return Oe(t.points)}).size(1),d=this.fill(l),c=this.paper(),h=c.size(r).group().attr("transform",this.translate(r.total.left+r.innerWidth/2,r.total.top)).selectAll(".segment").data(l);if(h.enter().append("path").attr("class","segment").attr("stroke",i.stroke).attr("stroke-opacity",0).attr("fill-opacity",0).attr("fill",d).attr("stroke-width",e.lineWidth).attr("d",u).merge(h).transition().attr("stroke",i.stroke).attr("stroke-opacity",i.strokeOpacity).attr("d",u).attr("fill",d).attr("fill-opacity",i.fillOpacity),h.exit().remove(),e.legendType){var f=o.viewExpression(e.legendLabel),p=this,g=l.map(function(t,n){return f.eval(p.getContext({d:t,value:t.value,fraction:t.fraction,label:t.data[e.label]||n}))});this.legend({scale:this.getScale("ordinal").domain(g).range(d.colors)},r)}}}),qe=Lt("treemap",{requires:["d3-treemap"]}),Ee=Lt("text",{options:{scale:"linear",field:"data",label:"label"},doDraw:function(){}});t.visualizeVersion="0.1.1",t.randomPath=at,t.DataStore=k,t.dataSources=qt,t.dataLocale=Et,t.visuals=jt,t.createChart=Lt,t.createPaper=W,t.Svg=Xt,t.visualTransforms=zt,t.visualComponents=ge,t.colorScales=Zt,t.pyramid=we,t.Visual=$t,t.BarChart=Se,t.BoxChart=ke,t.LineChart=be,t.AreaChart=Ce,t.PieChart=ze,t.PyramidChart=De,t.Treemap=qe,t.TextChart=Ee,Object.defineProperty(t,"__esModule",{value:!0})});