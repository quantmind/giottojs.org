// https://github.com/quantmind/d3-canvas-transition Version 0.2.2. Copyright 2016 undefined.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-transition"),require("d3-collection"),require("d3-timer"),require("d3-color"),require("d3-selection")):"function"==typeof define&&define.amd?define("d3-canvas-transition",["exports","d3-transition","d3-collection","d3-timer","d3-color","d3-selection"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o){"use strict";function a(t){var e=u(t.attrs.get("stroke"));if(e){var n=t.getValue("stroke-opacity");return(n||0===n)&&(e.opacity=n),t.context.strokeStyle=""+e,t.context.lineWidth=t.factor*(t.getValue("stroke-width")||1),t.context.stroke(),e}}function s(t){var e=u(t.attrs.get("fill"));if(e){var n=t.getValue("fill-opacity");return(n||0===n)&&(e.opacity=n),t.context.fillStyle=""+e,t.context.fill(),e}}function u(t){if(t&&"none"!==t)return i.color(t)}function c(t,e,n,r){return{pen:t,time:e,data:n,index:r||0}}function l(){return new h}function h(){this._head=null,this._tail=null,this._length=0,Object.defineProperty(this,"length",{get:function(){return this._length}})}function f(t,e,n){for(var r,i,o,a=t.split(" "),s=0;s<a.length;++s){var u,c;for(o=e._head,t=a[s],t.indexOf("#")>-1?(r=t.split("#"),i=r[0],c=r[1]):t.indexOf(".")>-1?(r=t.split("."),i=r[0],u=r.splice(1).join(" ")):i=t;o;){if(!i||o.tagName===i)if(c&&o.id!==c||u&&o.class!==u);else{if(!n)return o;n.push(o)}o=o._next}}return n}function d(t,e){if(e){var n,r,i,o=e.indexOf("translate(");return o>-1&&(r=e.substring(o+10),n=r.indexOf(")"),i=r.substring(0,n).split(","),t.context.translate(t.factor*i[0],t.factor*i[1])),!0}}function p(t,e){t._touches||(t._touches=0),t._touches+=e,t._touches&&!t._inloop&&(t._inloop=r.timeout(y(t)))}function y(t){return function(){var e=t.context;t._touches=0,e.beginPath(),e.closePath(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),t.draw(),t._inloop=!1,p(t,0)}}function v(t,n){var r=this.node();return r instanceof L&&c.test(t,n)?e.transition.prototype.attrTween.call(this,t,_(n)):U.call(this,t,n)}function _(t){return function(e,n){return function(r){return c(t,r,e,n)}}}function g(t,e){var n=o.selection();return arguments.length&&(e||(e=W()),n._groups[0][0]=new L(t,e)),n}function x(t,e){if(arguments.length>1){var n=this._parents[0]||this.node();n instanceof L&&c.test(t,e)&&(arguments[1]=c(e,1))}return G.apply(this,arguments)}function m(t){return t}function k(t,e,n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"}function b(t,e,n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"}function w(t){var e=t.bandwidth()/2;return function(n){return t(n)+e}}function q(t,e){function n(n){var c=null==i?e.ticks?e.ticks.apply(e,r):e.domain():i,l=null==o?e.tickFormat?e.tickFormat.apply(e,r):m:o,h=Math.max(a,0)+u,f=t===J||t===Q?k:b,d=e.range(),p=d[0],y=d[d.length-1],v=(e.bandwidth?w:m)(e.copy()),_=n.selection?n.selection():n,g=_.selectAll(".domain").data([null]),x=_.selectAll(".tick").data(c,e).order(),q=x.exit(),O=x.enter().append("g",".domain").attr("class","tick"),A=x.select("line"),P=x.select("text");switch(g=g.merge(g.enter().append("line").attr("class","domain")),x=x.merge(O),A=A.merge(O.append("line")),P=P.merge(O.append("text")),n!==_&&(g=g.transition(n),x=x.transition(n),q=q.transition(n).style("opacity",Y).attr("transform",function(t){return f(v,this.parentNode.__axis||v,t)}),O.style("opacity",Y).attr("transform",function(t){return f(this.parentNode.__axis||v,v,t)}),A=A.transition(n),P=P.transition(n)),x.style("opacity",1).attr("transform",function(t){return f(v,v,t)}),q.remove(),P.text(l),t){case J:g.attr("x1",p).attr("y1",-s).attr("x2",y).attr("y2",-s),A.attr("x2",0).attr("y2",-a),P.attr("x",0).attr("y",-h).attr("dy","0em").style("text-anchor","middle");break;case K:g.attr("x1",s).attr("y1",p).attr("x2",s).attr("y2",y),A.attr("y2",0).attr("x2",a),P.attr("y",0).attr("x",h).attr("dy",".32em").style("text-anchor","start");break;case Q:g.attr("x1",p).attr("y1",s).attr("x2",y).attr("y2",s),A.attr("x2",0).attr("y2",a),P.attr("x",0).attr("y",h).attr("dy",".71em").style("text-anchor","middle");break;case X:g.attr("x1",-s).attr("y1",p).attr("x2",-s).attr("y2",y),A.attr("y2",0).attr("x2",-a),P.attr("y",0).attr("x",-h).attr("dy",".32em").style("text-anchor","end")}_.each(function(){this.__axis=v})}var r=[],i=null,o=null,a=6,s=6,u=3;return n.scale=function(t){return arguments.length?(e=t,n):e},n.ticks=function(){return r=H.call(arguments),n},n.tickArguments=function(t){return arguments.length?(r=null==t?[]:H.call(t),n):r.slice()},n.tickValues=function(t){return arguments.length?(i=null==t?null:H.call(t),n):i&&i.slice()},n.tickFormat=function(t){return arguments.length?(o=t,n):o},n.tickSize=function(t){return arguments.length?(a=s=+t,n):a},n.tickSizeInner=function(t){return arguments.length?(a=+t,n):a},n.tickSizeOuter=function(t){return arguments.length?(s=+t,n):s},n.tickPadding=function(t){return arguments.length?(u=+t,n):u},n}function O(t){return q(J,t)}function A(t){return q(K,t)}function P(t){return q(Q,t)}function j(t){return q(X,t)}function S(t){for(var e=[],n=0,r=void 0,i=void 0,o=0;o<et.length;++o)r=et[o],i=t.getValue("font-"+r),i&&("size"===r&&(n=t.factor*i,i=n+"px"),e.push(i));return n&&(t.context.font=e.join(" ")),n}function V(t,e,n){var r=t.attrs.get(e)||0,i=t.attrs.get("d"+e)||0;return i&&("em"==i.substring(i.length-2)?i=n*i.substring(0,i.length-2):"px"==i.substring(i.length-2)&&(i=+i.substring(0,i.length-2))),t.factor*(r+i)}var C=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},N=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),T=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},E=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},F=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},z=function(){function t(e){C(this,t),this.factor=e||1,this.time=1/0,this.data1=[]}return N(t,[{key:"update",value:function(t){this.pen=t.pen,this.time=t.time,this.current=t.data}},{key:"draw",value:function(t){t.context.beginPath(),this.pen.context(t.context)()}},{key:"accessor",value:function(t,e){var n,r,i=this.factor,o=this.data0,a=this.data1,s=this.time;return function(u,c){return n=o[c][e],r=void 0===n?i*t(u):i*(s*t(u)+(1-s)*n),a[c][e]=r,r}}}]),t}(),R=function(t){function e(){return C(this,e),F(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return E(e,t),N(e,[{key:"update",value:function(t){if(t.time<this.time){for(var n=this.data1;n.length<t.data.length;)n.push(new Array(2));this.data0=this.data1,this.x=t.pen.x(),this.y=t.pen.y()}T(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t)}},{key:"draw",value:function(t){t.context.beginPath(),this.pen.context(t.context).x(this.accessor(this.x,0)).y(this.accessor(this.y,1))(this.current)}}]),e}(z),B={symbol:z,line:R,arc:R,area:R},D=function(t,e,n){var r=t.attrs.get(e);if(r===n)return!1;if("d"===e&&n&&n.pen){if(!r){var i=B[n.pen.name];r=new i(t.factor),t.attrs.set(e,r)}return r.update(n),!0}return t.attrs.set(e,n),!0};c.test=function(t,e){return"d"===t&&e&&"function"==typeof e.context},h.prototype=l.prototype={prepend:function(t,e){this._length?e?(t._prev=e._prev,t._next=e,e._prev&&(e._prev.next=t),e._prev=t):(t._prev=this._tail,t._next=null,this._tail._next=t):(t._prev=null,t._next=null),t._prev||(this._head=t),t._next||(this._tail=t),this._length++},remove:function(t){t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),this._head===t&&(this._head=t._next),this._tail===t&&(this._tail=t._prev),delete t._prev,delete t._next,this._length--},list:function t(){for(var e=this._head,t=[];e;)t.push(e),e=e._next;return t},each:function(t){for(var e=this._head;e;)t(e),e=e._next}};var I="canvas",M=n.map(),L=function(){function t(e,n,r){C(this,t),this.context=e,this.factor=n||1,this.tagName=r||"canvas"}return N(t,[{key:"querySelectorAll",value:function(t){return this._deque?"*"===t?this.childNodes:f(t,this._deque,[]):[]}},{key:"querySelector",value:function(t){if(this._deque)return"*"===t?this._deque._head:f(t,this._deque)}},{key:"createElementNS",value:function(e,n){return new t(this.context,this.factor,n)}},{key:"hasChildNodes",value:function(){return!!this._deque&&this._deque.length>0}},{key:"contains",value:function(t){for(;t;){if(t._parent==this)return!0;t=t._parent}return!1}},{key:"appendChild",value:function(t){return this.insertBefore(t)}},{key:"insertBefore",value:function(e,n){if(e===this)throw Error("inserting self into children");if(!(e instanceof t))throw Error("Cannot insert a non canvas element into a canvas element");return e._parent&&e._parent.removeChild(e),this._deque||(this._deque=l()),this._deque.prepend(e,n),e._parent=this,p(this.root,1),e}},{key:"removeChild",value:function(t){if(t._parent===this)return delete t._parent,this._deque.remove(t),p(this.root,1),t}},{key:"setAttribute",value:function(t,e){"class"===t?this.class=e:"id"===t?this.id=e:(this.attrs||(this.attrs=n.map()),D(this,t,e)&&p(this.root,1))}},{key:"removeAttribute",value:function(t){this.attrs&&(this.attrs.remove(t),p(this.root,1))}},{key:"getAttribute",value:function(t){if(this.attrs)return this.attrs.get(t)}},{key:"draw",value:function(t){var e=this.context,n=M.get(this.tagName);this.attrs&&(e.save(),d(this,this.attrs.get("transform")),e.save(),n&&n(this,t),s(this),a(this),e.restore()),this._deque&&this._deque.each(function(e){e.draw(t)}),this.attrs&&e.restore()}},{key:"each",value:function(t){this._deque&&this._deque.each(t)}},{key:"getValue",value:function(t){var e=this.getAttribute(t);return void 0===e&&this._parent?this._parent.getValue(t):e}},{key:"removeProperty",value:function(t){this.removeAttribute(t)}},{key:"setProperty",value:function(t,e){this.setAttribute(t,e)}},{key:"getProperty",value:function(t){return this.getAttribute(t)}},{key:"getPropertyValue",value:function(t){return this.getAttribute(t)}},{key:"getComputedStyle",value:function(){return this}},{key:"onStart",value:function(){}},{key:"childNodes",get:function(){return this._deque?this._deque.list():[]}},{key:"firstChild",get:function(){return this._deque?this._deque._head:null}},{key:"lastChild",get:function(){return this._deque?this._deque._tail:null}},{key:"parentNode",get:function(){return this._parent}},{key:"previousSibling",get:function(){return this._prev}},{key:"nextSibling",get:function(){return this._next}},{key:"namespaceURI",get:function(){return I}},{key:"countNodes",get:function(){return this._deque?this._deque._length:0}},{key:"root",get:function(){return this._parent?this._parent.root:this}},{key:"ownerDocument",get:function(){return this}},{key:"style",get:function(){return this}},{key:"defaultView",get:function(){return this}},{key:"document",get:function(){return this}}]),t}(),U=e.transition.prototype.attr;e.transition.prototype.attr=v;var W=function(t){return t||window.devicePixelRatio||1};g.prototype=o.selection.prototype;var G=g.prototype.attr;g.prototype.attr=x;var H=Array.prototype.slice,J=1,K=2,Q=3,X=4,Y=1e-6,Z="0.2.2",$=function(t){var e=t.attrs;t.context.moveTo(t.factor*(e.get("x1")||0),t.factor*(e.get("y1")||0)),t.context.lineTo(t.factor*e.get("x2"),t.factor*e.get("y2"))},tt=function(t){var e=t.attrs.get("d");e&&("function"==typeof e.draw?e.draw(t):e.context&&e.context(t.context)())},et=["style","variant","weight","size","family"],nt="middle",rt={start:"start",middle:"center",end:"end"},it=function(t){var e=S(t);t.context.textAlign=rt[t.getValue("text-anchor")]||rt.middle,t.context.textBaseline=t.getValue("text-baseline")||nt,t.context.fillText(t.textContent||"",V(t,"x",e),V(t,"y",e))};M.set("line",$),M.set("line",tt),M.set("text",it),t.tweenAttr=v,t.selection=g,t.resolution=W,t.CanvasElement=L,t.axisTop=O,t.axisRight=A,t.axisBottom=P,t.axisLeft=j,t.canvasVersion=Z,t.creator=o.creator,t.matcher=o.matcher,t.mouse=o.mouse,t.namespace=o.namespace,t.namespaces=o.namespaces,t.select=o.select,t.selectAll=o.selectAll,t.selector=o.selector,t.selectorAll=o.selectorAll,t.touch=o.touch,t.touches=o.touches,t.window=o.window,t.event=o.event,Object.defineProperty(t,"__esModule",{value:!0})});