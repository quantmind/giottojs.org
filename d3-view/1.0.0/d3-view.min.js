!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-collection"),require("d3-let"),require("d3-timer"),require("d3-selection"),require("d3-dispatch")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-let","d3-timer","d3-selection","d3-dispatch"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o){"use strict";function s(t){st.logger.info(it+" "+t)}function a(){return Promise.reject(new Error("Cannot requires libraries, d3-require is not available"))}function u(t){function e(t){ft(this).el=t}return e.prototype=n.assign({},ht,t),e}function c(t,e,n){return dt(function(){e.$set(n,t.value())})}function l(t){var e=st.handlebars;if(e||(e=n.inBrowser?window.handlebars:require("handlebars")),e)return e.compile(t);at("compile function requires handlebars")}function d(t,e){if(n.isString(t)){if(!e)return t;var r=l(t);if(!r)return t;t=r}return t(e)}function f(t,e){var n=i.select(document.createElement("div"));n.html(d(t,e));var r=n.node().children;return 1!==r.length&&at("HtmlElement function should return one root element only, got "+r.length),r[0]}function h(t){this.response=t,this.description=t.statusText}function p(t){if(t.status>=300)throw new h(t);var e=(t.headers.get("content-type")||"").split(";")[0];if("application/json"===e)return t.json();throw new Error("Expected JSON content type, got "+e)}function v(t,e,n){return n?f(t,e):d(t,e)}function m(t,e,n){switch(e.type){case _t.IDENTIFIER:return t[e.name];case _t.LITERAL:return n?t[e.value]:e.value;case _t.ARRAY_EXP:return e.elements.map(function(e){return m(t,e)});case _t.LOGICAL_EXP:case _t.BINARY_EXP:return E(e.operator,m(t,e.left),m(t,e.right));case _t.CALL_EXP:return y(t,e.callee,e.arguments);case _t.MEMBER_EXP:return m(m(t,e.object),e.property,!0);case _t.CONDITIONAL_EXP:return m(t,e.test)?m(t,e.consequent):m(t,e.alternate);case _t.UNARY_EXP:return b(e.operator,m(t,e.argument))}}function g(t,n){switch(1===arguments.length&&(n=e.set()),t.type){case _t.IDENTIFIER:n.add(t.name);break;case _t.ARRAY_EXP:t.elements.forEach(function(t){return g(t,n)});break;case _t.LOGICAL_EXP:case _t.BINARY_EXP:g(t.left,n),g(t.right,n);break;case _t.CALL_EXP:g(t.callee,n),t.arguments.forEach(function(t){return g(t,n)});break;case _t.MEMBER_EXP:n.add(w(t));break;case _t.CONDITIONAL_EXP:g(t.test,n),g(t.consequent,n),m(t.alternate,n);break;case _t.UNARY_EXP:g(t.argument,n)}return n}function y(t,e,n){var r;if(n=n.map(function(e){return m(t,e)}),e.type!==_t.IDENTIFIER&&(t=m(t,e.object),e=e.property),!(r=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return r.apply(t,n)}function b(t,e){return Rt[t]||(Rt[t]=new Function("arg","return "+t+" arg")),Rt[t](e)}function E(t,e,n){return Tt[t]||(Tt[t]=new Function("a","b","return a "+t+" b")),Tt[t](e,n)}function w(t){return t.type===_t.IDENTIFIER?t.name:w(t.object)+"."+t.property.name}function _(t){this.codes=_t,this.expr=t,this.parsed=kt(t)}function x(t,n,r,i){var o=e.map(),s=null;o.set("",Bt()),Object.defineProperties(Ft(t),{$events:{get:function(){return o}},parent:{get:function(){return r}},isolated:{get:function(){return i}}}),t.$child=function(e){return null===s&&(s=$(t)),new s(e)},t.$update(n)}function $(t){function e(e){x(this,e,t,!1)}return e.prototype=t,e}function O(t){return n.isObject(t)&&"[object d3Model]"===t.toString()}function A(t,e,r){function i(n){if(u&&(n=u.get.call(t)),n!==r){var i=t.$$name||"model";ot("updating "+i+"."+e),t.$change(e,r).$change(),r=o(n,r)}}function o(e,r){return e===r?r:n.isArray(e)?s(e,r):O(r)?a(e,r):Ut(e)?t.$new(e):e}function s(t,e){O(e)&&e.$off(),n.isArray(e)||(e=[]);for(var r=0;r<t.length;++r)t[r]=o(t[r],e[r]);return t}function a(t,e){return Ut(t)?(e.$update(t),e):(e.$off(),o(t))}var u;t.$events.set(e,Bt()),Object.defineProperty(t,e,function(){var o={get:function(){return r}};return n.isFunction(r)&&(r={get:r}),Ut(r)&&n.isFunction(r.get)?(r=(u=r).get.call(t),u.reactOn?u.reactOn.forEach(function(n){t.$on(n+"."+e,i)}):at("reactive lazy property "+e+" does not specify 'reactOn' list or properties"),n.isFunction(u.set)&&(o.set=u.set)):o.set=i,o}()),r=o(r),t.$change(e)}function C(t,e){var n=t.$events.get(e);return!n&&t.parent?C(t.parent,e):n}function P(t,e){e?t.on("change."+e,null):t.on("change",null)}function D(t,e){x(this,t,e,!0)}function L(t){return new D(t)}function I(t,e,r){var i=3===arguments.length?e[r]:void 0;n.isFunction(i)||2===arguments.length?N(t,e).events.add(""):i instanceof L?(I(t,i),(e=e.$owner(r))&&N(t,e).events.add("")):((e=e.$owner(r)||e).$isReactive(r)||e.$set(r,i),N(t,e).events.add(r))}function N(t,n){var r=t.get(n.uid);return r||(r={model:n,events:e.set()},t.set(n.uid,r)),r}function j(t,r,i){function s(r){var s=n.pop(r,"parent"),a=e.map(s?s.components:null),u=e.map(s?s.directives:i),h=o.dispatch("message","mounted"),p={};c.each(function(t,e){a.set(e,t)}),l.each(function(t,e){u.set(e,t)}),M(a,n.pop(r,"components")),k(u,n.pop(r,"directives")),Object.defineProperties(this,{name:{get:function(){return t}},components:{get:function(){return a}},directives:{get:function(){return u}},parent:{get:function(){return s}},root:{get:function(){return s?s.root:this}},cache:{get:function(){return s?s.cache:p}},props:{get:function(){return f}},uid:{get:function(){return this.model.uid}},events:{get:function(){return h}}}),this.model=n.assign({},n.isFunction(d)?d():d,n.pop(r,"model")),Jt.call("component-created",void 0,this)}function a(t){return new s(t)}n.isFunction(r)&&(r={render:r});var u=n.assign({},r),c=M(e.map(),n.pop(u,"components")),l=k(e.map(),n.pop(u,"directives")),d=n.pop(u,"model"),f=n.pop(u,"props");return s.prototype=n.assign({},wt,Wt,u),a.prototype=s.prototype,a}function M(t,n){return e.map(n).each(function(e,n){t.set(n,j(n,e,Wt))}),t}function k(t,n){return e.map(n).each(function(e,n){t.set(n,Gt(e))}),t}function R(t,e,n){return Object.defineProperty(ft(t),"el",{get:function(){return e}}),t.select(e).view(t).mount(null,n).then(function(){return S(t,n)})}function T(t,e){return void 0===t.isMounted?(t.isMounted=!1,!1):(t.isMounted?at("view "+t.name+" already mounted"):(t.isMounted=!0,t.mounted(),e&&e(t),t.events.call("mounted",void 0,t,e),t.events.on("mounted",null),Jt.call("component-mounted",void 0,t)),!0)}function S(t,e){var n=t.parent;t.childrenMounted(),n&&!n.isMounted?n.events.on("mounted."+t.uid,function(){T(t,e)}):T(t,e)}function q(t,e,n,r){return n?(1!==(n=bt(n)).size()&&at("render function must return a single HTML node"),n=n.node(),e.parentNode.insertBefore(n,e),t.select(e).remove(),R(t,n,r)):at("render function must return a single HTML node. It returned nothing!")}function X(t){for(var e={},n=void 0,r=0;r<t.attributes.length;++r)e[(n=t.attributes[r]).name]=n.value;return e}function F(t){return{reactOn:[t],get:function(){return this[t]}}}function B(){this.attrs={},this.all=[]}function U(t,e,n,r){if(t&&t.tagName){var i=e.components.get(t.tagName.toLowerCase()),o=Qt(t,e.directives),s=o.preMount();if(s)return s.execute(e.model);var a=void 0;return a=i?[i({parent:e}).mount(t,n,r)]:Yt(t.children).map(function(t){return U(t,e,n,r)}),Promise.all(a).then(function(){return o.execute(e.model)})}}function Y(t){if(!t)return at("element not defined, pass an identifier or an HTMLElement object");var e=(n.isFunction(t.node)?t:i.select(t)).node();if(e)return e;at("could not find "+t+" element")}function z(){var t=this.__d3_directives__,e=this.__d3_view__;t&&(t.all.forEach(function(t){return t.destroy()}),delete this.__d3_directives__),e&&(e.destroy(),delete this.__d3_view__)}function G(){document.removeEventListener("DOMContentLoaded",G),window.removeEventListener("load",G),H()}function H(){for(var t=void 0;st.readyCallbacks.length;)t=st.readyCallbacks.shift(),r.timeout(t)}function V(t,e,r){var i,o,s;if(n.isObject(r))for(o in r)i=r[o],n.isObject(i)&&("d3-"===o.substring(0,3)?(s=o.replace("-","_"),e.$set(s,i),i=s):i=JSON.stringify(i)),t.attr(o,i||"")}function J(t){var e=t.type||"text";return ae[e]||e}function W(t){var e=this.model.data.children;if(e){if(!n.isArray(e))return re("children should be an array of fields, for "+(void 0===e?"undefined":babelHelpers.typeof(e))),t;t.selectAll(".d3form").data(e).enter().append(K).classed("d3form",!0)}return t}function K(t){var e=J(t);return e||(re("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3-form-"+e)}function Q(t){var e=t.attr("min"),n=t.attr("max");return e=null===e?-1/0:+e,n=null===n?1/0:+n,[e,n]}function Z(t,e){return{set:function(e,n){n[t]},validate:function(t,n){return e(t,n)}}}function tt(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[srOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}function et(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+e+"</span>\n<slot></slot>\n</div>"}function nt(t){return'<div class="form-check">\n<label class="form-check-label">\n<slot></slot>\n'+t+"\n</label>\n</div>"}function rt(t,e,n){var r=Ee[n.attr("type")]||Ee[n.node().tagName.toLowerCase()];if(!r)return e;var i=void 0;return r.forEach(function(r){(i=Ee.wrappers[r])?e=i(t,e,n):re("Could not find form field wrapper "+r)}),e}var it="[d3-view-debug]",ot=function(t){st.logger.debug&&st.logger.debug(t)};n.logger.debug=null;var st={logger:n.logger,fetch:function(){if(n.inBrowser)return window.fetch}(),readyCallbacks:[],setDebug:function(t){!arguments.length||t?this.logger.debug=n.isFunction(t)?t:s:this.logger.debug=null},require:function(){var t=null;return n.inBrowser&&window.d3&&(t=window.d3.require),t||a}()},at=function(t){st.logger.warn("[d3-view] "+t)},ut=e.map({disabled:"disabled",readonly:"readOnly",required:"required"}),ct={create:function(t){return this.arg?t:at("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,e){if("class"===this.arg)return this.refreshClass(e);if(n.isArray(e))return at("Cannot apply array to attribute "+this.arg);var r=ut.get(this.arg);r?this.sel.property(r,e||!1):this.sel.attr(this.arg,e||null)},refreshClass:function(t){var e=this.sel;n.isArray(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&e.classed(t,!1)}),this.oldValue=t.map(function(t){var r=!0;return n.isArray(t)&&(r=t[1],t=t[0]),t&&e.classed(t,r),t})}},lt={refresh:function(t,e){if(n.isNumber(e)&&(e=""+e),n.isString(e)){var r=this,i=this.sel,o=this.passes?this.transition(i):null;o?o.style("opacity",0).on("end",function(){i.html(e),r.selectChildren().mount(),r.transition(i).style("opacity",1)}):(i.html(e),this.selectChildren().mount())}}},dt=function(t,e){function n(){if(null!==i)return i;var n=this,o=arguments;return i=new Promise(function(s,a){r.timeout(function(){i=null;try{s(t?t.apply(n,o):void 0)}catch(t){a(t)}},e)})}var i=null;return n.promise=function(){return i},n},ft=function(t){return Object.defineProperty(t,"sel",{get:function(){return i.select(this.el)}}),t},ht={on:function(t,e){var n=c(this,t,e);this.sel.on("input",n).on("change",n)},off:function(){this.sel.on("input",null).on("change",null)},value:function(t){if(!arguments.length)return this.sel.property("value");this.sel.property("value",t)}},pt=u(),vt=u({value:function(t){if(!arguments.length)return this.sel.property("checked");this.sel.property("checked",t)}}),mt={input:pt,textarea:pt,select:u({value:function(t){var e,r=this.sel,o=r.selectAll("option"),s=t;if(!arguments.length)return s=[],o.each(function(){(e=i.select(this)).property("selected")&&s.push(e.attr("value")||"")}),r.property("multiple")?s:s[0]||"";n.isArray(s)||(s=[t||""]),o.each(function(){e=i.select(this),t=e.attr("value")||"",e.property("selected",s.indexOf(t)>-1)})}}),checkbox:vt},gt={create:function(t){var e=this.sel.attr("type"),n=this.el.tagName.toLowerCase(),r=mt[e]||mt[n];return r?(this.tag=new r(this.el),t):at("Cannot apply d3-value directive to "+n)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return at('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var n=this.expression.expr;return t.$set(n,this.tag.value()),this.tag.on(t,n),t},refresh:function(t,e){this.tag.value(e)},destroy:function(){this.tag.off()}},yt={mount:function(t){var e=this.arg||"click",n=this.expression;this.on(this.sel,e+"."+this.uid,function(e){var r=t.$child();r.$event=e,n.eval(r)}),this.bindDestroy(t)},destroy:function(){var t=this.arg||"click";this.on(this.sel,t+"."+this.uid,null)}};h.prototype=Error.prototype;var bt=function(t){return t&&!n.isFunction(t.size)?i.select(t):t},Et={isd3:!0,providers:st,viewElement:f,select:function(t){return i.select(t)},selectAll:function(t){return i.selectAll(t)},createElement:function(t){return i.select(document.createElement(t))},fetch:function(t,e){var n=st.fetch;return 1==arguments.length?n(t):n(t,e)},fetchText:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(function(t){return t.text()})},json:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(p)},renderFromUrl:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.cache;return t in r?Promise.resolve(v(r[t],e,n)):this.fetchText(t).then(function(i){return r[t]=i,v(i,e,n)})},on:function(t,e,n){if(t=bt(t),null===n)return t.on(e,null);t.on(e,function(){return n(i.event)})},selectChildren:function(t){return arguments.length||(t=this.el),this.selectAll(Array.prototype.slice.call(t.children))},domEvent:function(){return i.event}};st.transition={duration:0};var wt=n.assign(Et,{transition:function(t){arguments.length||(t=this.sel);var e=this.transitionDuration(t);if(e>0)return t.transition(this.uid).duration(e)},transitionDuration:function(t){if(arguments.length||(t=this.sel),t&&n.isFunction(t.transition)&&t.size()){var e=t.attr("data-transition-duration");return+(null===e?st.transition.duration:e)}return 0}}),_t={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},xt=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},$t={"-":!0,"!":!0,"~":!0,"+":!0},Ot={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},At=function(t){var e,n=0;for(var r in t)(e=r.length)>n&&t.hasOwnProperty(r)&&(n=e);return n},Ct=At($t),Pt=At(Ot),Dt={true:!0,false:!1,null:null},Lt=function(t){return Ot[t]||0},It=function(t,e,n){return{type:"||"===t||"&&"===t?_t.LOGICAL_EXP:_t.BINARY_EXP,operator:t,left:e,right:n}},Nt=function(t){return t>=48&&t<=57},jt=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ot[String.fromCharCode(t)]},Mt=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!Ot[String.fromCharCode(t)]},kt=function(t){for(var e,n,r=0,i=t.charAt,o=t.charCodeAt,s=function(e){return i.call(t,e)},a=function(e){return o.call(t,e)},u=t.length,c=function(){for(var t=a(r);32===t||9===t;)t=a(++r)},l=function t(){var e,n,i=f();return c(),63!==a(r)?i:(r++,(e=t())||xt("Expected expression",r),c(),58===a(r)?(r++,(n=t())||xt("Expected expression",r),{type:_t.CONDITIONAL_EXP,test:i,consequent:e,alternate:n}):void xt("Expected :",r))},d=function(){c();for(var e=t.substr(r,Pt),n=e.length;n>0;){if(Ot.hasOwnProperty(e))return r+=n,e;e=e.substr(0,--n)}return!1},f=function(){var t,e,n,i,o,s,a,u;if(s=h(),!(e=d()))return s;for(o={value:e,prec:Lt(e)},(a=h())||xt("Expected expression after "+e,r),i=[s,o,a];(e=d())&&0!==(n=Lt(e));){for(o={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)a=i.pop(),e=i.pop().value,s=i.pop(),t=It(e,s,a),i.push(t);(t=h())||xt("Expected expression after "+e,r),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=It(i[u-1].value,i[u-2],t),u-=2;return t},h=function e(){var n,i,o;if(c(),n=a(r),Nt(n)||46===n)return p();if(39===n||34===n)return v();if(jt(n)||40===n)return y();if(91===n)return E();for(o=(i=t.substr(r,Ct)).length;o>0;){if($t.hasOwnProperty(i))return r+=o,{type:_t.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},p=function(){for(var t,e,n="";Nt(a(r));)n+=s(r++);if(46===a(r))for(n+=s(r++);Nt(a(r));)n+=s(r++);if("e"===(t=s(r))||"E"===t){for(n+=s(r++),"+"!==(t=s(r))&&"-"!==t||(n+=s(r++));Nt(a(r));)n+=s(r++);Nt(a(r-1))||xt("Expected exponent ("+n+s(r)+")",r)}return e=a(r),jt(e)?xt("Variable names cannot start with a number ("+n+s(r)+")",r):46===e&&xt("Unexpected period",r),{type:_t.LITERAL,value:parseFloat(n),raw:n}},v=function(){for(var t,e="",n=s(r++),i=!1;r<u;){if((t=s(r++))===n){i=!0;break}if("\\"===t)switch(t=s(r++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||xt('Unclosed quote after "'+e+'"',r),{type:_t.LITERAL,value:e,raw:n+e+n}},m=function(){var e,n=a(r),i=r;for(jt(n)?r++:xt("Unexpected "+s(r),r);r<u&&(n=a(r),Mt(n));)r++;return e=t.slice(i,r),Dt.hasOwnProperty(e)?{type:_t.LITERAL,value:Dt[e],raw:e}:"this"===e?{type:_t.THIS_EXP}:{type:_t.IDENTIFIER,name:e}},g=function(t){for(var e,n,i=[],o=!1;r<u;){if(c(),(e=a(r))===t){o=!0,r++;break}44===e?r++:((n=l())&&n.type!==_t.COMPOUND||xt("Expected comma",r),i.push(n))}return o||xt("Expected "+String.fromCharCode(t),r),i},y=function(){var t,e;for(e=40===(t=a(r))?b():m(),c(),t=a(r);46===t||91===t||40===t;)r++,46===t?(c(),e={type:_t.MEMBER_EXP,computed:!1,object:e,property:m()}):91===t?(e={type:_t.MEMBER_EXP,computed:!0,object:e,property:l()},c(),93!==(t=a(r))&&xt("Unclosed [",r),r++):40===t&&(e={type:_t.CALL_EXP,arguments:g(41),callee:e}),c(),t=a(r);return e},b=function(){r++;var t=l();if(c(),41===a(r))return r++,t;xt("Unclosed (",r)},E=function(){return r++,{type:_t.ARRAY_EXP,elements:g(93)}},w=[];r<u;)59===(e=a(r))||44===e?r++:(n=l())?w.push(n):r<u&&xt('Unexpected "'+s(r)+'"',r);return 1===w.length?w[0]:{type:_t.COMPOUND,body:w}};kt.addUnaryOp=function(t){return Ct=Math.max(t.length,Ct),$t[t]=!0,this},kt.addBinaryOp=function(t,e){return Pt=Math.max(t.length,Pt),Ot[t]=e,this},kt.addLiteral=function(t,e){return Dt[t]=e,this},kt.removeUnaryOp=function(t){return delete $t[t],t.length===Ct&&(Ct=At($t)),this},kt.removeBinaryOp=function(t){return delete Ot[t],t.length===Pt&&(Pt=At(Ot)),this},kt.removeLiteral=function(t){return delete Dt[t],this};var Rt={},Tt={},St={eval:function(t){return m(t,this.parsed)},safeEval:function(t){try{return m(t,this.parsed)}catch(t){at("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return g(this.parsed).values()}};_.prototype=St;var qt=function(t){return new _(t)},Xt=0,Ft=function(t){var e="d3v"+ ++Xt;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},Bt=function(){var t=o.dispatch("change"),e=0;return{on:function(e,n){return arguments.length<2?t.on(e):(t.on(e,n),this)},trigger:dt(function(){t.apply("change",this,arguments),e+=1}),triggered:function(){return e}}},Ut=function(t){return t&&t.constructor===Object},Yt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(t,e)};L.prototype=D.prototype={constructor:D,toString:function(){return"[object d3Model]"},$on:function(t,e){1===arguments.length&&n.isFunction(t)&&(e=t,t="");var r=t.split("."),i=r[0],o=C(this,i);return o?(this.$events.get(i)||r.push(this.uid),r[0]="change",o.on(r.join("."),e)):at('Cannot bind to "'+i+'" - no such reactive property')},$change:function(t){var e=arguments.length?t:"",n=this.$events.get(e),r=Yt(arguments,1);return n?n.trigger.apply(this,r):this.isolated?at("attribute '"+e+"' is not a reactive property this model"):this.parent.$change(e),this},$update:function(t,e){if(t){e=2!==arguments.length||e;for(var n in t)(e||void 0===this[n])&&("$"===n.substring(0,1)?this.constructor.prototype[n]?at("Cannot set attribute method "+n+", it is protected"):this[n]=t[n]:this.$set(n,t[n]))}return this},$set:function(t,e){this.$events.get(t)?this[t]=e:A(this,t,e)},$new:function(t){return new D(t,this)},$off:function(t){if(void 0===t)this.$events.each(function(t){return P(t)});else{var e=t.split("."),n=e.splice(0,1)[0],r=this.$events.get(n);r&&P(r,e.join("."))}},$isReactive:function(t){return!!this.$events.has(t)||!(!this.parent||this.isolated)&&this.parent.$isReactive(t)},$owner:function(t){if(!this.$events.has(t)){if(!this.parent||this.isolated)return;return this.parent.$owner(t)}return this}},Object.defineProperty(D.prototype,"root",{get:function(){return this.parent?this.parent.root:this}});var zt={create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){this.active&&(this.removeAttribute(),this.identifiers=[],(t=this.mount(t))&&this.bindModel(t))},bindModel:function(t){var r=this,i=function(){var e=r.expression?r.expression.eval(t):void 0;r.refresh(t,e),r.passes++},o=void 0,s=void 0,a=void 0,u=void 0;if(this.expression){var c=e.map();this.expression.identifiers().forEach(function(e){for(o=e.split("."),s=t,a=null,u=0;u<o.length-1;++u)if(s=s[o[u]],!n.isObject(s)){a=o.slice(0,u+1).join("."),at("Property "+a+" is not an object. Directive "+r.name+" cannot bind to "+e);break}if(null===a){if(!(s instanceof L))return at(e+" is not a reactive model. Directive "+r.name+" cannot bind to it");I(c,s,o[o.length-1])}}),c.each(function(t){t.events.has("")?r.identifiers.push({model:t.model,attr:""}):t.events.each(function(e){r.identifiers.push({model:t.model,attr:e})})})}else r.identifiers.push({model:t,attr:""});this.identifiers.forEach(function(t){var e=t.attr+"."+r.uid;t.model.$on(e,i)}),this.bindDestroy(t),i()},bindDestroy:function(t){var e=this,n=this,r=this.destroy;n.destroy=function(){return r.call(n,t)},this.sel.on("remove."+n.uid,function(){e.identifiers.forEach(function(t){t.model.$off(t.attr+"."+n.uid)}),n.destroy()})}},Gt=function(t){function e(t,e,n){this.el=t,this.name=e.name,this.arg=n,this.passes=0;var r=ft(Ft(this)).create(e.value);r&&(this.expression=qt(r)),this.active||(this.active=!e.value||this.expression)}function r(t,n,r){return new e(t,n,r)}return e.prototype=n.assign({},wt,zt,t),r.prototype=e.prototype,r},Ht=function(t){if(n.isString(t))try{return JSON.parse(t)}catch(e){return t}return t},Vt=function(t){var e=void 0;return Object.keys(t).reduce(function(r,i){return"data-"===i.substring(0,5)&&(r[e=i.split("-").splice(1).reduce(function(t,e,n){return t+=n?e.substring(0,1).toUpperCase()+e.substring(1):e},"")]=n.pop(t,i)),r},{})},Jt=o.dispatch("message","component-created","component-mount","component-mounted"),Wt={render:function(){},childrenMounted:function(){},mounted:function(){},destroy:function(){},mount:function(t,e,r){var i=this;if(!T(this)){Jt.call("component-mount",void 0,this,t,e);var o=this.select(t),s=o.directives(),a=s?s.attrs:X(t),u=this.parent.model,c=o.datum(),l=this.props,d=this.model,f=n.assign(Vt(a),c,e),h=void 0,p=void 0;e=n.assign({},c,e);for(h in d)void 0!==(p=n.pop(f,h))&&(n.isString(p)?u.$isReactive(p)?p!==h?d[h]=F(p):delete d[h]:d[h]=Ht(p):d[h]=p);this.model=d=u.$child(d),this.model.$$view=this,n.isArray(l)&&(l=l.reduce(function(t,e){return t[e]=void 0,t},{})),n.isObject(l)&&Object.keys(l).forEach(function(t){void 0!==(p=Ht(void 0===f[t]?void 0===e[t]?a[t]:e[t]:f[t]))?(n.isString(p)&&d[p]&&(p=d[p]),e[t]=p):void 0!==l[t]&&(e[t]=l[t])}),d.$$name||(d.$$name=this.name);var v=this.render(e,a,t);return v.then||(v=Promise.resolve(v)),v.then(function(e){return q(i,t,e,r)})}at("already mounted")}},Kt=["name","class","disabled","readonly","required","href"],Qt=function(t,e){var n=i.select(t),r=n.directives();if(r)return r;if(r=new B,!e)return r;for(var o=0;o<t.attributes.length;++o){var s=t.attributes[o],a=s.name.split("-"),u="d3"===a[0]?a[1]:null,c=void 0;if(u){!(c=a.slice(2).join("-"))&&Kt.indexOf(u)>-1&&(c=u,u="attr");var l=e.get(u);l?r.add(l(t,s,c)):at(t.tagName+' cannot find directive "'+u+'". Did you forget to register it?')}r.attrs[s.name]=s.value}return r.size()&&n.directives(r),r};B.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size())return Promise.all(this.all.map(function(e){return e.execute(t)}))}},i.selection.prototype.mount=function(t,e){var n=[];return this.each(function(){var r=i.select(this).view();r?n.push(U(this,r,t,e)):at("Cannot mount, no view object available to mount to")}),Promise.all(n)},i.selection.prototype.view=function(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),n=e?e.__d3_view__:null,r=e?e.parentNode:null;r&&!n;)n=r.__d3_view__,r=r.parentNode;return n},i.selection.prototype.model=function(){var t=this.view();return t?t.model:null},i.selection.prototype.directives=function(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__};var Zt={use:function(t){return n.isObject(t)?t.install(this):t(this),this},addComponent:function(t,e){var n=j(t,e);return this.components.set(t,n),n},addDirective:function(t,e){var n=Gt(e);return this.directives.set(t,n),n},mount:function(t,e){if(T(this))at("already mounted");else if(Jt.call("component-mount",void 0,this,t),t=Y(t))return this.model=this.parent?this.parent.model.$child(this.model):L(this.model),R(this,t,e)}},te={attr:ct,html:lt,value:gt,on:yt,for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?at('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,i.select(this.creator).remove(),this.el)return t},refresh:function(t,e){if(n.isArray(e)){var r=void 0,i=this.creator,o=i.tagName+"."+this.itemClass,s=this.itemName,a=this.sel,u=a.selectAll(o),c=u.filter(function(){return r=this.__d3_view__.model[s],e.indexOf(r)>-1}).data(e),l=u.filter(function(){return r=this.__d3_view__.model[s],-1===e.indexOf(r)}),d=j("forView",Zt),f=a.view(),h=void 0,p=void 0,v=void 0,m=void 0;(this.transition(l)||l).style("opacity",0).remove(),c.enter().append(function(){return p=i.cloneNode(!0),v=f.select(p),f.transitionDuration(v)>0&&v.style("opacity",0),p}).classed(this.itemClass,!0).each(function(t,n){(h={index:n})[s]=t,d({model:h,parent:f}).mount(this,function(t){e[n]=t.model[s],(m=t.transition())&&m.style("opacity",1)})}).merge(c).each(function(t){this.__d3_view__.model[s]=t})}}},if:{mount:function(t){var e=this.sel;return this.display=e.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){var n=this.sel,r=this.passes?this.transition(n):null;e?n.style("display",this.display):r||n.style("display","none"),r&&(e?r.style("opacity",1):r.style("opacity",0).on("end",function(){return n.style("display","none")}))}}};n.inBrowser&&new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes,n=void 0;if(e&&e.length)for(var r=0;r<e.length;++r)(n=i.select(e[r])).view()&&(n.selectAll("*").each(z),z.call(e[r]))})}).observe(document.documentElement,{childList:!0,subtree:!0});var ee=k(e.map(),te),ne={logger:n.logger},re=function(t){ne.logger.warn("[d3-form] "+t)},ie=e.map({disabled:"disabled",readonly:"readOnly",required:"required"}),oe={inputData:function(t,e){var r=this.model;return e||(e={}),e.id=e.id||r.uid,r.data=e,t.attr("id",e.id),e.classes&&t.classed(e.classes,!0),V(t,r,e.attributes),ie.each(function(r,i){var o=e[i];o&&(n.isString(o)?t.attr("d3-attr-"+i,o):t.property(r,!0))}),e},wrap:function(t){var e=this,n=t;return e.model.$formExtensions.forEach(function(r){n=r(e,n,t)||n}),n},wrapTemplate:function(t,e){var n=document.createElement("div"),r=i.select(n).html(e).select("slot");if(!r.size())return re("template does not provide a slot element"),t;var o=i.select(r.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),r.remove(),i.selectAll(n.children)}},se=n.assign({},oe,{model:{value:null,error:"",isDirty:null,changed:!1,srOnly:!1,placeholder:"",showError:{reactOn:["error","isDirty"],get:function(){return!!this.error&&this.isDirty}},$validate:function(){}},inputData:function(t,e){if(!(e=oe.inputData.call(this,t,e)).name)return re("Input field without a name");t.attr("name",e.name),e.placeholder=e.placeholder||e.label||e.name;var n=this.model;return n.form.inputs[e.name]=n,n.name=e.name,n.$on("value",function(){null===n.isDirty?n.isDirty=!1:(n.isDirty=!0,n.changed=!0),n.form.$change()}),e}}),ae={text:"input",email:"input",password:"input",checkbox:"input",number:"input",date:"input",url:"input","datetime-local":"input"},ue=n.assign({},oe,{render:function(t){var e=t?t.tag||"fieldset":"fieldset",n=this.createElement(e);return t=this.inputData(n,t),W.call(this,n)}}),ce={get:function(t){var e=this.all.slice(0);if(n.isObject(t))for(var r in t)e.push(Z(r,t[r]));return e},set:function(t,e){var n=t.model;n._view=t,n.validators.forEach(function(t){return t.set(e,n.data)}),n.$on("value.validate",this.validate),n.$validate=this.validate},validate:function(){for(var t,e,n=this,r=n._view,i=n.validators,o=n.value,s=r.sel.attr("id")===n.data.id?r.sel:r.sel.select("#"+n.data.id),a=0;a<i.length;++a)if(t=i[a],e=t.validate(s,o)){!0===e&&(e="");break}n.error=e||""},all:[{set:function(t,e){var r=e.required;n.isString(r)?t.attr("d3-required",r):t.property("required",r||!1)},validate:function(t,e){if(t.property("required")){if(!e)return"required";if(""===e)return!0}}},{set:function(t,e){var r=e.minLength;n.isString(r)?t.attr("d3-attr-minlength",r):void 0!==r&&t.attr("minlength",r)},validate:function(t,e){var n=+t.attr("minlength");if(n===n&&n>0&&e.length<n)return"too short - "+n+" characters or more expected"}},{set:function(t,e){var r=e.maxLength;n.isString(r)?t.attr("d3-attr-maxlength",r):void 0!==r&&t.attr("maxlength",r)},validate:function(t,e){var n=+t.attr("maxlength");if(n===n&&n>0&&e&&e.length>n)return"too long - "+n+" characters or less expected"}},{set:function(t,e){var r=e.minimum;n.isString(r)?t.attr("d3-attr-min",r):void 0!==r&&t.attr("min",r)},validate:function(t,e){var n=Q(t);if(n&&+e<n[0])return"must be greater or equal "+n[0]}},{set:function(t,e){var r=e.maximum;n.isString(r)?t.attr("d3-attr-max",r):void 0!==r&&t.attr("max",r)},validate:function(t,e){var n=Q(t);if(n&&+e>n[1])return"must be less or equal "+n[1]}}]},le=["checkbox","radio"],de=n.assign({},se,{render:function(t){var e=this.createElement("input");return t=this.inputData(e,t),e.attr("type",t.type||"text").attr("d3-value","value"),-1===le.indexOf(e.attr("type"))&&e.attr("placeholder",t.placeholder),ce.set(this,e),this.wrap(e)}}),fe=n.assign({},se,{render:function(t){var e=this.createElement("textarea");return t=this.inputData(e,t),e.attr("placeholder",t.placeholder).attr("d3-value","value"),ce.set(this,e),this.wrap(e)}}),he=n.assign({},se,{model:n.assign({options:[],$optionLabel:function(){return n.isArray(this.option)?this.option[1]||this.option[0]:this.option},$optionValue:function(){return n.isArray(this.option)?this.option[0]:this.option}},se.model),render:function(t){var e=this.createElement("select");return t=this.inputData(e,t),e.attr("d3-value","value").attr("placeholder",t.placeholder).append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),ce.set(this,e),this.wrap(e)}}),pe=n.assign({},oe,{render:function(t){var e=t?t.tag||"button":"button",n=this.createElement(e);t=this.inputData(n,t);var r=this.model;return r.type=t.type||"submit",t.endpoint&&(r.endpoint=t.endpoint),r.$submit=function(){r.actions.submit.call(r,i.event)},t.submit||(t.submit="$submit()"),n.attr("type",r.type).attr("name",r.name).attr("d3-on-click",t.submit).html(t.label||"submit"),this.wrap(n)}}),ve={default:function(t){this.message(t)},redirect:function(t){window.location.href=t.redirectTo||"/"}},me={submit:function(t){var e=this,r=e.form,i=n.assign({},ge,e.endpoint);t&&(t.preventDefault(),t.stopPropagation());var o=ne.fetch,s=r.$inputData(),a={};if(o)if(i.url){if("application/json"===i.contentType)a.headers={"Content-Type":i.contentType},a.body=JSON.stringify(s);else{a.body=new FormData;for(var u in s)a.body.set(u,s[u])}r.$setSubmit()?(a.method=i.method,o(i.url,a).then(function(t){r.$setSubmitDone();var e=(t.headers.get("content-type")||"").split(";")[0];"application/json"===e?t.json().then(function(e){r.$response(e,t.status,t.headers)}):re("Cannot load content type '"+e+"'")},function(){r.$setSubmitDone()})):r.$setSubmitDone()}else re("No url, cannot submit");else re("fetch provider not available, cannot submit")}},ge={contentType:"application/json",method:"post"},ye={props:["schema","values"],components:{"d3-form-fieldset":ue,"d3-form-input":de,"d3-form-textarea":fe,"d3-form-select":he,"d3-form-submit":pe},model:{formSubmitted:!1,formPending:!1,$isValid:function(t){var e=void 0,n=!0;for(var r in this.inputs)e=this.inputs[r],t&&(e.isDirty=!0),e.$validate(),e.error&&(n=!1);return n},$setSubmit:function(){return this.formSubmitted=!0,this.formPending=!0,this.$isValid(!0)},$setSubmitDone:function(){this.formPending=!1},$inputData:function(){var t,e=this.inputs,n={};for(var r in e)((t=e[r].value)||de.changed)&&(n[r]=t);return n},$response:function(t,e,n){if(e<300)if(this.data.resultHandler){var r=ve[this.data.resultHandler];r?r.call(this,t,e,n):re("Could not find "+this.data.resultHandler+" result handler")}else ve.default.call(this,t,e,n);else this.$responseError(t,e,n)},$responseError:function(t){t.level="error",this.$message(t)}},render:function(t){function e(t){t=oe.inputData.call(o,i,t),r.validators=ce.get(t.validators);for(var e in me){var s=t[e];n.isString(s)&&(s=o.model.$get(s)),r.actions[e]=s||me[e]}return W.call(o,i),i}var r=this.model,i=this.createElement("form").attr("novalidate",""),o=this;r.$formExtensions=this.root.$formExtensions||[],r.inputs={},r.actions={},r.form=r;var s=t.schema;return t.values&&(s.values=t.values),n.isString(s)?(0,ne.fetch)(s,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(e);re("Could not load form from "+s+": status "+t.status)}):e(s)},childrenMounted:function(){var t=this.model,e=t.data.values;e&&Object.keys(e).forEach(function(n){var r=t.inputs[n];r&&(r.value=e[n])})}},be={install:function(t){t.addComponent("d3form",ye),t.$formExtensions=[];for(var e in t.providers)ne[e]=t.providers[e]},actions:me,responses:ve},Ee={input:["inputGroup","label","formGroup"],checkbox:["formCheck"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t,e){var n=t.model.data;return t.wrapTemplate(e,tt(n))},formGroup:function(t,e,n){var r=t.model.data,i=void 0!==r.size?r.size:t.model.form.data.size,o=i?"form-control form-control-"+i:"form-control";return n.classed(o,!0).attr("d3-class","["+(r.required||!1)+' ? "form-control-required" : null, showError ? "form-control-danger" : null]'),t.wrapTemplate(e,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e,n){var r=t.model.data.group;if(!r)return e;var i="g"+n.attr("id");return n.attr("aria-describedby",i),t.wrapTemplate(e,et(i,r))},formCheck:function(t,e,n){var r=t.model.data;return n.classed("form-check-input",!0),t.wrapTemplate(e,nt(r.label))},submit:function(t,e,n){var r=t.model.data.theme||"primary";return n.classed("btn",!0).classed("btn-"+r,!0),t.wrapTemplate(e,'<div class="form-group">\n<slot></slot>\n</div>')}}},we={install:function(t){if(!t.$formExtensions)return re("form bootstrap requires the form plugin installed first!");t.$formExtensions.push(rt)}};t.view=function(t){return j("view",Zt,ee)(t)},t.viewMount=function(t,e,n,r){var o=i.select(t).html(e).mount(n,r);return o||(o=new Promise(function(t){t()})),o},t.viewBase=wt,t.viewEvents=Jt,t.viewModel=L,t.viewExpression=qt,t.viewReady=function(t){st.readyCallbacks.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",G),window.addEventListener("load",G)):H()},t.viewProviders=st,t.viewWarn=at,t.viewDebug=ot,t.viewForms=be,t.viewBootstrapForms=we,t.viewUid=Ft,t.viewDebounce=dt,t.jsep=kt,t.viewVersion="1.0.0",t.viewElement=f,t.viewTemplate=l,t.viewHtml=d,t.jsonResponse=p,Object.defineProperty(t,"__esModule",{value:!0})});