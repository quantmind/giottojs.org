// d3-view Version 0.1.12. Copyright 2016 quantmind.com.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-let"),require("d3-timer"),require("d3-selection"),require("d3-collection"),require("d3-dispatch"),require("d3-transition")):"function"==typeof define&&define.amd?define("d3-view",["exports","d3-let","d3-timer","d3-selection","d3-collection","d3-dispatch","d3-transition"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,r,n,i,o,s){"use strict";function a(t,e){switch(e.type){case rt.IDENTIFIER:return t[e.name];case rt.LITERAL:return e.value;case rt.ARRAY_EXP:return e.elements.map(function(e){return a(t,e)});case rt.LOGICAL_EXP:case rt.BINARY_EXP:return d(e.operator,a(t,e.left),a(t,e.right));case rt.CALL_EXP:return l(t,e.callee,e.arguments);case rt.MEMBER_EXP:return a(a(t,e.object),e.property);case rt.CONDITIONAL_EXP:return a(t,e.test)?a(t,e.consequent):a(t,e.alternate);case rt.UNARY_EXP:return c(e.operator,a(t,e.argument))}}function u(t,e){switch(1===arguments.length&&(e=i.set()),t.type){case rt.IDENTIFIER:e.add(t.name);break;case rt.ARRAY_EXP:t.elements.forEach(function(t){u(t,e)});break;case rt.BINARY_EXP:u(t.left,e),u(t.right,e);break;case rt.CALL_EXP:u(t.arguments,e);break;case rt.MEMBER_EXP:u(t.object,e);break;case rt.CONDITIONAL_EXP:u(t.test,e),u(t.consequent,e),a(t.alternate,e)}return e}function l(t,e,r){var n;if(r=r.map(function(e){return a(t,e)}),e.type!==rt.IDENTIFIER&&(t=a(t,e.object),e=e.property),n=t[e.name],!n)throw new EvalError('callable "'+e.name+'" not found in context');return n.apply(t,r)}function c(t,e){return $t[t]||($t[t]=new Function("arg","return "+t+" arg")),$t[t](e)}function d(t,e,r){return Lt[t]||(Lt[t]=new Function("a","b","return a "+t+" b")),Lt[t](e,r)}function f(){if(e.inBrowser)return window.fetch}function p(t){this.codes=rt,this.expr=t,this.parsed=It(t)}function h(t){return arguments.length?this.property("__model__",t):this.node().__model__}function m(t,e){for(;!(e in t)&&t.$parent;)t=t.$parent;return t}function v(t,r,n){function i(e){u&&(e=u.get.call(t)),e!==n&&(c(n),n=e)}function s(){var o={get:function(){return n}};return e.isFunction(n)&&(n={get:n}),e.isObject(n)&&e.isFunction(n.get)?(u=n,n=u.get.call(t),u.reactOn?u.reactOn.forEach(function(e){t.$on(e+"."+r,i)}):t.$on("."+r,i),e.isFunction(u.set)&&(o.set=u.set)):o.set=i,o}var a,u,l=t.$events;l.set(r,o.dispatch("change")),Object.defineProperty(t,r,s());var c=Ht(function(){a=arguments[0],l.get(r).call("change",t,n,a),u||l.get("").call("change",t,r)});c()}function y(t,e){var r=t.$events.get(e);return!r&&t.parent?y(t.parent,e):r}function g(t){function e(t){Bt(this,t)}return e.prototype=t,e}function b(t,e){return!this.$events.has(t)&&this.$parent?b.call(this.$parent,t,e):void this.$set(t,e)}function E(t){Bt(this,t)}function w(t){return new E(t)}function x(t){var e=this,r=w(t);return Object.defineProperty(r,"parent",{get:function(){return e}}),r}function _(t){return arguments.length?this.property("__directives__",t):this.node().__directives__}function P(){this.attrs={},this._dirs={},this._all=[]}function C(t,e){var r=n.select(e),i=r.directives();i||(i=Kt(e,t.$vm?t.$vm.directives:null),t=Jt(i,null,t));var o=i.pop("for");return o?(o.execute(t),!0):(r.model()||r.model(t),void O(r,i))}function O(t,e){var r=t.model(),i=r.$vm;t.selectAll(function(){return this.children}).each(function(){var t=i?i.components.get(this.tagName.toLowerCase()):null;if(t)t({parent:i}).mount(this);else{C(r,this);var e=n.select(this);e.model()===r&&e.model(null)}}),e.size()?e.forEach(function(t){t.execute(r)}):t.directives(null)}function A(t){function r(t){this.el=t}function i(t){var e=new r(t);return Object.defineProperty(e,"value",{get:function(){return n.select(e.el).property("value")},set:function(t){n.select(e.el).property("value",t)}}),e}return r.prototype=e.assign({},re,t),i.prototype=r.prototype,i}function I(t,e,r){return Ht(function(){e.$set(r,t.value)})}function $(t){var r=e.inBrowser?window.handlebars:require("handlebars");return r?r.compile(t):void Dt("compile function requires handlebars")}function L(t,r){if(e.isString(t)){if(!r)return t;var n=$(t);if(!n)return t}return t(r)}function S(t,e){var r=n.select(document.createElement("div"));r.html(L(t,e));var i=r.node().children;return 1!==i.length&&Dt("HtmlElement function should return one root element only, got "+i.length),i[0]}function N(t,r){function n(t){var r=e.pop(t,"parent"),n=i.map(r?r.components:null),s=i.map(r?r.directives:me),a=o.dispatch("message");u.each(function(t,e){n.set(e,t)}),l.each(function(t,e){s.set(e,t)}),D(n,e.pop(t,"components")),R(s,e.pop(t,"directives")),Object.defineProperties(this,{components:{get:function(){return n}},directives:{get:function(){return s}},parent:{get:function(){return r}},root:{get:function(){return r?r.root:this}},props:{get:function(){return d}},uid:{get:function(){return this.model.uid}},events:{get:function(){return a}}}),this.model=e.assign({},c,e.pop(t,"model")),this.init(t)}function s(t){return new n(t)}r=r||ye,e.isFunction(t)&&(t={render:t});var a=e.assign({},t),u=D(i.map(),e.pop(a,"components")),l=R(i.map(),e.pop(a,"directives")),c=e.pop(a,"model"),d=e.pop(a,"props");return n.prototype=e.assign({},r,a),s.prototype=n.prototype,s}function D(t,e){return i.map(e).each(function(e,r){t.set(r,N(e,ge))}),t}function R(t,e){return i.map(e).each(function(e,r){t.set(r,Ft(e))}),t}function T(t,e){var i=t.model;Object.defineProperty(Mt(t),"el",{get:function(){return e}}),Object.defineProperty(i,"$vm",{get:function(){return t}}),n.select(e).model(i),C(i,e),r.timeout(function(){t.mounted()})}function j(t){if(!t)return Dt("element not defined, pass an identifier or an HTMLElement object");var r=e.isFunction(t.node)?t:n.select(t),i=r.node();return i?i:void Dt("could not find "+t+" element")}function k(t){var e=t.isMounted;return e||Object.defineProperty(t,"isMounted",{get:function(){return!0}}),e}function X(t,e,r){return r?(r=pe(r),1!==r.size()&&Dt("render function must return a single HTML node"),r=r.node(),e.parentNode.insertBefore(r,e),n.select(e).remove(),void T(t,r)):Dt("render function must return a single HTML node. It returned nothing!")}function M(){document.removeEventListener("DOMContentLoaded",M),window.removeEventListener("load",M),q()}function q(){for(var t=void 0;we.length;)t=we.shift(),r.timeout(t)}function F(t){var e=this;return new Promise(function(t){t()}).then(function(){return t.call(e)})}function B(t){var e=t.type||"text";return Ie[e]||e}function U(t){var r=this.data.children;if(r){if(!e.isArray(r))return Ce("children should be an array of fields, for "+("undefined"==typeof r?"undefined":Oe(r))),t;t.selectAll(".d3form").data(r).enter().append(Y).classed("d3form",!0)}return t}function H(t){t||(t={}),this.data=t;var e=this.model;return Ae.forEach(function(r){r in t&&e.$set(r,t[r])}),t}function Y(t){var e=B(t);return e||(Ce("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3"+e)}function G(t){var e=t.formTheme;return!e&&t.parent?G(t.parent):e}function V(t){var e=t.attr("min"),r=t.attr("max");return e=null===e?-(1/0):+e,r=null===r?1/0:+r,[e,r]}function z(t,e){return{set:function(e,r){var n=r[t]},validate:function(t,r){return e(t,r)}}}function J(){return e.isArray(this.option)?this.option[0]:this.option}function W(){return e.isArray(this.option)?this.option[1]||this.option[0]:this.option}function K(t){var e=t.json();this.message(e)}function Q(){window.location.href=this.data.redirectTo||"/"}function Z(t){function r(t){i.setSubmitDone(),i.response(t)}function n(){i.setSubmitDone()}var i=this&&this.model?this.model.form:null;if(!i)return void Ce("form not available, cannot submit");t&&(t.preventDefault(),t.stopPropagation());var o=_e.fetch,s=(i.data.enctype||"").split(";")[0],a=i.data.action,u=e.isObject(a)?a.url:a,l=i.inputData(),c={};if(!o)return void Ce("fetch provider not available, cannot submit");if(!u)return void Ce("No url, cannot submit");if("application/json"===s)c.headers={"Content-Type":i.data.enctype},c.body=JSON.stringify(l);else{c.body=new FormData;for(var d in l)c.body.set(d,l[d])}i.setSubmit(),c.method=i.method||"post",o(u,c).then(r,n)}function tt(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[required, labelSrOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}function et(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+e+"</span>\n<slot></slot>\n</div>"}var rt={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},nt=46,it=44,ot=39,st=34,at=40,ut=41,lt=91,ct=93,dt=63,ft=59,pt=58,ht=function(t,e){var r=new Error(t+" at character "+e);throw r.index=e,r.description=t,r},mt=!0,vt={"-":mt,"!":mt,"~":mt,"+":mt},yt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},gt=function(t){var e,r=0;for(var n in t)(e=n.length)>r&&t.hasOwnProperty(n)&&(r=e);return r},bt=gt(vt),Et=gt(yt),wt={true:!0,false:!1,null:null},xt="this",_t=function(t){return yt[t]||0},Pt=function(t,e,r){var n="||"===t||"&&"===t?rt.LOGICAL_EXP:rt.BINARY_EXP;return{type:n,operator:t,left:e,right:r}},Ct=function(t){return t>=48&&t<=57},Ot=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!yt[String.fromCharCode(t)]},At=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!yt[String.fromCharCode(t)]},It=function(t){for(var e,r,n=0,i=t.charAt,o=t.charCodeAt,s=function(e){return i.call(t,e)},a=function(e){return o.call(t,e)},u=t.length,l=function(){for(var t=a(n);32===t||9===t;)t=a(++n)},c=function t(){var e,r,i=f();return l(),a(n)!==dt?i:(n++,e=t(),e||ht("Expected expression",n),l(),a(n)===pt?(n++,r=t(),r||ht("Expected expression",n),{type:rt.CONDITIONAL_EXP,test:i,consequent:e,alternate:r}):void ht("Expected :",n))},d=function(){l();for(var e=t.substr(n,Et),r=e.length;r>0;){if(yt.hasOwnProperty(e))return n+=r,e;e=e.substr(0,--r)}return!1},f=function(){var t,e,r,i,o,s,a,u;if(s=p(),e=d(),!e)return s;for(o={value:e,prec:_t(e)},a=p(),a||ht("Expected expression after "+e,n),i=[s,o,a];(e=d())&&(r=_t(e),0!==r);){for(o={value:e,prec:r};i.length>2&&r<=i[i.length-2].prec;)a=i.pop(),e=i.pop().value,s=i.pop(),t=Pt(e,s,a),i.push(t);t=p(),t||ht("Expected expression after "+e,n),i.push(o,t)}for(u=i.length-1,t=i[u];u>1;)t=Pt(i[u-1].value,i[u-2],t),u-=2;return t},p=function e(){var r,i,o;if(l(),r=a(n),Ct(r)||r===nt)return h();if(r===ot||r===st)return m();if(Ot(r)||r===at)return g();if(r===lt)return E();for(i=t.substr(n,bt),o=i.length;o>0;){if(vt.hasOwnProperty(i))return n+=o,{type:rt.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},h=function(){for(var t,e,r="";Ct(a(n));)r+=s(n++);if(a(n)===nt)for(r+=s(n++);Ct(a(n));)r+=s(n++);if(t=s(n),"e"===t||"E"===t){for(r+=s(n++),t=s(n),"+"!==t&&"-"!==t||(r+=s(n++));Ct(a(n));)r+=s(n++);Ct(a(n-1))||ht("Expected exponent ("+r+s(n)+")",n)}return e=a(n),Ot(e)?ht("Variable names cannot start with a number ("+r+s(n)+")",n):e===nt&&ht("Unexpected period",n),{type:rt.LITERAL,value:parseFloat(r),raw:r}},m=function(){for(var t,e="",r=s(n++),i=!1;n<u;){if(t=s(n++),t===r){i=!0;break}if("\\"===t)switch(t=s(n++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||ht('Unclosed quote after "'+e+'"',n),{type:rt.LITERAL,value:e,raw:r+e+r}},v=function(){var e,r=a(n),i=n;for(Ot(r)?n++:ht("Unexpected "+s(n),n);n<u&&(r=a(n),At(r));)n++;return e=t.slice(i,n),wt.hasOwnProperty(e)?{type:rt.LITERAL,value:wt[e],raw:e}:e===xt?{type:rt.THIS_EXP}:{type:rt.IDENTIFIER,name:e}},y=function(t){for(var e,r,i=[],o=!1;n<u;){if(l(),e=a(n),e===t){o=!0,n++;break}e===it?n++:(r=c(),r&&r.type!==rt.COMPOUND||ht("Expected comma",n),i.push(r))}return o||ht("Expected "+String.fromCharCode(t),n),i},g=function(){var t,e;for(t=a(n),e=t===at?b():v(),l(),t=a(n);t===nt||t===lt||t===at;)n++,t===nt?(l(),e={type:rt.MEMBER_EXP,computed:!1,object:e,property:v()}):t===lt?(e={type:rt.MEMBER_EXP,computed:!0,object:e,property:c()},l(),t=a(n),t!==ct&&ht("Unclosed [",n),n++):t===at&&(e={type:rt.CALL_EXP,arguments:y(ut),callee:e}),l(),t=a(n);return e},b=function(){n++;var t=c();return l(),a(n)===ut?(n++,t):void ht("Unclosed (",n)},E=function(){return n++,{type:rt.ARRAY_EXP,elements:y(ct)}},w=[];n<u;)e=a(n),e===ft||e===it?n++:(r=c())?w.push(r):n<u&&ht('Unexpected "'+s(n)+'"',n);return 1===w.length?w[0]:{type:rt.COMPOUND,body:w}};It.addUnaryOp=function(t){return bt=Math.max(t.length,bt),vt[t]=mt,this},It.addBinaryOp=function(t,e){return Et=Math.max(t.length,Et),yt[t]=e,this},It.addLiteral=function(t,e){return wt[t]=e,this},It.removeUnaryOp=function(t){return delete vt[t],t.length===bt&&(bt=gt(vt)),this},It.removeBinaryOp=function(t){return delete yt[t],t.length===Et&&(Et=gt(yt)),this},It.removeLiteral=function(t){return delete wt[t],this};var $t={},Lt={},St={logger:e.logger,fetch:f()},Nt="[d3-view]",Dt=function(t){St.logger.warn(Nt+" "+t)},Rt={eval:function(t){return a(t,this.parsed)},safeEval:function(t){try{return a(t,this.parsed)}catch(t){Dt("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return u(this.parsed).values()}};p.prototype=Rt;var Tt=function(t){try{return new p(t)}catch(e){Dt("Could not parse <<"+t+">> expression: "+e)}},jt=0,kt="v",Xt=function(t){var e=kt+ ++jt;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},Mt=function(t){return Object.defineProperty(t,"sel",{get:function(){return n.select(this.el)}}),t},qt={priority:1,create:function(t){return t},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){var e=this;if(this.expression&&(this.removeAttribute(),t=this.mount(t))){var r=this,n=this.sel,i=function(){try{r.refresh(t,r.expression.eval(t))}catch(t){Dt('Error while refreshing "'+r.name+'" directive: '+t)}};this.identifiers=this.expression.identifiers().map(function(e){var n=e+"."+r.uid;return t.$on(n,i),e}),n.on("remove."+r.uid,function(){e.identifiers.forEach(function(e){t.$off(e+"."+r.uid)}),r.destroy(t)}),i()}}},Ft=function(t){function r(t,e,r){this.el=t,this.name=e.name,this.arg=r;var n=Mt(Xt(this)).create(e.value);n&&(this.expression=Tt(n))}function n(t,e,n){return new r(t,e,n)}return r.prototype=e.assign({},qt,t),n.prototype=r.prototype,n};n.selection.prototype.model=h;var Bt=function(t,e){var r=i.map();r.set("",o.dispatch("change")),Object.defineProperty(Xt(t),"$events",{get:function(){return r}}),t._Child=null,t.$update(e)},Ut=function(t){var e=t.split("."),r=e.splice(0,1),n=m(this,r);if(r in n){for(var i=n[r];i&&e.length;)i=i[e.splice(0,1)];return i}},Ht=function(t,e){var n=!1;return function(){if(!n){var i=Array.prototype.slice.call(arguments);n=!0,r.timeout(function(){n=!1,t.apply(void 0,i)},e)}}},Yt=function(t,e){this.$events.get(t)?this[t]=e:v(this,t,e)},Gt=function(t,r){1===arguments.length&&e.isFunction(t)&&(r=t,t="");var n=t.split("."),i=n[0],o=y(this,i);return o?(this.$events.get(t)||n.push(this.uid),n[0]="change",o.on(n.join("."),r)):Dt('Cannot bind to "'+i+'" - no such reactive property')},Vt=function(t,e){t&&(e=2!==arguments.length||e);for(var r in t)(e||void 0===this[r])&&("$"===r.substring(0,1)?this.constructor.prototype[r]?Dt("Cannot set attribute method "+r+", it is protected"):this[r]=t[r]:this.$set(r,t[r]));return this},zt=function(t){this._Child||(this._Child=g(this));var e=this,r=new this._Child(t);return Object.defineProperty(r,"parent",{get:function(){return e}}),r};w.prototype=E.prototype,E.prototype.$on=Gt,E.prototype.$update=Vt,E.prototype.$get=Ut,E.prototype.$set=Yt,E.prototype.$child=zt,E.prototype.$new=x,E.prototype.$setbase=b;var Jt=function(t,e,r){var n=t.pop("model");if(t.get("for")&&!r&&(Dt('Cannot have a "d3-for" directive in the root view element'),t.pop("for")),!r)return n&&Dt("Cannot have a d3-model directive in the root element"),w(e);if(n){n.execute(r);var i=n.sel.model();return i&&i.$update(e,!1),i}return e?r.$child(e):r},Wt=["name","class","disabled","readonly","required"];n.selection.prototype.directives=_;var Kt=function(t,e){var r=n.select(t),i=r.directives();if(i)return i;if(i=new P,r.directives(i),!e)return i;for(var o=0;o<t.attributes.length;++o){var s=t.attributes[o],a=s.name.split("-"),u=a[2],l="d3"===a[0]?a[1]:null;if(l){!u&&Wt.indexOf(l)>-1&&(u=l,l="attr");var c=e.get(l);c?i.add(l,c(t,s,u)):Dt(t.tagName+' cannot find directive "'+l+'". Did you forget to register it?')}i.attrs[s.name]=s.value}return i.sorted()};P.prototype={size:function(){return this._all.length},get:function(t){return this._dirs[t]},pop:function(t){var e=this._dirs[t];if(e){delete this._dirs[t],e.removeAttribute();var r=this._all.indexOf(e);r>-1&&this._all.splice(r,1)}return e},add:function(t,e){this._dirs[t]=e,this._all.push(e)},sorted:function(){return this._all.sort(function(t){return-t.priority}),this},forEach:function(t){this._all.forEach(t)}};var Qt={mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return Dt('d3-model expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var r=t.$child(e.eval(t));this.sel.model(r),t.$setbase(this.expression.expr,r)}},Zt=["disabled","readonly","required"],te={create:function(t){return this.arg?t:Dt("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,r){return"class"===this.arg?this.refreshClass(r):e.isArray(r)?Dt("Cannot apply array to attribute "+this.arg):void(Zt.indexOf(this.arg)>-1?this.sel.property(this.arg,r||null):this.sel.attr(this.arg,r))},refreshClass:function(t){var r=this.sel;e.isArray(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&r.classed(t,!1)}),this.oldValue=t.map(function(t){var n=!0;return e.isArray(t)&&(n=t[1],t=t[0]),t&&r.classed(t,n),t})}},ee={refresh:function(t,r){e.isString(r)&&this.sel.html(r)}},re={on:function(t,e){var r=I(this,t,e);n.select(this.el).on("input",r).on("change",r)}},ne=A(),ie=A(),oe={input:ne,textarea:ie},se={create:function(t){var e=this.sel.attr("type"),r=this.el.tagName.toLowerCase(),n=oe[e]||oe[r];return n?(this.tag=new n(this.el),t):Dt("Cannot apply d3-value directive to "+r)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return Dt('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var r=this.expression.expr;return t.$set(r,this.tag.value),this.tag.on(t,r),t},refresh:function(t,e){this.tag.value=e},destroy:function(){this.tag.off()}},ae={mount:function(t){return this.display=this.sel.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){e?this.sel.style("display",this.display):this.sel.style("display","none")}},ue={mount:function(t){var e=this.arg||"click",r=this.expression;this.sel.on(e+"."+this.uid,function(){r.eval(t)})}},le={refresh:function(t){s.transition(t)}},ce={create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t?e.push(t):null}),3!==e.length||"in"!=e[1]?Dt('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},mount:function(t){return this.creator=this.el,this.el=this.creator.parentNode,n.select(this.creator).remove(),t},refresh:function(t,r){if(e.isArray(r)){var n=this.creator,i=n.tagName+"."+this.itemClass,o=this.itemName,s=this.sel.selectAll(i).data(r);s.enter().append(function(){return n.cloneNode(!0)}).classed(this.itemClass,!0).each(function(e,r){var n={index:r};n[o]=e,C(t.$child(n),this)}),s.exit().remove()}}},de={refresh:function(t,e){e?this.sel.style("display",null):this.sel.style("display","none")}},fe={model:Qt,attr:te,html:ee,value:se,show:ae,on:ue,transition:le,for:ce,if:de},pe=function(t){return t&&!e.isFunction(t.size)?n.select(t):t},he=function(t){if(e.isString(t))try{return JSON.parse(t)}catch(e){return t}return t},me=R(i.map(),fe),ve={isd3:!0,providers:St,htmlElement:S,viewElement:S,init:function(){},mounted:function(){},createElement:function(t){return n.select(document.createElement(t))},responseError:function(t){var e=this;t.json().then(function(r){e.error(r,t)})},error:function(t){t.level="error",this.message(t)},message:function(t){var e=this;this.root.events.call("message",e,t)},fetch:function t(e,r){var t=St.fetch;return 1==arguments.length?t(e):t(e,r)}},ye=e.assign({},ve,{use:function(t){return e.isObject(t)?t.install(this):t(this),this},addComponent:function(t,e){if(this.isMounted)return Dt("already mounted, cannot add component");var r=N(e,ge);return this.components.set(t,r),r},addDirective:function(t,e){if(this.isMounted)return Dt("already mounted, cannot add directive");var r=Ft(e);return this.directives.set(t,r),r},mount:function(t){if(k(this))Dt("already mounted");else if(t=j(t)){var e=this.parent?this.parent.model:null;this.model=Jt(Kt(t,this.directives),this.model,e),T(this,t)}return this}}),ge=e.assign({},ve,{render:function(){},mount:function(t){if(k(this))Dt("already mounted");else{var r=this.parent?this.parent.model:null,i=Kt(t,this.directives),o=Jt(i,this.model,r);if(this.model=o,C(this.model,t))return;var s=n.select(t).datum()||{};if(e.isArray(this.props)){var a,u;this.props.forEach(function(t){a=i.attrs[t],u=o[a]?o[a]:he(a),s[t]=u})}var l=this.render(s,i.attrs);if(e.isPromise(l)){var c=this;l.then(function(e){X(c,t,e)})}else X(this,t,l)}return this}}),be=N(),Ee=function(t){we.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",M),window.addEventListener("load",M)):q()},we=[],xe=function(t){var r=new Promise;return e.inBrowser?window.require(t,function(){r.resolve.call(arguments)}):(t=require(t),r.resolve(t)),r},_e={logger:e.logger},Pe="[d3-form]",Ce=function(t){_e.logger.warn(Pe+" "+t)},Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae=(function(){function t(t){this.value=t}function e(e){function r(t,e){return new Promise(function(r,i){var a={key:t,arg:e,resolve:r,reject:i,next:null};s?s=s.next=a:(o=s=a,n(t,e))})}function n(r,o){try{var s=e[r](o),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(s.done?"return":"normal",s.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?n(o.key,o.arg):s=null}var o,s;this._invoke=r,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),["labelSrOnly","layout"]),Ie={text:"input",password:"input",number:"input"},$e={render:function(t){var e=this.createElement("fieldset");return H.call(this,t),U.call(this,e)}},Le={wrap:function t(e){var r=this,n=G(r),i=n?n[e.attr("type")]||n[e.node().tagName.toLowerCase()]:null;if(!i||!n.wrappers)return e;var t,o=e;return i.forEach(function(i){t=n.wrappers[i],t?o=t.call(r,o,e):Ce("Could not find form field wrapper "+i)}),o},wrapTemplate:function(t,e){var r=document.createElement("div"),i=n.select(r).html(e),o=i.select("slot");if(!o.size())return Ce("template does not provide a slot element"),t;var s=n.select(o.node().parentNode);return t.nodes().forEach(function(t){s.insert(function(){return t},"slot")}),o.remove(),n.selectAll(r.children)}},Se=e.assign({model:{error:"",isDirty:!1,showError:{reactOn:["error","isDirty","formSubmitted"],get:function(){return!!this.error&&(this.isDirty||this.formSubmitted)}}},mounted:function(){this.model.$on("value",function(){this.isDirty=!0})},inputData:function(t){return t=H.call(this,t),t.name||Ce("Input field without a name"),t.placeholder=t.placeholder||t.label||t.name,t.id=t.id||"d3f"+this.uid,this.model.inputs[t.name]=this.model,t}},Le),Ne={set:function(t,r){var n=r.required;e.isString(n)?t.attr("d3-required",n):t.property("required",n||null)},validate:function(t,e){if(t.property("required")){if(!e)return"required"}else if(""===e)return!0}},De={set:function(t,r){var n=r.minlength;e.isString(n)?t.attr("d3-attr-minlength",n):void 0!==n&&t.attr("minlength",n)},validate:function(t,e){var r=+t.attr("minlength");if(r===r&&r>0&&e.length<r)return"too short - "+r+" characters or more expected"}},Re={set:function(t,r){var n=r.maxlength;e.isString(n)?t.attr("d3-attr-maxlength",n):void 0!==n&&t.attr("maxlength",n)},validate:function(t,e){var r=+t.attr("maxlength");if(r===r&&r>0&&e.length>r)return"too long - "+r+" characters or less expected"}},Te={set:function(t,r){var n=r.min;e.isString(n)?t.attr("d3-attr-min",n):void 0!==n&&t.attr("min",n)},validate:function(t,e){var r=V(t);if(r&&+e<r[0])return"must be greater or equal "+r[0]}},je={set:function(t,r){var n=r.max;e.isString(n)?t.attr("d3-attr-max",n):void 0!==n&&t.attr("max",n)},validate:function(t,e){var r=V(t);if(r&&+e>r[1])return"must be less or equal "+r[1]}},ke={get:function(t,r){var n=this.all.slice(0);if(e.isObject(r))for(var i in r)n.push(z(i,r[i]));return n},set:function(t,e){t.model.validators.forEach(function(r){r.set(e,t.data)}),t.model.$on(this.validate)},validate:function(t){if("value"===t){for(var e,r,n=this.$vm,i=this.validators,o=n.sel.attr("id")===n.data.id?n.sel:n.sel.select("#"+n.data.id),s=this.value,a=0;a<i.length;++a)if(e=i[a],r=e.validate(o,s)){r===!0&&(r="");break}this.error=r||""}},all:[Ne,De,Re,Te,je]},Xe=e.assign({render:function(t){t=this.inputData(t);var e=this.createElement("input").attr("id",t.id).attr("type",t.type||"text").attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return ke.set(this,e),this.wrap(e)}},Se),Me=e.assign({render:function(t){t=this.inputData(t);var e=this.createElement("textarea").attr("id",t.id).attr("name",t.name).attr("placeholder",t.placeholder).attr("d3-value","value").attr("d3-validate","validators");return ke.set(this,e),this.wrap(e)}},Se),qe=e.assign({},Se,{model:e.assign({options:[],$optionLabel:W,$optionValue:J},Se.model),render:function(t){t=this.inputData(t);var e=this.createElement("select").attr("id",t.id).attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return this.model.options=t.options,e.append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),ke.set(this,e),this.wrap(e)}}),Fe=e.assign({render:function(t){t=H.call(this,t),t.type=t.type||"submit",this.model.$set("error",!1),e.isString(t.disabled)||(this.model.$set("disabled",t.disabled||null),t.disabled="disabled"),t.click||(t.click="$vm.click()");var r=this.createElement("button").attr("type",t.type).attr("name",t.name).attr("d3-attr-disabled",t.disabled).attr("d3-on-click",t.click).html(t.label||"submit");return this.wrap(r)},click:function(){this.model.form.actions.submit.call(this,n.event)}},Le),Be={default:K,redirect:Q},Ue={submit:Z},He={props:["json"],model:{formSubmitted:!1,formPending:!1},components:{d3fieldset:$e,d3input:Xe,d3textarea:Me,d3select:qe,d3submit:Fe},render:function(t){function r(r){H.call(o,r),n.validators=ke.get(n,t.validators),o.actions={};for(var s in Ue){var a=o.data[s];e.isString(a)&&(a=o.model.$get(a)),o.actions[s]=a||Ue[s]}return U.call(o,i),i}var n=this.model,i=this.createElement("form").attr("novalidate",""),o=this;n.inputs={},n.form=this;var s=t.json;if(e.isString(s)){var a=_e.fetch;return a(s,{method:"GET"}).then(function(t){return 200===t.status?t.json().then(r):void Ce("Could not load form from "+s+": status "+t.status)})}return r(s)},inputData:function(){var t,e=this.model.inputs,r={};for(var n in e)t=e[n].value,void 0!==t&&(r[n]=t);return r},setSubmit:function(){var t=this;return this.model.formSubmitted=!0,this.model.formPending=!0,F.call(this,function(){return t.isValid()})},setSubmitDone:function(){this.model.formPending=!1},isValid:function(){var t;for(var e in this.model.inputs)if(t=this.model.inputs[e],t.error)return!1;return!0},inputError:function(t){var e=this.model.inputs[t.name];e||(Ce("Unknown input, cannot set input error"),this.error(t))},response:function(t){if(t){var r;if(t.status)t.status<300?this.data.resultHandler?(r=Be[this.data.resultHandler],r?r.call(this,t):Ce("Could not find "+this.data.resultHandler+" result handler")):Be.default.call(this,t):this.responseError(t);else if(t.error)this.error(t.error);else if(e.isArray(t.errors)){var n=this;t.errors.forEach(function(t){n.inputError(t)})}else this.data.resultHandler?(r=Be[this.data.resultHandler],r?r.call(this,t):Ce("Could not find "+this.data.resultHandler+" result handler")):Be.default.call(this,t)}}},Ye={install:function(t){t.addComponent("d3form",He);for(var e in t.providers)_e[e]=t.providers[e]},actions:Ue,responses:Be},Ge=function(t){return this.wrapTemplate(t,tt(this.data))},Ve='<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>',ze=function(t,e){return e.classed("form-control",!0).attr("d3-class",'showError ? "form-control-danger" : null'),this.wrapTemplate(t,Ve)},Je=function(t,e){var r=this.data.group;if(!r)return t;var n="g"+e.attr("id");return e.attr("aria-describedby",n),this.wrapTemplate(t,et(n,r))},We='<div class="form-group">\n<slot></slot>\n</div>',Ke=function(t,e){var r=this.data.theme||"primary";return e.classed("btn",!0).classed("btn-"+r,!0),this.wrapTemplate(t,We)},Qe={input:["inputGroup","label","formGroup"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:Ge,formGroup:ze,inputGroup:Je,submit:Ke}},Ze={install:function(t){var e=t.components.get("d3form");e&&(e.prototype.formTheme=Qe)}},tr="0.1.12";t.view=be,t.viewModel=w,t.viewExpression=Tt,t.viewReady=Ee,t.viewProviders=St,t.viewWarn=Dt,t.viewRequire=xe,t.viewForms=Ye,t.viewBootstrapForms=Ze,t.viewUid=Xt,t.viewDebounce=Ht,t.viewVersion=tr,t.viewElement=S,t.viewTemplate=$,t.viewHtml=L,Object.defineProperty(t,"__esModule",{value:!0})});