// https://github.com/quantmind/d3-canvas-transition Version 0.2.6. Copyright 2016 undefined.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-collection"),require("d3-color"),require("d3-timer")):"function"==typeof define&&define.amd?define("d3-canvas-transition",["exports","d3-selection","d3-collection","d3-color","d3-timer"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i){"use strict";function o(t){var e=t.context,n=a(t,t.attrs.get("stroke"),t.getValue("stroke-opacity")),r=j(t.attrs.get("stroke-width"));return r&&(e.lineWidth=t.factor*r),n&&(e.strokeStyle=n),n}function s(t){var e=t.context,n=a(t,t.attrs.get("fill"),t.getValue("fill-opacity"));return n&&(e.fillStyle=n),n}function a(t,e,n){if(e&&"none"!==e){if("string"==typeof e&&"url("===e.substring(0,4)){var i=e.substring(4,e.length-1);return t=b(t.rootNode).select(i).node(),t?u(t,n):null}var o=r.color(e);if(o)return(n||0===n)&&(o.opacity=n),""+o}}function c(t){this.node=t}function u(t,e){var n=k[t.tagName];if(n)return n(t,e)}function l(){return new f}function f(){this._head=null,this._tail=null,this._length=0,Object.defineProperty(this,"length",{get:function(){return this._length}})}function h(t,e){var n=t.rootNode;n._touches||(n._touches=0),n._touches+=e,n._touches&&!n._scheduled&&(n._scheduled=i.timeout(g(n)))}function d(t){var e=t.countNodes,n=S.get(t.tagName);if(n!==!1)if(t.attrs){var r,i,a=t.context;a.save(),A.each(function(e){return e(t)}),r=o(t),i=s(t),n&&n(t,r,i),e&&t.each(function(t){return d(t)}),a.restore()}else e&&t.each(function(t){return d(t)})}function g(t){return function(){var e=t.context;t._touches=0,e.beginPath(),e.closePath(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),d(t),t._scheduled=!1,h(t,0)}}function p(t,e){var n,r="";Object.defineProperties(this,{context:{get:function(){return e}},deque:{get:function(){return n||(n=l()),n}},tagName:{get:function(){return t}},childNodes:{get:function(){return n?n.list():[]}},firstChild:{get:function(){return n?n._head:null}},lastChild:{get:function(){return n?n._tail:null}},parentNode:{get:function(){return this._parent}},previousSibling:{get:function(){return this._prev}},nextSibling:{get:function(){return this._next}},namespaceURI:{get:function(){return V}},textContent:{get:function(){return r},set:function(t){r=""+t,h(this,1)}},clientLeft:{get:function(){return e.canvas.clientLeft}},clientTop:{get:function(){return e.canvas.clientTop}},clientWidth:{get:function(){return e.canvas.clientWidth}},clientHeight:{get:function(){return e.canvas.clientHeight}},rootNode:{get:function(){return this.context._rootElement}},countNodes:{get:function(){return n?n._length:0}},factor:{get:function(){return this.context._factor}}})}function v(t,e,n){for(var r,i,o,s,a,c=t.split(" "),u=new x(e),l=u.next(),f=0;f<c.length;++f)t=c[f],"*"===t?t={}:(t.indexOf("#")>-1?(i=t.split("#"),o=i[0],s=i[1]):t.indexOf(".")>-1?(i=t.split("."),o=i[0],r=i.splice(1).join(" ")):o=t,t={tag:o,id:s,classes:r}),c[f]=t;for(;l;){for(var h=0;h<c.length;++h)if(a=c[h],!(a.tag&&l.tagName!==a.tag||a.id&&l.id!==a.id||a.classes&&l.class!==a.classes)){if(n){n.push(l);break}return l}l=u.next()}return n}function x(t){this.node=t,this.current=t}function _(t,e){return function(){e.apply(t,arguments)}}function y(t,e){return function(){t.apply(this,e)}}function b(t,n){var r=e.selection();return t?w(t)&&1===arguments.length?r.select(function(){return t}):"string"!=typeof t||(t=e.select(t).node())?(t.getContext&&(t=t.getContext("2d")),t._rootElement||(n||(n=E||q()),t._factor=n,t._rootElement=new p("canvas",t)),r.select(function(){return t._rootElement})):r:r}function m(t,e){if(arguments.length>1){var n,r=this._parents[0]||this.node();w(r)&&"function"==typeof e.context&&(n=e.pathObject,n||(e.context(r.context),n=R(e,r.factor),e.pathObject=n),arguments[1]=n)}return T.apply(this,arguments)}function w(t){return t instanceof p}function C(t){var e=this,n=e.node();if("CANVAS"!==n.tagName||w(n)||(e=b(n),n=e.node()),w(n)&&t){var r=n.context,i=n.factor,o=r.canvas.width,s=r.canvas.height;r.beginPath(),r.closePath(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,o,s),i>1&&(r.canvas.style.width=o+"px",r.canvas.style.height=s+"px",r.canvas.width=o*i,r.canvas.height=s*i,r.scale(i,i))}return e}function N(t){return 1===arguments.length?(E=t,this):this.factor}function P(t){for(var e=[],n=0,r=void 0,i=void 0,o=void 0,s=0;s<M.length;++s)r=M[s],i=t.getValue("font-"+r),i&&("size"===r?(n=t.factor*i,i=n+"px"):"family"===r&&(o=i),e.push(i));return n&&(o||e.push("sans serif"),t.context.font=e.join(" ")),n}var j=function(t,e){if("string"==typeof t){if("px"===t.substring(t.length-2))return+t.substring(0,t.length-2);if("%"===t.substring(t.length-1))return.01*t.substring(0,t.length-1)*(e||1);if("em"===t.substring(t.length-2))return t.substring(0,t.length-2)*(e||1)}else if("number"==typeof t)return t},k={linearGradient:function(t,e){var n,i=t.context,o=i.canvas,s=j(t.attrs.get("x1","0%"),o.width),a=j(t.attrs.get("x2","100%"),o.width),c=j(t.attrs.get("y1","0%"),o.height),u=j(t.attrs.get("y2","0%"),o.height),l=i.createLinearGradient(s,c,a,u);return t.each(function(t){n=r.color(t.attrs.get("stop-color")),(e||0===e)&&(n.opacity=e),l.addColorStop(j(t.attrs.get("offset")),""+n)}),l},radialGradient:function(){}};c.prototype={getPropertyValue:function(t){var e=this.node.getValue(t);return void 0===e&&(e=window.getComputedStyle(this.node.context.canvas).getPropertyValue(t)),e}};var O=function(t,e,n){var r=t.attrs.get(e);return r!==n&&(t.attrs.set(e,n),!0)};f.prototype=l.prototype={prepend:function(t,e){this._length?e?(t._prev=e._prev,t._next=e,e._prev&&(e._prev.next=t),e._prev=t):(t._prev=this._tail,t._next=null,this._tail._next=t):(t._prev=null,t._next=null),t._prev||(this._head=t),t._next||(this._tail=t),this._length++},remove:function(t){t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),this._head===t&&(this._head=t._next),this._tail===t&&(this._tail=t._prev),delete t._prev,delete t._next,this._length--},list:function t(){for(var e=this._head,t=[];e;)t.push(e),e=e._next;return t},each:function(t){for(var e=this._head;e;)t(e),e=e._next}};var S=n.map(),A=n.map(),V="canvas";p.prototype={querySelectorAll:function(t){return this.countNodes?v(t,this,[]):[]},querySelector:function(t){if(this.countNodes)return v(t,this)},createElementNS:function(t,e){return new p(e,this.context)},hasChildNodes:function(){return this.countNodes>0},contains:function(t){for(;t;){if(t._parent==this)return!0;t=t._parent}return!1},appendChild:function(t){return this.insertBefore(t)},insertBefore:function(t,e){if(t===this)throw Error("inserting self into children");if(!(t instanceof p))throw Error("Cannot insert a non canvas element into a canvas element");return t._parent&&t._parent.removeChild(t),this.deque.prepend(t,e),t._parent=this,h(this,1),t},removeChild:function(t){if(t._parent===this)return delete t._parent,this.deque.remove(t),h(this,1),t},setAttribute:function(t,e){"class"===t?this.class=e:"id"===t?this.id=e:(this.attrs||(this.attrs=n.map()),O(this,t,e)&&h(this,1))},removeAttribute:function(t){this.attrs&&(this.attrs.remove(t),h(this,1))},getAttribute:function(t){var e=this.attrs?this.attrs.get(t):void 0;return void 0!==e||this._parent||(e=this.context.canvas[t]),e},addEventListener:function(){var t=this.context.canvas;arguments[1]=_(this,arguments[1]),t.addEventListener.apply(t,arguments)},getBoundingClientRect:function(){return this.context.canvas.getBoundingClientRect()},each:function(t){this.countNodes&&this.deque.each(t)},getValue:function(t){var e=this.getAttribute(t);return void 0===e&&this._parent?this._parent.getValue(t):e},removeProperty:function(t){this.removeAttribute(t)},setProperty:function(t,e){this.setAttribute(t,e)},getProperty:function(t){return this.getAttribute(t)},getPropertyValue:function(t){return this.getAttribute(t)},getComputedStyle:function(t){return new c(t)},get ownerDocument(){return this},get style(){return this},get defaultView(){return this},get document(){return this.rootNode}},x.prototype={next:function(){var t=this.current;if(!t)return null;if(t.firstChild)t=t.firstChild;else for(;t;){if(t.nextSibling){t=t.nextSibling;break}t=t.parentNode,t===this.node&&(t=null)}return this.current=t,t}};var E,q=function(t){return t||window.devicePixelRatio||1},R=function(t,e){function n(){return y(t,arguments)}function r(t){return i*o(t)}var i=e*e,o=t.size();return t.size(r),n.size=function(t){return 0===arguments.length?r:(o=t,n)},n},T=e.selection.prototype.attr;e.selection.prototype.attr=m,e.selection.prototype.canvas=C,e.selection.prototype.canvasResolution=N;var z="0.2.6",B=function(t,e,n){var r=t.attrs,i=t.context,o=t.factor;i.beginPath(),i.arc(o*r.get("cx",0),o*r.get("cy",0),o*r.get("r",0),0,2*Math.PI),i.closePath(),i.stroke(),n&&i.fill()},G=function(t,e,n){var r=t.attrs,i=t.context;i.moveTo(t.factor*(r.get("x1")||0),t.factor*(r.get("y1")||0)),i.lineTo(t.factor*r.get("x2"),t.factor*r.get("y2")),i.stroke(),n&&i.fill()},L=function(t,e,n){var r=t.attrs.get("d"),i=t.context;if(r)if("function"==typeof r)i.beginPath(),r(t),i.stroke(),n&&i.fill();else if(window.Path2D){var o=window.Path2D,s=new o(r);i.stroke(s),n&&i.fill()}},I=function(t,e,n){var r=t.attrs,i=t.context;i.rect(0,0,t.factor*(r.get("width")||0),t.factor*(r.get("height")||0)),e&&i.stroke(),n&&i.fill()},M=["style","variant","weight","size","family"],W="middle",D={start:"start",middle:"center",end:"end"},H=function(t){var e=t.factor,n=P(t)/e,r=t.context;r.textAlign=D[t.getValue("text-anchor")]||D.middle,r.textBaseline=t.getValue("text-baseline")||W,r.fillText(t.textContent||"",e*j(t.attrs.get("dx")||0,n),e*j(t.attrs.get("dy")||0,n))},J=function(t){var e=t.attrs.get("opacity");void 0!==e&&(t.context.globalAlpha=+e),e=t.attrs.get("shape-rendering"),"crispEdges"===e&&(t.context.imageSmoothingEnabled=!1)},U=function(t){var e,n,r=+(t.attrs.get("x")||0),i=+(t.attrs.get("y")||0),o=t.attrs.get("transform"),s=t.context;if("string"==typeof o){var a,c,u,l=o.indexOf("translate(");if(l>-1&&(c=o.substring(l+10),a=c.indexOf(")"),u=c.substring(0,a).split(","),r+=+u[0],2===u.length&&(i+=+u[1])),l=o.indexOf("rotate("),l>-1){c=o.substring(l+7);var f=+c.substring(0,c.indexOf(")"));f===f&&s.rotate(f*Math.PI/180)}}else o&&(r+=o.x,i+=o.y,e=o.k);(r||i)&&s.translate(t.factor*r,t.factor*i),e&&(n=n||e,s.scale(e,n))},F=function(t){var e=t.attrs.get("stroke-linecap");e&&(t.context.lineCap=e)},K=function(t){var e=t.attrs.get("stroke-linejoin");e&&(t.context.lineJoin=e)};S.set("circle",B),S.set("line",G),S.set("path",L),S.set("rect",I),S.set("text",H),S.set("linearGradient",!1),S.set("radialGradient",!1),A.set("opacity",J),A.set("stroke-linecap",F),A.set("stroke-linejoin",K),A.set("transform",U),t.selectCanvas=b,t.resolution=q,t.getSize=j,t.canvasVersion=z,Object.defineProperty(t,"__esModule",{value:!0})});