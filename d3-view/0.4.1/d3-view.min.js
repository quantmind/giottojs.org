!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-collection"),require("d3-selection"),require("d3-timer"),require("d3-dispatch")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-selection","d3-timer","d3-dispatch"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,r,n,i){"use strict";function o(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function a(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}function s(t){return"[object Object]"===ft.call(t)}function u(t){return"[object String]"===ft.call(t)}function l(t){return"[object Function]"===ft.call(t)}function c(t){return"[object Array]"===ft.call(t)}function f(t){return"[object Promise]"===ft.call(t)}function d(){this._array=[]}function h(t,e){var r=new d;if(t instanceof d)t.each(function(t,e){r.set(e,t)});else if(Array.isArray(t)){var n,i=-1,o=t.length;if(null==e)for(;++i<o;)r.set(i,t[i]);else for(;++i<o;)r.set(e(n=t[i],i,t),n)}else if(t)for(var a in t)r.set(a,t[a]);return r}function p(t){function e(t){this.el=t}function n(t){var n=new e(t);return Object.defineProperty(n,"value",{get:function(){return r.select(n.el).property("value")},set:function(t){r.select(n.el).property("value",t)}}),n}return e.prototype=mt({},$t,t),n.prototype=e.prototype,n}function v(t,e,r){return _t(function(){e.$set(r,t.value)})}function m(){this.attrs={},this.all=[]}function y(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__}function g(){var t=this.view();return t?t.model:null}function b(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),r=e.__d3_view__,n=e.parentNode;n&&!r;)r=n.__d3_view__,n=n.parentNode;return r}function E(t){var e=[],n=void 0;if(this.each(function(){var i=r.select(this).view();i&&f(n=w(this,i,t))&&e.push(n)}),e.length)return Promise.all(e)}function w(t,e,r){var n=e.components.get(t.tagName.toLowerCase()),i=Nt(t,e.directives),o=i.preMount();if(o)return o.execute(e.model);var a=void 0;if(n)a=(e=n({parent:e})).mount(t,r);else{for(var s=[],u=Dt(t.children),l=0;l<u.length;++l)f(a=w(u[l],e,r))&&s.push(a);s.length&&(a=Promise.all(s))}return f(a)?a.then(function(){return i.execute(e.model)}):i.execute(e.model)}function x(t,e){switch(e.type){case Rt.IDENTIFIER:return t[e.name];case Rt.LITERAL:return e.value;case Rt.ARRAY_EXP:return e.elements.map(function(e){return x(t,e)});case Rt.LOGICAL_EXP:case Rt.BINARY_EXP:return $(e.operator,x(t,e.left),x(t,e.right));case Rt.CALL_EXP:return P(t,e.callee,e.arguments);case Rt.MEMBER_EXP:return x(x(t,e.object),e.property);case Rt.CONDITIONAL_EXP:return x(t,e.test)?x(t,e.consequent):x(t,e.alternate);case Rt.UNARY_EXP:return _(e.operator,x(t,e.argument))}}function O(t,r){switch(1===arguments.length&&(r=e.set()),t.type){case Rt.IDENTIFIER:r.add(t.name);break;case Rt.ARRAY_EXP:t.elements.forEach(function(t){O(t,r)});break;case Rt.BINARY_EXP:O(t.left,r),O(t.right,r);break;case Rt.CALL_EXP:O(t.arguments,r);break;case Rt.MEMBER_EXP:O(t.object,r);break;case Rt.CONDITIONAL_EXP:O(t.test,r),O(t.consequent,r),x(t.alternate,r)}return r}function P(t,e,r){var n;if(r=r.map(function(e){return x(t,e)}),e.type!==Rt.IDENTIFIER&&(t=x(t,e.object),e=e.property),!(n=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return n.apply(t,r)}function _(t,e){return zt[t]||(zt[t]=new Function("arg","return "+t+" arg")),zt[t](e)}function $(t,e,r){return Jt[t]||(Jt[t]=new Function("a","b","return a "+t+" b")),Jt[t](e,r)}function C(t){this.codes=Rt,this.expr=t,this.parsed=Vt(t)}function j(t){var e=dt?window.handlebars:require("handlebars");if(e)return e.compile(t);bt("compile function requires handlebars")}function A(t,e){if(u(t)){if(!e)return t;if(!j(t))return t}return t(e)}function L(t,e){var n=r.select(document.createElement("div"));n.html(A(t,e));var i=n.node().children;return 1!==i.length&&bt("HtmlElement function should return one root element only, got "+i.length),i[0]}function I(t,r,n){function o(t){var r=yt(t,"parent"),o=e.map(r?r.components:null),a=e.map(r?r.directives:n),s=i.dispatch("message","mounted");u.each(function(t,e){o.set(e,t)}),c.each(function(t,e){a.set(e,t)}),D(o,yt(t,"components")),R(a,yt(t,"directives")),Object.defineProperties(this,{components:{get:function(){return o}},directives:{get:function(){return a}},parent:{get:function(){return r}},root:{get:function(){return r?r.root:this}},props:{get:function(){return d}},uid:{get:function(){return this.model.uid}},events:{get:function(){return s}}}),this.model=mt({},l(f)?f():f,yt(t,"model")),this.init(t)}function a(t){return new o(t)}l(t)&&(t={render:t});var s=mt({},t),u=D(e.map(),yt(s,"components")),c=R(e.map(),yt(s,"directives")),f=yt(s,"model"),d=yt(s,"props");return o.prototype=mt({},r,s),a.prototype=o.prototype,a}function N(t){var e=t.isMounted;return e||Object.defineProperty(t,"isMounted",{get:function(){return!0}}),e}function D(t,r){return e.map(r).each(function(e,r){t.set(r,I(e,oe))}),t}function R(t,r){return e.map(r).each(function(e,r){t.set(r,re(e))}),t}function S(t,e){Object.defineProperty(te(t),"el",{get:function(){return e}});var n=r.select(e).view(t).mount();return f(n)?n.then(function(){return t.mounted()}):t.mounted()}function T(t,e,n){return n?(1!==(n=ne(n)).size()&&bt("render function must return a single HTML node"),n=n.node(),e.parentNode.insertBefore(n,e),r.select(e).remove(),S(t,n)):bt("render function must return a single HTML node. It returned nothing!")}function k(t){for(var e={},r=void 0,n=0;n<t.attributes.length;++n)e[(r=t.attributes[n]).name]=r.value;return e}function M(t,r){function n(e){return null===a&&(a=X(t)),new a(e)}var i=e.map(),o=[],a=null;i.set("",ae()),Object.defineProperties(Zt(t),{$events:{get:function(){return i}},$children:{get:function(){return o}}}),t.$child=n,t.$update(r)}function X(t){function e(e){M(this,e),t.$children.push(this),Object.defineProperty(this,"parent",{get:function(){return t}})}return e.prototype=t,e}function q(t,e){for(;!(e in t)&&t.$parent;)t=t.$parent;return t}function U(t,e,r){function n(n){if(i&&(n=i.get.call(t)),n!==r){var o=r;r=n,t.$change(e,o)}}var i;t.$events.set(e,ae()),Object.defineProperty(t,e,function(){var o={get:function(){return r}};return l(r)&&(r={get:r}),s(r)&&l(r.get)?(r=(i=r).get.call(t),i.reactOn?i.reactOn.forEach(function(r){t.$on(r+"."+e,n)}):bt("reactive lazy property "+e+" does not specify 'reactOn' list or properties"),l(i.set)&&(o.set=i.set)):o.set=n,o}()),t.$change(e)}function B(t,e){var r=t.$events.get(e);return!r&&t.parent?B(t.parent,e):r}function F(t,e){if(!this.$events.has(t)&&this.$parent)return F.call(this.$parent,t,e);this.$set(t,e)}function H(t,e){e?t.on("change."+e,null):t.on("change",null)}function Y(t){M(this,t)}function G(t){return new Y(t)}function V(t){var e=this,r=G(t);return e.$children.push(r),Object.defineProperty(r,"parent",{get:function(){return e}}),r}function z(t){if(!t)return bt("element not defined, pass an identifier or an HTMLElement object");var e=(l(t.node)?t:r.select(t)).node();if(e)return e;bt("could not find "+t+" element")}function J(){document.removeEventListener("DOMContentLoaded",J),window.removeEventListener("load",J),W()}function W(){for(var t=void 0;gt.readyCallbacks.length;)t=gt.readyCallbacks.shift(),n.timeout(t)}function K(t){var e=t.type||"text";return xe[e]||e}function Q(t){var e=this.data.children;if(e){if(!c(e))return Ee("children should be an array of fields, for "+(void 0===e?"undefined":Ot(e))),t;t.selectAll(".d3form").data(e).enter().append(tt).classed("d3form",!0)}return t}function Z(t){t||(t={}),this.data=t;var e=this.model;return we.forEach(function(r){r in t&&e.$set(r,t[r])}),t}function tt(t){var e=K(t);return e||(Ee("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3"+e)}function et(t){var e=t.formTheme;return!e&&t.parent?et(t.parent):e}function rt(t){var e=t.attr("min"),r=t.attr("max");return e=null===e?-1/0:+e,r=null===r?1/0:+r,[e,r]}function nt(t,e){return{set:function(e,r){r[t]},validate:function(t,r){return e(t,r)}}}function it(){return c(this.option)?this.option[0]:this.option}function ot(){return c(this.option)?this.option[1]||this.option[0]:this.option}function at(t){var e=t.json();this.message(e)}function st(){window.location.href=this.data.redirectTo||"/"}function ut(t){function e(t){n.setSubmitDone(),n.response(t)}function r(){n.setSubmitDone()}var n=this&&this.model?this.model.form:null;if(!n)return void Ee("form not available, cannot submit");t&&(t.preventDefault(),t.stopPropagation());var i=be.fetch,o=(n.data.enctype||"").split(";")[0],a=n.data.action,u=s(a)?a.url:a,l=n.inputData(),c={};if(!i)return void Ee("fetch provider not available, cannot submit");if(!u)return void Ee("No url, cannot submit");if("application/json"===o)c.headers={"Content-Type":n.data.enctype},c.body=JSON.stringify(l);else{c.body=new FormData;for(var f in l)c.body.set(f,l[f])}n.setSubmit(),c.method=n.method||"post",i(u,c).then(e,r)}function lt(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[required, labelSrOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}function ct(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+e+"</span>\n<slot></slot>\n</div>"}var ft=Object.prototype.toString,dt="undefined"!=typeof window&&"[object Object]"!==ft.call(window),ht=dt?window.console:require("console"),pt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,mt=function(){return a()?Object.assign:function(t){for(var e,r,n=o(t),i=1;i<arguments.length;i++){e=Object(arguments[i]);for(var a in e)pt.call(e,a)&&(n[a]=e[a]);if(Object.getOwnPropertySymbols){r=Object.getOwnPropertySymbols(e);for(var s=0;s<r.length;s++)vt.call(e,r[s])&&(n[r[s]]=e[r[s]])}}return n}}(),yt=function(t,e){var r=void 0;if(s(t))return r=t[e],delete t[e],r;if(c(t)){var n=+e;return n===n?t.splice(n,1)[0]:(r=t[e],delete t[e],r)}};d.prototype=h.prototype={constructor:d,size:function(){return this._array.length},get:function(t){return this["$"+t]},set:function(t,e){return this.has(t)||this._array.push(t),this["$"+t]=e,this},has:function(t){return"$"+t in this},clear:function(){var t=this;this.each(function(e,r){delete t["$"+r]}),this._array.splice(0)},keys:function(){var t=[];return this.each(function(e,r){t.push(r)}),t},values:function(){var t=[];return this.each(function(e){t.push(e)}),t},each:function(t){for(var e,r=this._array,n=0;n<r.length;++n)e=r[n],t(this.get(e),e,n)}};var gt={logger:ht,fetch:function(){if(dt)return window.fetch}(),readyCallbacks:[]},bt=function(t){gt.logger.warn("[d3-view] "+t)},Et=["disabled","readonly","required"],wt={create:function(t){return this.arg?t:bt("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,e){return"class"===this.arg?this.refreshClass(e):c(e)?bt("Cannot apply array to attribute "+this.arg):void(Et.indexOf(this.arg)>-1?this.sel.property(this.arg,e||null):this.sel.attr(this.arg,e))},refreshClass:function(t){var e=this.sel;c(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&e.classed(t,!1)}),this.oldValue=t.map(function(t){var r=!0;return c(t)&&(r=t[1],t=t[0]),t&&e.classed(t,r),t})}},xt={refresh:function(t,e){u(e)&&this.sel.html(e)}},Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},_t=function(t,e){var r=null;return function(){if(null!==r)return r;var i=this,o=arguments;return r=new Promise(function(a,s){n.timeout(function(){r=null;try{a(t?t.call.apply(t,[i].concat(Pt(o))):void 0)}catch(t){s(t)}},e)})}},$t={on:function(t,e){var n=v(this,t,e);r.select(this.el).on("input",n).on("change",n)}},Ct={input:p(),textarea:p()},jt={create:function(t){var e=this.sel.attr("type"),r=this.el.tagName.toLowerCase(),n=Ct[e]||Ct[r];return n?(this.tag=new n(this.el),t):bt("Cannot apply d3-value directive to "+r)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return bt('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var r=this.expression.expr;return t.$set(r,this.tag.value),this.tag.on(t,r),t},refresh:function(t,e){this.tag.value=e},destroy:function(){this.tag.off()}},At={mount:function(t){return this.display=this.sel.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){e?this.sel.style("display",this.display):this.sel.style("display","none")}},Lt={mount:function(t){var e=this.arg||"click",r=this.expression;this.sel.on(e+"."+this.uid,function(){r.eval(t)})}},It=["name","class","disabled","readonly","required","href"],Nt=function(t,e){var n=r.select(t),i=n.directives();if(i)return i;if(i=new m,!e)return i;for(var o=0;o<t.attributes.length;++o){var a=t.attributes[o],s=a.name.split("-"),u=s[2],l="d3"===s[0]?s[1]:null;if(l){!u&&It.indexOf(l)>-1&&(u=l,l="attr");var c=e.get(l);c?i.add(c(t,a,u)):bt(t.tagName+' cannot find directive "'+l+'". Did you forget to register it?')}i.attrs[a.name]=a.value}return i.size()&&n.directives(i),i};m.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size()){var e=[],r=void 0;return this.forEach(function(n){f(r=n.execute(t))&&e.push(r)}),e.length?Promise.all(e):void 0}}};var Dt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(t,e)};r.selection.prototype.mount=E,r.selection.prototype.view=b,r.selection.prototype.model=g,r.selection.prototype.directives=y;var Rt={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},St=function(t,e){var r=new Error(t+" at character "+e);throw r.index=e,r.description=t,r},Tt={"-":!0,"!":!0,"~":!0,"+":!0},kt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Mt=function(t){var e,r=0;for(var n in t)(e=n.length)>r&&t.hasOwnProperty(n)&&(r=e);return r},Xt=Mt(Tt),qt=Mt(kt),Ut={true:!0,false:!1,null:null},Bt=function(t){return kt[t]||0},Ft=function(t,e,r){return{type:"||"===t||"&&"===t?Rt.LOGICAL_EXP:Rt.BINARY_EXP,operator:t,left:e,right:r}},Ht=function(t){return t>=48&&t<=57},Yt=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!kt[String.fromCharCode(t)]},Gt=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!kt[String.fromCharCode(t)]},Vt=function(t){for(var e,r,n=0,i=t.charAt,o=t.charCodeAt,a=function(e){return i.call(t,e)},s=function(e){return o.call(t,e)},u=t.length,l=function(){for(var t=s(n);32===t||9===t;)t=s(++n)},c=function t(){var e,r,i=d();return l(),63!==s(n)?i:(n++,(e=t())||St("Expected expression",n),l(),58===s(n)?(n++,(r=t())||St("Expected expression",n),{type:Rt.CONDITIONAL_EXP,test:i,consequent:e,alternate:r}):void St("Expected :",n))},f=function(){l();for(var e=t.substr(n,qt),r=e.length;r>0;){if(kt.hasOwnProperty(e))return n+=r,e;e=e.substr(0,--r)}return!1},d=function(){var t,e,r,i,o,a,s,u;if(a=h(),!(e=f()))return a;for(o={value:e,prec:Bt(e)},(s=h())||St("Expected expression after "+e,n),i=[a,o,s];(e=f())&&0!==(r=Bt(e));){for(o={value:e,prec:r};i.length>2&&r<=i[i.length-2].prec;)s=i.pop(),e=i.pop().value,a=i.pop(),t=Ft(e,a,s),i.push(t);(t=h())||St("Expected expression after "+e,n),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=Ft(i[u-1].value,i[u-2],t),u-=2;return t},h=function e(){var r,i,o;if(l(),r=s(n),Ht(r)||46===r)return p();if(39===r||34===r)return v();if(Yt(r)||40===r)return g();if(91===r)return E();for(o=(i=t.substr(n,Xt)).length;o>0;){if(Tt.hasOwnProperty(i))return n+=o,{type:Rt.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},p=function(){for(var t,e,r="";Ht(s(n));)r+=a(n++);if(46===s(n))for(r+=a(n++);Ht(s(n));)r+=a(n++);if("e"===(t=a(n))||"E"===t){for(r+=a(n++),"+"!==(t=a(n))&&"-"!==t||(r+=a(n++));Ht(s(n));)r+=a(n++);Ht(s(n-1))||St("Expected exponent ("+r+a(n)+")",n)}return e=s(n),Yt(e)?St("Variable names cannot start with a number ("+r+a(n)+")",n):46===e&&St("Unexpected period",n),{type:Rt.LITERAL,value:parseFloat(r),raw:r}},v=function(){for(var t,e="",r=a(n++),i=!1;n<u;){if((t=a(n++))===r){i=!0;break}if("\\"===t)switch(t=a(n++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||St('Unclosed quote after "'+e+'"',n),{type:Rt.LITERAL,value:e,raw:r+e+r}},m=function(){var e,r=s(n),i=n;for(Yt(r)?n++:St("Unexpected "+a(n),n);n<u&&(r=s(n),Gt(r));)n++;return e=t.slice(i,n),Ut.hasOwnProperty(e)?{type:Rt.LITERAL,value:Ut[e],raw:e}:"this"===e?{type:Rt.THIS_EXP}:{type:Rt.IDENTIFIER,name:e}},y=function(t){for(var e,r,i=[],o=!1;n<u;){if(l(),(e=s(n))===t){o=!0,n++;break}44===e?n++:((r=c())&&r.type!==Rt.COMPOUND||St("Expected comma",n),i.push(r))}return o||St("Expected "+String.fromCharCode(t),n),i},g=function(){var t,e;for(e=40===(t=s(n))?b():m(),l(),t=s(n);46===t||91===t||40===t;)n++,46===t?(l(),e={type:Rt.MEMBER_EXP,computed:!1,object:e,property:m()}):91===t?(e={type:Rt.MEMBER_EXP,computed:!0,object:e,property:c()},l(),93!==(t=s(n))&&St("Unclosed [",n),n++):40===t&&(e={type:Rt.CALL_EXP,arguments:y(41),callee:e}),l(),t=s(n);return e},b=function(){n++;var t=c();if(l(),41===s(n))return n++,t;St("Unclosed (",n)},E=function(){return n++,{type:Rt.ARRAY_EXP,elements:y(93)}},w=[];n<u;)59===(e=s(n))||44===e?n++:(r=c())?w.push(r):n<u&&St('Unexpected "'+a(n)+'"',n);return 1===w.length?w[0]:{type:Rt.COMPOUND,body:w}};Vt.addUnaryOp=function(t){return Xt=Math.max(t.length,Xt),Tt[t]=!0,this},Vt.addBinaryOp=function(t,e){return qt=Math.max(t.length,qt),kt[t]=e,this},Vt.addLiteral=function(t,e){return Ut[t]=e,this},Vt.removeUnaryOp=function(t){return delete Tt[t],t.length===Xt&&(Xt=Mt(Tt)),this},Vt.removeBinaryOp=function(t){return delete kt[t],t.length===qt&&(qt=Mt(kt)),this},Vt.removeLiteral=function(t){return delete Ut[t],this};var zt={},Jt={},Wt={eval:function(t){return x(t,this.parsed)},safeEval:function(t){try{return x(t,this.parsed)}catch(t){bt("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return O(this.parsed).values()}};C.prototype=Wt;var Kt=function(t){return new C(t)},Qt=0,Zt=function(t){var e="d3v"+ ++Qt;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},te=function(t){return Object.defineProperty(t,"sel",{get:function(){return r.select(this.el)}}),t},ee={priority:1,create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){var e=this;if(this.expression&&(this.removeAttribute(),t=this.mount(t))){var r=this,n=this.sel,i=function(){try{r.refresh(t,r.expression.eval(t))}catch(t){bt('Error while refreshing "'+r.name+'" directive: '+t)}};this.identifiers=this.expression.identifiers().map(function(e){var n=e+"."+r.uid;return t.$on(n,i),e}),n.on("remove."+r.uid,function(){e.identifiers.forEach(function(e){t.$off(e+"."+r.uid)}),r.destroy(t)}),i()}}},re=function(t){function e(t,e,r){this.el=t,this.name=e.name,this.arg=r;var n=te(Zt(this)).create(e.value);n&&(this.expression=Kt(n))}function r(t,r,n){return new e(t,r,n)}return e.prototype=mt({},ee,t),r.prototype=e.prototype,r},ne=function(t){return t&&!l(t.size)?r.select(t):t},ie=function(t){if(u(t))try{return JSON.parse(t)}catch(e){return t}return t},oe={isd3:!0,providers:gt,htmlElement:L,viewElement:L,createElement:function(t){return r.select(document.createElement(t))},responseError:function(t){var e=this;t.json().then(function(r){e.error(r,t)})},error:function(t){t.level="error",this.message(t)},message:function(t){var e=this;this.root.events.call("message",e,t)},fetch:function(t,e){var r=gt.fetch;return 1==arguments.length?r(t):r(t,e)},init:function(){},render:function(){},mounted:function(){},mount:function(t,e){if(!N(this)){var n=r.select(t),i=n.directives(),o=i?i.attrs:k(t),a=this.parent.model.$child(this.model);if(e=mt({},n.datum(),e),this.model=a,c(this.props)){var s,u;this.props.forEach(function(t){s=o[t],u=a[s]?a[s]:ie(s),e[t]=u})}var l=this.render(e,o);if(f(l)){var d=this;return l.then(function(e){return T(d,t,e)})}return T(this,t,l)}bt("already mounted")}},ae=function(){var t=i.dispatch("change"),e=0;return{on:function(e,r){return arguments.length<2?t.on(e):(t.on(e,r),this)},trigger:_t(function(){t.apply("change",this,arguments),e+=1}),triggered:function(){return e}}},se=function(t){var e=t.split("."),r=e.splice(0,1),n=q(this,r);if(r in n){for(var i=n[r];i&&e.length;)i=i[e.splice(0,1)];return i}},ue=function(t,e){this.$events.get(t)?this[t]=e:U(this,t,e)},le=function(t,e){1===arguments.length&&l(t)&&(e=t,t="");var r=t.split("."),n=r[0],i=B(this,n);return i?(this.$events.get(n)||r.push(this.uid),r[0]="change",i.on(r.join("."),e)):bt('Cannot bind to "'+n+'" - no such reactive property')},ce=function(t,e){if(t){e=2!==arguments.length||e;for(var r in t)(e||void 0===this[r])&&("$"===r.substring(0,1)?this.constructor.prototype[r]?bt("Cannot set attribute method "+r+", it is protected"):this[r]=t[r]:this.$set(r,t[r]))}return this},fe=function(t){if(void 0===t)this.$events.each(function(t){return H(t)});else{var e=t.split("."),r=e.splice(0,1)[0],n=this.$events.get(r);n&&H(n,e.join("."))}this.$children.forEach(function(e){return e.$off(t)})},de=function(t){var e,r=this.$events.get(t),n=Dt(arguments,1);return r?(e=r.trigger).call.apply(e,[this].concat(Pt(n))):bt("attribute '"+t+"' is not a reactive property this model"),this};G.prototype=Y.prototype,Y.prototype.$on=le,Y.prototype.$change=de,Y.prototype.$update=ce,Y.prototype.$get=se,Y.prototype.$set=ue,Y.prototype.$new=V,Y.prototype.$setbase=F,Y.prototype.$off=fe;var he=mt({},oe,{use:function(t){return s(t)?t.install(this):t(this),this},addComponent:function(t,e){if(this.isMounted)return bt("already mounted, cannot add component");var r=I(e,oe);return this.components.set(t,r),r},addDirective:function(t,e){if(this.isMounted)return bt("already mounted, cannot add directive");var r=re(e);return this.directives.set(t,r),r},mount:function(t,e){if(N(this))bt("already mounted");else if(t=z(t)){this.model=this.parent?this.parent.model.$child(this.model):G(this.model);var r=S(this,t);return e?r?r.then(e):e():r}}}),pe=I(null,he),ve={attr:wt,html:xt,value:jt,show:At,on:Lt,for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?bt('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,r.select(this.creator).remove(),this.el)return t},refresh:function(t,e){if(c(e)){var r=this.creator,n=r.tagName+"."+this.itemClass,i=this.itemName,o=this.sel,a=o.selectAll(n).data(e),s=o.view(),u=void 0;a.exit().remove(),a.enter().append(function(){return r.cloneNode(!0)}).classed(this.itemClass,!0).each(function(t,e){(u={index:e})[i]=t,pe({model:u,parent:s}).mount(this)})}}},if:{refresh:function(t,e){e?this.sel.style("display",null):this.sel.style("display","none")}}},me=I(null,he,R(e.map(),ve)),ye=function(t){gt.readyCallbacks.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",J),window.addEventListener("load",J)):W()},ge=function(t){var e=this;return new Promise(function(r,n){try{dt?window.require(t,function(){r.apply(this,arguments)}):r.apply(e,require(t))}catch(t){n(t)}})},be={logger:ht},Ee=function(t){be.logger.warn("[d3-form] "+t)},we=["labelSrOnly","layout"],xe={text:"input",password:"input",number:"input"},Oe={render:function(t){var e=this.createElement("fieldset");return Z.call(this,t),Q.call(this,e)}},Pe={wrap:function(t){var e=this,r=et(e),n=r?r[t.attr("type")]||r[t.node().tagName.toLowerCase()]:null;if(!n||!r.wrappers)return t;var i,o=t;return n.forEach(function(n){i=r.wrappers[n],i?o=i.call(e,o,t):Ee("Could not find form field wrapper "+n)}),o},wrapTemplate:function(t,e){var n=document.createElement("div"),i=r.select(n).html(e).select("slot");if(!i.size())return Ee("template does not provide a slot element"),t;var o=r.select(i.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),i.remove(),r.selectAll(n.children)}},_e=mt({model:{value:null,error:"",isDirty:null,showError:{reactOn:["error","isDirty","formSubmitted"],get:function(){return!!this.error&&(this.isDirty||this.formSubmitted)}},$validate:function(){}},inputData:function(t){return(t=Z.call(this,t)).name||Ee("Input field without a name"),t.placeholder=t.placeholder||t.label||t.name,t.id=t.id||"d3f"+this.uid,this.model.inputs[t.name]=this.model,t}},Pe),$e={get:function(t){var e=this.all.slice(0);if(s(t))for(var r in t)e.push(nt(r,t[r]));return e},set:function(t,e){var r=t.model;r._view=t,r.validators.forEach(function(r){return r.set(e,t.data)}),r.$on("value.validate",this.validate),r.$validate=this.validate},validate:function(){var t,e,r=this,n=r._view,i=r.validators,o=r.value,a=n.sel.attr("id")===n.data.id?n.sel:n.sel.select("#"+n.data.id);null===r.isDirty?r.isDirty=!1:r.isDirty=!0;for(var s=0;s<i.length;++s)if(t=i[s],e=t.validate(a,o)){!0===e&&(e="");break}r.error=e||""},all:[{set:function(t,e){var r=e.required;u(r)?t.attr("d3-required",r):t.property("required",r||null)},validate:function(t,e){if(t.property("required")){if(!e)return"required";if(""===e)return!0}}},{set:function(t,e){var r=e.minLength;u(r)?t.attr("d3-attr-minlength",r):void 0!==r&&t.attr("minlength",r)},validate:function(t,e){var r=+t.attr("minlength");if(r===r&&r>0&&e.length<r)return"too short - "+r+" characters or more expected"}},{set:function(t,e){var r=e.maxLength;u(r)?t.attr("d3-attr-maxlength",r):void 0!==r&&t.attr("maxlength",r)},validate:function(t,e){var r=+t.attr("maxlength");if(r===r&&r>0&&e.length>r)return"too long - "+r+" characters or less expected"}},{set:function(t,e){var r=e.minimum;u(r)?t.attr("d3-attr-min",r):void 0!==r&&t.attr("min",r)},validate:function(t,e){var r=rt(t);if(r&&+e<r[0])return"must be greater or equal "+r[0]}},{set:function(t,e){var r=e.maximum;u(r)?t.attr("d3-attr-max",r):void 0!==r&&t.attr("max",r)},validate:function(t,e){var r=rt(t);if(r&&+e>r[1])return"must be less or equal "+r[1]}}]},Ce={default:at,redirect:st},je={submit:ut},Ae={props:["schema"],model:function(){return{formSubmitted:!1,formPending:!1,inputs:{},$isValid:function(){var t=void 0,e=!0;for(var r in this.inputs)(t=this.inputs[r]).$validate(),t.error&&(e=!1);return e},$setSubmit:function(){return this.formSubmitted=!0,this.formPending=!0,this.$isValid()},$setSubmitDone:function(){this.formPending=!1}}},components:{d3fieldset:Oe,d3input:mt({render:function(t){t=this.inputData(t);var e=this.createElement("input").attr("id",t.id).attr("type",t.type||"text").attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return $e.set(this,e),this.wrap(e)}},_e),d3textarea:mt({render:function(t){t=this.inputData(t);var e=this.createElement("textarea").attr("id",t.id).attr("name",t.name).attr("placeholder",t.placeholder).attr("d3-value","value").attr("d3-validate","validators");return $e.set(this,e),this.wrap(e)}},_e),d3select:mt({},_e,{model:mt({options:[],$optionLabel:ot,$optionValue:it},_e.model),render:function(t){t=this.inputData(t);var e=this.createElement("select").attr("id",t.id).attr("name",t.name).attr("d3-value","value").attr("placeholder",t.placeholder);return this.model.options=t.options,e.append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),$e.set(this,e),this.wrap(e)}}),d3submit:mt({render:function(t){(t=Z.call(this,t)).type=t.type||"submit",this.model.$set("error",!1),u(t.disabled)||(this.model.$set("disabled",t.disabled||null),t.disabled="disabled"),t.click||(t.click="$vm.click()");var e=this.createElement("button").attr("type",t.type).attr("name",t.name).attr("d3-attr-disabled",t.disabled).attr("d3-on-click",t.click).html(t.label||"submit");return this.wrap(e)},click:function(){this.model.actions.submit.call(this,r.event)}},Pe)},render:function(t){function e(e){Z.call(i,e),r.validators=$e.get(t.validators);for(var o in je){var a=i.data[o];u(a)&&(a=i.model.$get(a)),r.actions[o]=a||je[o]}return Q.call(i,n),n}var r=this.model,n=this.createElement("form").attr("novalidate",""),i=this;r.actions={},r.form=this;var o=t.schema;return u(o)?(0,be.fetch)(o,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(e);Ee("Could not load form from "+o+": status "+t.status)}):e(o)},inputData:function(){var t,e=this.model.inputs,r={};for(var n in e)void 0!==(t=e[n].value)&&(r[n]=t);return r},setSubmitDone:function(){this.model.formPending=!1},isValid:function(){for(var t in this.model.inputs)if(this.model.inputs[t].error)return!1;return!0},inputError:function(t){this.model.inputs[t.name]||(Ee("Unknown input, cannot set input error"),this.error(t))},response:function(t){if(t){var e;if(t.status)t.status<300?this.data.resultHandler?(e=Ce[this.data.resultHandler])?e.call(this,t):Ee("Could not find "+this.data.resultHandler+" result handler"):Ce.default.call(this,t):this.responseError(t);else if(t.error)this.error(t.error);else if(c(t.errors)){var r=this;t.errors.forEach(function(t){r.inputError(t)})}else this.data.resultHandler?(e=Ce[this.data.resultHandler])?e.call(this,t):Ee("Could not find "+this.data.resultHandler+" result handler"):Ce.default.call(this,t)}}},Le={install:function(t){t.addComponent("d3form",Ae);for(var e in t.providers)be[e]=t.providers[e]},actions:je,responses:Ce},Ie={input:["inputGroup","label","formGroup"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t){return this.wrapTemplate(t,lt(this.data))},formGroup:function(t,e){return e.classed("form-control",!0).attr("d3-class",'showError ? "form-control-danger" : null'),this.wrapTemplate(t,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e){var r=this.data.group;if(!r)return t;var n="g"+e.attr("id");return e.attr("aria-describedby",n),this.wrapTemplate(t,ct(n,r))},submit:function(t,e){var r=this.data.theme||"primary";return e.classed("btn",!0).classed("btn-"+r,!0),this.wrapTemplate(t,'<div class="form-group">\n<slot></slot>\n</div>')}}},Ne={install:function(t){var e=t.components.get("d3form");e&&(e.prototype.formTheme=Ie)}};t.view=me,t.viewModel=G,t.viewExpression=Kt,t.viewReady=ye,t.viewProviders=gt,t.viewWarn=bt,t.viewRequire=ge,t.viewForms=Le,t.viewBootstrapForms=Ne,t.viewUid=Zt,t.viewDebounce=_t,t.viewVersion="0.4.1",t.viewElement=L,t.viewTemplate=j,t.viewHtml=A,Object.defineProperty(t,"__esModule",{value:!0})});